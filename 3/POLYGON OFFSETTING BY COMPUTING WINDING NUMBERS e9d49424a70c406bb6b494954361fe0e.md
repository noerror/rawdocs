# POLYGON OFFSETTING BY COMPUTING WINDING NUMBERS

[https://mcmains.me.berkeley.edu/pubs/DAC05OffsetPolygon.pdf](https://mcmains.me.berkeley.edu/pubs/DAC05OffsetPolygon.pdf)

[https://github.com/w8r/polygon-offset/blob/master/README.md](https://github.com/w8r/polygon-offset/blob/master/README.md)

- 2005

### 1 Introduction

오프셋은 컴퓨터 지원 설계 및 제조(CAD/CAM)에서 중요한 기술입니다.

![포켓 가공에서의 도구 경로 생성](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled.png)

포켓 가공에서의 도구 경로 생성

주요 응용 분야:

- 설계 및 제조: 오프셋은 설계 및 계획 단계에서 사용됩니다. 예를 들어, 2.5D 포켓 가공을 위한 경로를 생성할 때 절삭 공구의 반경을 기준으로 포켓의 경계가 안쪽으로 조정됩니다. 이렇게 하면 공구가 소재를 과도하게 절단하지 않습니다.
    - 평행 공구 경로: 도구 경로에는 오프셋 경계와 평행선을 교차하여 만든 포켓 내부의 선 세그먼트가 포함됩니다.
    - 윤곽 평행 도구 경로: 원래 경계가 단계별로 오프셋되고 이러한 단계가 연결되어 도구 경로를 형성합니다.
- 접근 가능한 영역 결정: 오프셋을 사용하면 반경을 기준으로 도구가 영역에 접근할 수 있는지 여부를 결정할 수 있습니다. 오프셋 후에도 영역이 남아 있으면 좁은 모서리에 접근하려면 더 작은 공구가 필요합니다.

![원래의 다각형과 다시 오프셋 된 다각형 사이의 차이](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%201.png)

원래의 다각형과 다시 오프셋 된 다각형 사이의 차이

- 금형 가공: 금형 또는 금형을 제조할 때 오프셋은 거친 가공 공정에 도움이 됩니다. 금형 캐비티는 2D 윤곽으로 나뉩니다. 그런 다음 공구의 반경과 미절삭 여유량을 고려하여 이 윤곽을 안쪽으로 조정합니다. 가공은 맨 위 레이어에서 시작하여 아래쪽으로 진행됩니다.

![다이/금형의 대략적인 가공](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%202.png)

다이/금형의 대략적인 가공

- 신속한 프로토타이핑: 오프셋은 모델을 여러 레이어로 분할하는 래피드 프로토타이핑에서도 매우 중요합니다. 이러한 레이어의 윤곽을 오프셋하여 툴 경로를 설정합니다. 이 접근 방식은 속이 빈 버전의 오브젝트를 만드는 데도 도움이 되어 시간과 재료를 절약할 수 있습니다.
- 로봇 모션 계획: 자율적으로 움직이는 로봇의 경우 장애물로 가득 찬 작업 공간을 2D 폴리곤으로 볼 수 있습니다. 로봇의 크기에 따라 이 다각형을 오프셋하면 로봇이 방해 없이 이동할 수 있는 위치를 알 수 있습니다.

알고리즘:

이 연구에서는 오프셋을 위한 새로운 알고리즘을 도입했습니다. 이 알고리즘은 다각형의 모든 모서리를 오프셋한 다음 원형 호로 간격을 좁히는 일반적인 접근 방식과 다릅니다. 이러한 결과에는 종종 원치 않는 루프가 포함됩니다.

![전통적인 쌍대 오프셋 접근법](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%203.png)

전통적인 쌍대 오프셋 접근법

이 새로운 방법은 임의의 구멍이 있더라도 겹치지 않는 여러 다각형을 오프셋하는 것을 목표로 합니다. 이 접근 방식은 일반적인 원시 오프셋 커브의 변형을 사용합니다. 그런 다음 해당 영역의 와인딩 수를 결정합니다. 양수가 아닌 권선 수를 가진 영역을 평가하여 커브에서 원하지 않는 루프를 식별하고 제거할 수 있습니다. 결과는 조정된 다각형의 윤곽입니다.

기술적인 측면에서 이 알고리즘은 OpenGL 유틸리티 라이브러리를 사용하며 O((n+k)logn) 시간으로 작동합니다. 여기서 'n'은 입력 폴리곤의 정점 수를 나타내고 'k'는 원시 오프셋 커브의 자체 교차점을 나타냅니다. 이 새로운 알고리즘은 단순성과 신뢰할 수 있는 결과로 인해 상업적 대안보다 우수한 것으로 평가받고 있습니다.

### 2 Related Work

1. 보로노이 다이어그램 사용하기:
- 기본 사항: 보로노이 다이어그램은 평면의 특정 하위 집합에 있는 점과의 거리를 기준으로 평면을 여러 영역으로 분할하는 그래픽 표현입니다.
- 응용:
    - 페르손은 독특한 포켓 형상을 가공하기 위한 커터 경로를 개발하는 데 이 다이어그램을 처음 사용했습니다.
    - 추와 코헨은 윤곽 평행 경로에 이 다이어그램을 활용했습니다.
    - Kim은 보로노이 다이어그램으로 효율적인 알고리즘을 공식화하여 선분과 호로 이루어진 기본 다각형의 트림된 오프셋을 계산했습니다.
- 도전 과제:
    - 보로노이 다이어그램을 구성하는 것은 계산적으로 까다로울 수 있으며 중간 기하학적 형태의 생성으로 인해 수치적 견고성 문제에 직면할 수 있습니다.
    - 스미스는 이러한 다이어그램을 구성하기 위해 분할 및 정복 방법을 제안하여 오류를 줄이고 적응 정밀도 산술을 적용하여 수치 문제를 해결하고자 했습니다.
    - 보로노이 기반 오프셋은 빠르지만 실제 다이어그램을 구축하는 것은 느리고 복잡할 수 있습니다.

2. 쌍 교차 방법:

- 기본 사항: 이 방법은 포켓 경계를 오프셋한 다음 오프셋된 세그먼트와 원래 경계 사이의 거리를 계산하여 겹치는 구간을 결정합니다.
- 애플리케이션:
    - Rossignac과 Requicha는 CSG(Constructive Solid Geometry)를 사용하여 오프셋 후 간섭 구간을 식별하는 알고리즘을 개발했습니다.
    - Hansen과 Arbab은 간섭 지수를 구현하여 '가우징' 섹션을 감지하고 제거했습니다.
    - Yang과 Huang은 오프셋 세그먼트 사이의 지오메트리를 검사하여 루프 유효성 검사를 위한 두 가지 기준을 도입했습니다.
    - Barton은 바운딩 박스 계층 구조를 사용하여 2D 다각형의 인플레이션/디플레이션 문제를 해결했습니다.
    - Choi과 Park은 원시 오프셋 커브를 구성하기 전에 모든 로컬 유효하지 않은 루프를 제거하여 빠른 알고리즘을 제안했습니다. 하지만 이 알고리즘은 구멍이 없는 다각형으로 제한됩니다.

요약하자면, CAD/CAM에는 다양한 오프셋 기법이 존재하지만, 각각의 기법에는 고유한 장점과 과제가 있습니다. 연구자들은 효율성, 정확성, 구현 용이성을 개선하기 위해 지속적으로 노력하고 있습니다.

### 3 Assumptions and Preliminary Definitions

1. 기본 입력:
- 이 알고리즘은 겹치지 않는 2D 다각형을 처리합니다.
- 이러한 다각형은 직선 가장자리를 가지며 내부에 구멍이나 "섬"이 있을 수 있습니다.
입력 다각형은 서로 교차하지 않지만 가장자리는 특정 지점에서 수렴할 수 있습니다.

2. 방향 및 방향:

- 다각형의 외부 경계(또는 주변 윤곽)의 방향은 시계 반대 방향(CCW)입니다.
- 내부 윤곽(구멍 또는 섬)은 시계 방향(CW)입니다.
- 각 가장자리의 법선(가장자리에 수직인 선)은 다각형의 외부를 가리킵니다.
    
    ![구멍이 있는 다각형의 볼록한 및 오목한 꼭지점](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%204.png)
    
    구멍이 있는 다각형의 볼록한 및 오목한 꼭지점
    

3. 정점 유형:

- 윤곽선을 따라 이동할 때 좌회전이 있는 정점을 볼록이라고 합니다.
- 우회전하면 오목이라고 합니다.
    
    ![ω(q,P), 점 q에서의 회전 수는 q에서의 어떤 광선에 대해서도 +1과 같다. 표시된 광선의 경우, 각 다각형 가장자리를 통과할 때 회전 수에 대한 증분 차이(+/- 1)가 표시된다.](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%205.png)
    
    ω(q,P), 점 q에서의 회전 수는 q에서의 어떤 광선에 대해서도 +1과 같다. 표시된 광선의 경우, 각 다각형 가장자리를 통과할 때 회전 수에 대한 증분 차이(+/- 1)가 표시된다.
    

4. 와인딩 횟수:

- 한 점이 다각형으로 둘러싸인 횟수를 나타냅니다.
- 다양한 정의가 존재하지만 결과는 일관되게 유지됩니다.
- 이 백서의 정의에서는 방향이 지정된 다각형과 한 점에서 연장된 광선과의 교차 방향을 사용합니다.
- 이 개념은 동일한 영역에서 일관된 값, 인접한 영역의 와인딩 번호가 다르며 여러 윤곽에 적용할 수 있는 등의 특성을 가지고 있습니다.
    
    ![회전 규칙](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%206.png)
    
    회전 규칙
    

5. 와인딩 규칙:

- 구불구불 규칙은 영역을 다각형의 내부 또는 외부로 분류합니다.
- 다섯 가지 주요 규칙이 강조 표시되며, 각각의 OpenGL 구현 이름을 따서 명명되었습니다.
    - 예: 글루 테스 와인딩 오드, 글루 테스 와인딩 논제로 등.
- 이러한 규칙은 폴리곤 채우기 및 부울 연산과 같은 프로세스에서 중요한 역할을 합니다.
- 이 논문에서는 전처리 및 오프셋 추출에 포지티브 와인딩 규칙을 사용합니다.
    
    ![사전 처리; 연결된 각 영역의 회전 수는 왼쪽에 표시되며 양의 회전 규칙에 따른 다각형의 내부가 오른쪽에 표시된다](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%207.png)
    
    사전 처리; 연결된 각 영역의 회전 수는 왼쪽에 표시되며 양의 회전 규칙에 따른 다각형의 내부가 오른쪽에 표시된다
    

6. 오프셋 정의:

- 내부 오프셋: 다각형 내에 있지만 경계로부터 일정 거리(d) 떨어진 점으로 형성된 경계입니다.
- 외부 오프셋: 다각형 외부에 있지만 경계에서 일정 거리(d) 떨어진 점으로 형성된 경계입니다.

![점과 다각형 사이의 거리](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%208.png)

점과 다각형 사이의 거리

- 포인트에서 다각형까지의 거리는 포인트에서 다각형의 가장 가까운 가장자리까지 측정됩니다.

이 백서에서는 다각형의 복잡한 세부 사항, 방향, 와인딩 규칙, 안쪽과 바깥쪽의 오프셋을 결정하는 방법에 대해 자세히 설명합니다. 이 접근 방식은 다음 섹션에서 자세히 설명할 일련의 예비 정의와 가정을 기반으로 합니다.

### 4 Winding Number Offset Algorithms

주요 아이디어: 기존의 쌍 단위 오프셋은 각 가장자리를 오프셋한 다음 정점에 호를 삽입하여 커브를 만드는데, 이 커브는 종종 자체 교차합니다. 이러한 교차점을 수정하기 위해 일부 알고리즘은 유효하지 않은 루프를 식별하고 제거하는 데 중점을 둡니다. 이러한 루프를 구별하는 유망한 접근 방식은 오프셋 커브의 와인딩 수를 계산하는 것입니다.

![전통적인 쌍대 내부 오프셋 원시 오프셋 곡선을 사용한 회전 수 계산; 각 그림의 음영 처리된 영역은 양의 회전 수를 가지고 있으며 원래의 다각형은 점선으로 표시된다.](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%209.png)

전통적인 쌍대 내부 오프셋 원시 오프셋 곡선을 사용한 회전 수 계산; 각 그림의 음영 처리된 영역은 양의 회전 수를 가지고 있으며 원래의 다각형은 점선으로 표시된다.

![내부 오프셋 다각형 구축 (원래 다각형 점선으로 표시)](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2010.png)

내부 오프셋 다각형 구축 (원래 다각형 점선으로 표시)

![외부 오프셋 다각형 구축 (원래 다각형 점선으로 표시)](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2011.png)

외부 오프셋 다각형 구축 (원래 다각형 점선으로 표시)

문제: 오프셋이 작은 경우 와인딩 숫자를 사용하면 잘 작동합니다. 그러나 더 큰 오프셋의 경우 양수의 와인딩 수를 가진 영역은 잘못된 결과를 제공할 수 있습니다.

제안된 해결책(당사 알고리즘):

- 내부 다각형의 오프셋을 만들 때:
    - 가장자리는 법선의 반대 방향으로 오프셋됩니다.
    - 오목한 정점은 공유 정점을 중심으로 시계 방향 호를 사용하여 연결됩니다.
    - 볼록한 정점은 호가 아닌 직선으로 연결됩니다.
- 외부 다각형의 경우:
    - 가장자리는 법선 방향으로 오프셋됩니다
    - 볼록한 정점은 호로, 오목한 정점은 직선으로 연결되는 정반대의 접근 방식을 취합니다.
    
    ![직사각형 영역과 부채꼴 영역의 정의](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2012.png)
    
    직사각형 영역과 부채꼴 영역의 정의
    
    ![회전 수 불변성. 에지 e1과 e2는 동일하지만 시각화를 위해 서로 조금 떨어뜨린다.](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2013.png)
    
    회전 수 불변성. 에지 e1과 e2는 동일하지만 시각화를 위해 서로 조금 떨어뜨린다.
    
- 원시 오프셋 커브와 관련된 각 영역의 와인딩 번호는 내부 및 외부 오프셋 폴리곤을 식별하는 데 도움이 됩니다.

알고리즘의 정확성:

- 오프셋 다각형은 부울 연산(기본적으로 도형 결합)을 사용하여 구성할 수 있습니다.
    
    ![불리언 뺄셈/덧셈 알고리즘 감소 우리의 회전 수 알고리즘으로](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2014.png)
    
    불리언 뺄셈/덧셈 알고리즘 감소 우리의 회전 수 알고리즘으로
    
- 주의해야 할 정의:
    - 가장자리 세그먼트의 직사각형 영역: 에지 세그먼트가 특정 방향으로 이동했을 때 포함되는 영역입니다.
    - 정점의 부채꼴 영역: 정점과 정점의 오프셋 점을 연결하는 호에 의해 형성된 영역입니다.
- 내부 오프셋:
    - 내부 오프셋 다각형은 원래 다각형에서 경계에 가까운 점을 제거하여 결정할 수 있습니다.
    - 권선수를 고려하면 권선수가 양수인 영역의 경계가 내부 오프셋 다각형이 됩니다.
- 외부 오프셋:
    - 부울 합집을 사용하여 구성됩니다. 이 개념은 내부 오프셋과 유사하지만 영역을 제거하는 대신 추가하는 데 중점을 둡니다.
    - 양수 권선 수를 가진 영역의 경계는 외부 오프셋 폴리곤을 제공합니다.
- 효율성 개선:
    - 모양은 같지만 방향이 반대인 가장자리를 무시함으로써 알고리즘의 효율성을 높일 수 있습니다.
    - 이렇게 하면 필요한 계산이 줄어들어 알고리즘이 더 빨라지고 공간도 덜 차지합니다.

본질적으로 이 작업은 와인딩 넘버 접근법을 영리하게 활용하고 필요한 계산 횟수를 줄임으로써 오프셋 다각형을 결정하는 더 효율적인 방법을 소개합니다.

### 5 Implementation, Analysis and Results

구현 세부 사항:

- 프로그램 기반: OpenGL의 확장판인 GLU 1.3 시스템을 기반으로 프로그램을 구축했습니다.
- 주요 작업: 이 프로그램은 도형(다각형)을 처리하고 세부 출력을 제공합니다(테셀레이션).

특징:

- 프로그램이 도형의 내부와 외부를 구분할 수 있도록 설정했습니다.
- 이 프로그램은 도형이 서로 교차하는 위치를 처리할 수 있습니다.
- 또한 도형의 일부 처리를 시작하거나 완료할 때 알려줍니다.
- 처리하기 전에 입력 도형에 결함이 있는지 확인하고 수정하여 정확성을 보장합니다.
    
    ![예제, 원래의 다각형은 (더 어두운) 파란색이며 오프셋 다각형은 (더 밝은) 빨간색; 각 예제의 축 정렬 경계 상자의 치수는 괄호 안에 표시된다.](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2015.png)
    
    예제, 원래의 다각형은 (더 어두운) 파란색이며 오프셋 다각형은 (더 밝은) 빨간색; 각 예제의 축 정렬 경계 상자의 치수는 괄호 안에 표시된다.
    
    ![견고성 비교: ACIS 내부 오프셋 및 우리 알고리즘의 내부 오프셋](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2016.png)
    
    견고성 비교: ACIS 내부 오프셋 및 우리 알고리즘의 내부 오프셋
    

성능 분석:

- 시간 및 공간 사용량: 두 가지 주요 단계가 있습니다. 첫 번째 단계는 도형의 세그먼트 수에 비례하는 시간과 공간이 소요됩니다. 두 번째 단계는 더 복잡하지만 대략 도형의 모서리와 교차점 수를 기반으로 합니다.
- 검증: 프로그램이 메모리와 시간을 어떻게 사용하는지 검증했습니다. 결과는 설계를 기반으로 예상한 것과 일치했습니다.

기존 소프트웨어(ACIS)와 비교:

- 속도: 저희 프로그램은 많은 상용 소프트웨어 패키지가 사용하는 ACIS 도구보다 30~150배 더 빠르게 작동합니다.
- 정확성: ACIS 도구는 특히 복잡한 모양을 처리할 때 신뢰할 수 있는 결과를 생성하지 못하는 몇 가지 문제를 발견했습니다. 반면에 저희 프로그램은 일관되게 정확한 결과를 제공했습니다.
- 일관성: ACIS는 때때로 비슷한 작업에 대해 다른 결과를 제공했습니다. 우리 프로그램은 단일 수학적 접근 방식을 고수하여 결과가 일관적이었습니다.
    
    ![오프셋 다각형의 정의의 일관성](POLYGON%20OFFSETTING%20BY%20COMPUTING%20WINDING%20NUMBERS%20e9d49424a70c406bb6b494954361fe0e/Untitled%2017.png)
    
    오프셋 다각형의 정의의 일관성
    

본질적으로 우리는 기존 상용 도구보다 효율적이고 빠르며 안정적으로 도형을 처리하고 분석하는 프로그램을 개발했습니다.

### 6 Conclusion

빠르고 정확하며 사용하기 매우 간단한 도형(폴리곤) 처리 방법을 만들었습니다. 이 방법은 GLU 테셀레이터라는 무료 도구를 활용합니다. 많은 양의 데이터를 처리할 때 도형의 모서리와 교차점 수에 따라 공간을 사용하여 매우 효율적으로 수행합니다. 이 방법은 서로 겹치거나 교차하는 복잡한 도형이 주어지더라도 일관되고 잘 정의된 결과를 제공합니다. 간단히 말해, 도형을 다루고 이해하기 위한 신뢰할 수 있는 도구입니다.