# BlazePose: On-device Real-time Body Pose tracking

*이 논문에서는 건강 추적, 수화 인식, 제스처 제어와 같은 애플리케이션을 위해 이미지나 동영상에서 인체의 포즈를 추정하는 새로운 방법을 제시합니다. 제안된 모델은 감지 및 추적 알고리즘의 조합을 사용하여 얼굴과 같이 비교적 단단한 신체 부위를 먼저 감지한 다음 신체의 다양한 키포인트 위치를 예측합니다. 이 모델은 가볍고 휴대 전화에서 거의 실시간으로 작동하도록 설계되었습니다. 이 모델은 인체의 33개 키포인트를 사용하여 포즈를 추정하며, 기존의 여러 데이터 세트 및 네트워크와 호환됩니다. 이 모델의 성능은 일반적인 사용 사례에서는 OpenPose보다 약간 뒤처지지만, 요가/피트니스 추적 시나리오에서는 탁월하며 훨씬 빠르게 실행되므로 모바일 디바이스의 실시간 애플리케이션에 적합합니다.*

[https://arxiv.org/abs/2006.10204](https://arxiv.org/abs/2006.10204)

1. Introduction

텍스트는 이미지나 동영상에서 인체의 포즈를 추정하는 것에 관한 내용입니다. 이 기술은 건강 모니터링, 수화 인식, 컴퓨터나 게임 시스템에서의 제스처 제어 등 다양한 용도로 활용되고 있습니다. 하지만 이 작업은 다양한 신체 위치, 인체의 복잡성(즉, 수많은 자유도), 신체의 시야를 가릴 수 있는 요소(폐색) 등 많은 변수로 인해 까다로운 작업입니다.

최근 이 분야에서 상당한 진전이 있었습니다. 일반적으로 사용되는 접근 방식은 신체의 각 관절에 대한 히트맵을 생성하는 것입니다. 또한 이 방법은 각 좌표에 대한 오프셋을 세분화하여 예상 관절 위치를 보다 정확하게 조정합니다.

이 히트맵 방식은 여러 사람의 이미지를 효율적으로 처리할 수 있지만, 모바일 기기에서 실시간으로 사용하기에는 계산량이 너무 많다는 단점이 있습니다. 이 논문은 이 문제를 해결하고 품질 손실이 거의 없으면서도 더 빠른 버전의 모델을 구현했다고 주장합니다.

회귀 기반 접근 방식은 또 다른 기법입니다. 이 모델은 히트맵을 만드는 대신 각 관절의 평균 좌표를 직접 예측하려고 합니다. 그러나 이 방법은 사람 포즈의 특정 복잡성이나 모호함으로 인해 종종 어려움을 겪습니다.

Newell 등의 이전 연구를 참조하여 저자는 딥러닝 모델의 일종인 '스택 모래시계' 아키텍처를 언급합니다. 이 모델은 더 적은 수의 파라미터로 포즈를 예측하는 데 성공하여 계산 부담이 적습니다.

저자들은 이 아이디어를 기반으로 모든 관절의 히트맵을 먼저 예측한 다음 모델의 다른 부분을 사용하여 모든 관절의 직접 좌표를 예측하는 네트워크를 사용하고 있습니다. 이 작업에서 중요한 부분은 모델을 실제로 사용하는 동안 히트맵 섹션을 제거할 수 있어 휴대폰에서 실시간으로 사용할 수 있을 정도로 가벼워졌다는 점입니다.

2. Model Architecture and Pipeline Design

2.1. 추론 파이프라인

예측을 하는 데 사용되는 프로세스를 추론 파이프라인이라고 합니다. 여기에는 감지와 추적의 두 단계가 포함됩니다. 먼저 가벼운 신체 포즈 감지기가 인체를 식별합니다. 그런 다음 포즈 트래커 네트워크가 특정 신체 부위의 위치, 사람이 현재 프레임에 있는지 여부, 프레임의 어느 영역에 초점을 맞출지 등 주요 세부 사항을 예측합니다. 트래커가 사람을 감지하지 못하면 다음 프레임에서 감지기가 다시 실행됩니다.

![Untitled](BlazePose%20On-device%20Real-time%20Body%20Pose%20tracking%20b1e82940fa68452fa7bd7bdb4ec5d176/Untitled.png)

2.2. 사람 검출기

많은 최신 객체 감지 방법은 비최대 억제(NMS)라는 알고리즘을 사용하여 최종 결과를 처리합니다. NMS는 딱딱한 물체에는 잘 작동하지만, 손을 흔들거나 포옹하는 등 사람의 복잡한 포즈에는 어려움을 겪습니다. 이러한 한계를 극복하기 위해 얼굴이나 몸통과 같이 상대적으로 딱딱한 신체 부위를 감지하는 데 초점을 맞춥니다. 얼굴은 사람의 위치를 나타내는 가장 강력한 신호인 경우가 많기 때문에 빠른 온디바이스 얼굴 감지기를 사용하여 사람을 식별합니다. 이 얼굴 감지기는 또한 사람의 추가 정렬 매개 변수를 예측합니다.

2.3. 토폴로지

저자들은 새로운 토폴로지, 즉 인체의 점을 구성하는 방법을 소개합니다. 이 토폴로지는 33개의 포인트를 포함하며 다른 모델에서 사용하는 포인트를 조합한 것입니다: 블레이즈페이스, 블레이즈팜, 코코입니다. 이 토폴로지는 얼굴, 손, 발에 있는 최소한의 키포인트만 사용하여 관심 영역의 회전, 크기 및 위치를 추정합니다.

![Untitled](BlazePose%20On-device%20Real-time%20Body%20Pose%20tracking%20b1e82940fa68452fa7bd7bdb4ec5d176/Untitled%201.png)

2.4. 데이터 세트

저자는 특정 데이터 세트를 사용하여 모델을 훈련합니다. 히트맵을 사용하는 다른 포즈 추정 모델과 달리, 이 트래커는 초기 포즈 정렬이 필요합니다. 데이터 세트는 사람 전체가 보이거나 엉덩이와 어깨와 같은 주요 지점에 확실하게 주석을 달 수 있는 이미지로 제한합니다. 모델이 오클루전을 처리할 수 있는지 확인하기 위해 훈련 중에 오클루전을 시뮬레이션합니다. 훈련 데이터 세트는 한 명 또는 소수의 사람이 일반적인 포즈를 취하고 있는 6만 개의 이미지와 한 사람이 피트니스 운동을 하고 있는 2만 5천 개의 이미지로 구성되어 있습니다.

2.5. 신경망 아키텍처

저자들은 파이프라인의 첫 번째 단계에서 제공한 정렬 제안을 사용하여 33개 키포인트의 위치를 모두 예측하도록 시스템을 설계했습니다. 이 모델은 히트맵, 오프셋, 회귀 접근법을 결합하여 사용합니다. 훈련 중에는 히트맵과 오프셋 손실을 사용하지만 추론 중에는 모델에서 이러한 레이어를 제거합니다. 이러한 방식으로 히트맵을 사용하여 경량 임베딩을 학습한 다음 회귀 인코더 네트워크에서 사용합니다. 또한 네트워크의 모든 단계 간에 건너뛰기 연결을 사용하여 높은 수준의 특징과 낮은 수준의 특징의 균형을 맞춥니다.

![Untitled](BlazePose%20On-device%20Real-time%20Body%20Pose%20tracking%20b1e82940fa68452fa7bd7bdb4ec5d176/Untitled%202.png)

2.6. 정렬 및 오클루전 증강

저자들은 솔루션의 필수적인 부분인 포즈 프리를 소개합니다. 이들은 훈련 시 데이터를 증강하고 준비하는 동안 의도적으로 각도, 스케일 및 이동 범위를 제한합니다. 이를 통해 네트워크의 속도와 리소스 소비를 줄일 수 있습니다. 엉덩이 사이의 지점이 t로 전달된 정사각형 이미지의 중앙에 위치하도록 사람을 정렬합니다.

![Untitled](BlazePose%20On-device%20Real-time%20Body%20Pose%20tracking%20b1e82940fa68452fa7bd7bdb4ec5d176/Untitled%203.png)

3. Experiments

저자들은 자신들의 모델(BlazePose)과 기존의 다른 포즈 추정 모델(OpenPose)의 성능을 비교하고 있습니다. 이들은 각각 1,000개의 이미지로 구성된 두 개의 새로운 데이터 세트를 만들었습니다. 한 데이터 세트인 AR 데이터 세트에는 실제 시나리오에서 촬영한 다양한 포즈가 포함되어 있으며, 다른 데이터 세트는 요가 또는 피트니스 포즈에 중점을 두고 있습니다.

모델을 평가하기 위해 17개의 포인트를 포함하는 MS Coco 토폴로지를 기반으로 OpenPose와 BlazePose에 공통으로 사용되는 키포인트(특정 신체 부위)의 하위 집합을 사용합니다. 성능을 비교하기 위해 사용하는 측정값은 20% 허용 오차 범위의 정확한 키 포인트 비율입니다(PCK@0.2). 이는 각 모델이 키포인트의 위치를 얼마나 정확하게 예측하는지를 측정합니다. 키포인트의 예상 위치가 사람의 몸통 크기와 비교하여 실제 위치에서 20% 이상 벗어나지 않으면 키포인트가 올바르게 예측된 것으로 간주합니다.

블레이즈포즈 모델은 AR 데이터 세트에서 오픈포즈보다 정확도가 약간 떨어지지만 요가/피트니스 데이터 세트에서는 더 나은 성능을 보인다는 사실을 발견했습니다. 연구팀은 계산 복잡도와 매개변수 수준이 각각 다른 두 가지 버전의 모델, 즉 더 복잡한 버전(BlazePose Full)과 단순화된 버전(BlazePose Lite)을 훈련시켰습니다.

중요한 요소는 모델의 속도입니다. 정확도는 약간 떨어지지만, BlazePose 모델은 강력한 20코어 데스크톱 CPU에서 OpenPose가 실행되는 것보다 중간급 휴대폰 CPU에서 25~75배 더 빠르게 실행됩니다. 이러한 속도 이점은 증강 현실(AR)이나 모바일 앱과 같이 포즈 추정을 빠르게 수행해야 하는 실시간 애플리케이션에 매우 중요합니다.

4. Applications

저자들은 한 사람의 사람 포즈 추정을 위해 특별히 설계된 이 새로운 모델을 모바일 기기에서 작동하도록 만들었습니다. 수화 통역, 요가 또는 피트니스 추적, 증강 현실(AR)과 같이 고성능이 요구되는 용도를 지원하기 위한 것이었습니다. 이 모델은 모바일 기기의 CPU에서 거의 실시간으로 실행할 수 있으며, 모바일 GPU에서는 더 빠르게(초실시간) 실행할 수 있습니다.

이 모델의 33개 키포인트 토폴로지는 블레이즈페이스 및 블레이즈팜과 일치하므로 손 포즈와 얼굴 지오메트리를 추정하는 다른 모델의 기초로 사용할 수 있습니다.

이 접근 방식은 더 많은 키포인트, 3D 지원 및 추가 키포인트 속성과 같은 다른 기능에 쉽게 적용할 수 있도록 설계되었습니다. 히트맵이나 오프셋 맵에 의존하지 않기 때문에 새로운 유형의 피처마다 성능과 확장성에 병목 현상을 일으킬 수 있는 고해상도 레이어가 추가로 필요하지 않습니다.

- 요약
    
    소개 및 문제 정의: 저자는 건강 추적, 수화 인식, 제스처 제어와 같은 애플리케이션을 위해 이미지나 동영상에서 인체의 포즈를 추정하는 것이 얼마나 어려운지 설명합니다. 또한 복잡성과 계산 요구 사항으로 인해 휴대폰의 실시간 애플리케이션에 적합하지 않은 점 등 기존 방법의 한계에 대해 언급합니다.
    
    추론 파이프라인: 검출기-트래커 설정을 사용하는 방법을 소개합니다. 이 파이프라인에는 가벼운 신체 포즈 감지기와 포즈 트래커 네트워크가 포함됩니다. 트래커는 키포인트 좌표와 현재 프레임에 사람이 있는지 여부를 예측합니다. 사람이 감지되지 않으면 다음 프레임에서 검출기 네트워크가 실행됩니다.
    
    사람 검출기: 저자들은 프레임에서 사람을 감지하는 솔루션을 설명합니다. 복잡한 포즈를 취할 수 있는 몸 전체를 감지하는 대신 얼굴이나 몸통과 같이 비교적 단단한 신체 부위를 감지하는 데 중점을 둡니다. 이들은 빠른 온디바이스 얼굴 감지기를 사람 감지기의 프록시로 사용합니다.
    
    토폴로지: 기존의 여러 데이터 세트 및 네트워크와 일치하는 인체의 33개 지점으로 구성된 새로운 토폴로지를 제시합니다. 선택한 키포인트는 사람의 회전, 크기, 위치를 추정하기에 충분합니다.
    
    데이터 세트: 일반적인 포즈와 피트니스 운동을 하는 한 명 또는 소수의 사람 이미지에 사람이 주석을 단 훈련 데이터 세트의 생성에 대해 설명합니다.
    
    신경망 아키텍처: 저자가 히트맵, 오프셋, 회귀 접근법을 결합한 신경망의 아키텍처를 소개합니다. 추론 중에 히트맵 분기를 버릴 수 있어 휴대폰에서 실행할 수 있을 만큼 가벼운 모델을 만들 수 있습니다.
    
    정렬 및 오클루전 증강: 모델이 정렬 및 오클루전 문제를 처리하는 데 도움이 되는 포즈 사전 및 데이터 증강 기법의 사용법을 자세히 설명합니다. 훈련 중에 오클루전을 시뮬레이션하고 포인트별 가시성 분류기를 도입하여 특정 포인트가 가려졌는지 여부를 표시합니다.
    
    평가: 저자들은 주석이 달린 이미지의 두 데이터 세트를 사용하여 OpenPose에 대해 모델을 평가합니다. PCK@0.2 메트릭을 사용하여 성능을 측정합니다. 한 데이터 세트에서는 모델의 성능이 약간 떨어지지만, 다른 데이터 세트에서는 OpenPose보다 성능이 뛰어나며 실시간 애플리케이션에 매우 중요한 훨씬 더 빠른 성능을 보여줍니다.
    
    결론: 저자는 이 모델의 장점인 모바일 디바이스에서의 실시간에 가까운 성능, 다른 포즈 추정 모델(BlazeFace 및 BlazePalm)과의 일관성, 추가 계산 리소스 없이도 추가 키포인트, 3D 지원 및 키포인트 속성을 지원할 수 있는 확장성을 강조하며 결론을 맺습니다.
    
    전반적으로 이 백서에서는 성능, 속도, 계산 효율성의 균형을 맞추는 새로운 인체 포즈 추정 접근 방식을 제안하여 모바일 장치의 실시간 애플리케이션에 적합합니다.
    
- Non-Maximum Suppression (NMS)
    
    비최대 억제(NMS)는 주로 객체 감지를 위해 여러 컴퓨터 비전 작업에 사용되는 기술입니다. NMS의 목적은 감지 알고리즘이 이미지의 객체 주위에 생성할 수 있는 겹치는 바운딩 박스의 수를 줄이는 것입니다.
    
    좀 더 자세히 살펴보겠습니다:
    
    객체 감지 알고리즘은 이미지에서 객체의 실제 위치를 중심으로 여러 개의 후보 바운딩 박스를 생성하는 경우가 많습니다. 이러한 상자는 종종 겹치는 경우가 많으며 모든 상자를 유지하는 것은 비효율적이고 혼란스럽습니다.
    
    비최대 억제 기능은 상자 간의 겹침 정도를 비교하여 점수가 높은 상자와 겹치는 부분이 큰 상자를 제거함으로써 도움을 줍니다.
    
    먼저 신뢰도 점수, 즉 모델이 해당 경계 상자 내의 객체를 감지했다고 확신하는 정도를 기준으로 모든 후보 경계 상자를 정렬합니다.
    
    가장 높은 점수를 받은 상자부터 시작하여 NMS는 다른 모든 상자와 비교하고 두 상자 간의 중첩을 측정하는 IoU(Intersection over Union)를 계산합니다.
    
    두 상자의 IoU가 특정 임계값을 초과하면 신뢰도 점수가 낮은 상자는 제외, 즉 폐기됩니다.
    
    이 프로세스는 모든 상자가 유지되거나 폐기될 때까지 모든 상자를 나머지 모든 상자와 비교하면서 계속됩니다.
    
    이렇게 함으로써 NMS는 각 객체가 하나의 경계 상자(신뢰 점수가 가장 높은 상자)로 표시되도록 하고 겹치는 상자의 혼란을 제거하여 객체 감지 알고리즘의 출력을 더 깔끔하고 해석하기 쉽게 만듭니다.
    
- 33 Keypoint
    
    ![Untitled](BlazePose%20On-device%20Real-time%20Body%20Pose%20tracking%20b1e82940fa68452fa7bd7bdb4ec5d176/Untitled%204.png)
    
- 정렬과 오클루전
    
    정렬:
    
    정렬은 이미지에서 인물과 키포인트가 어떻게 배치되는지를 나타냅니다. 정확한 예측을 위해 연구진은 훈련 단계에서 프레임 내에서 인물을 정확하게 정렬하는 방법을 개발했습니다.
    
    감지 단계 또는 이전 프레임의 키포인트를 기반으로 신경망 입력으로 전달된 정사각형 이미지의 중앙에 엉덩이 사이의 중간 지점이 오도록 사람의 위치를 지정했습니다.
    
    그리고 회전을 엉덩이 중간점과 어깨 중간점 사이의 선으로 계산하고 이 선이 Y축과 평행이 되도록 이미지를 회전시켰습니다.
    
    모든 신체 지점이 신체를 둘러싸는 정사각형 경계 상자 안에 들어가도록 이미지의 배율을 조정했습니다. 또한 트래커가 프레임 사이의 신체 움직임과 왜곡된 정렬을 처리할 수 있도록 10%의 스케일과 시프트 증강을 적용했습니다.
    
    오클루전 증강:
    
    오클루전은 이미지에서 신체 일부가 가려지거나 숨겨져 모델이 그 위치를 예측하기 어려운 경우를 말합니다.
    
    저자들은 모델이 오클루전을 처리할 수 있도록 다양한 색상의 무작위 직사각형을 이미지에 삽입하여 훈련 중에 오클루전을 시뮬레이션했습니다. 이를 통해 신체 일부가 가려진 경우에도 포즈를 예측할 수 있도록 모델을 학습시켰습니다.
    
    또한 포인트별 가시성 분류기를 도입했습니다. 이 분류기는 특정 지점이 가려졌는지 여부와 해당 지점에 대한 위치 예측이 부정확할 가능성이 있는지를 나타냅니다. 이를 통해 상체만 보이거나 사람의 신체 대부분이 장면에서 벗어난 경우와 같이 심각한 가려짐이 있는 경우에도 모델이 지속적으로 사람을 추적할 수 있습니다.
    
- 신경망 아키텍쳐
    
    이 연구에서 포즈 추정에 사용된 신경망 아키텍처는 사람의 33개 키포인트 위치를 모두 예측하도록 설계되었습니다. 히트맵, 오프셋, 회귀를 통합하는 복합적인 접근 방식을 사용합니다.
    
    히트맵 기반 접근 방식: 이는 네트워크가 각 관절 또는 키포인트에 대한 히트맵을 생성하는 방법을 학습하는 포즈 추정에서 흔히 사용되는 기법입니다. 히트맵에서 가장 높은 강도의 지점은 조인트의 위치를 나타냅니다. 그러나 이러한 히트맵은 이 접근 방식에서 훈련 단계에서만 사용되며 추론을 실행하기 전에 제거됩니다.
    
    오프셋: 히트맵과 함께 오프셋(히트맵에서 가장 높은 강도 지점에서 실제 키포인트까지의 거리)도 계산되고 구체화됩니다.
    
    회귀: 네트워크는 각 관절 또는 키포인트의 평균 좌표값을 직접 예측하는 방법도 학습합니다.
    
    네트워크의 아키텍처는 작은 인코더-디코더 네트워크(모든 관절의 히트맵을 예측하는 데 사용)와 회귀 인코더 네트워크(모든 관절의 좌표로 직접 회귀하는 데 사용)의 스택으로 구성됩니다. 이 접근 방식은 Newell 등의 스택 모래시계 아키텍처에서 영감을 얻었지만, 저자들은 특정 요구 사항에 맞게 조정했습니다.
    
    저자들은 네트워크의 모든 단계 간에 건너뛰기 연결을 활용하여 상위 수준과 하위 수준 기능 간의 균형을 유지했습니다. 이러한 건너뛰기 연결을 통해 이전 계층에서 이후 계층으로(또는 그 반대로) 정보가 직접 이동할 수 있으므로 네트워크가 더 복잡한 패턴을 학습하는 데 도움이 될 수 있습니다.
    
    그러나 회귀 인코더의 그라데이션은 히트맵으로 학습된 피처로 다시 전파되지 않습니다. 이는 아키텍처 다이어그램에서 그라디언트 중지 연결로 표시됩니다. 저자는 이를 통해 히트맵 예측이 개선되었을 뿐만 아니라 좌표 회귀 정확도도 크게 향상되었다는 사실을 발견했습니다.
    
    따라서 이 아키텍처는 히트맵을 효과적으로 사용하여 경량 임베딩을 감독한 다음 회귀 인코더 네트워크에서 이를 활용합니다.