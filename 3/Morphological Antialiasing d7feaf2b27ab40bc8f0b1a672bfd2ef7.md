# Morphological Antialiasing

[http://www.cs.cmu.edu/afs/cs/academic/class/15869-f11/www/readings/reshetov09_mlaa.pdf](http://www.cs.cmu.edu/afs/cs/academic/class/15869-f11/www/readings/reshetov09_mlaa.pdf)

- August 2009

![페어리 포레스트 모델: 형태학적 안티에일리어싱은 성능에 눈에 띄는 영향을 주지 않으면서 렌더링 된 이미지의 품질을 향상시킵니다.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled.png)

페어리 포레스트 모델: 형태학적 안티에일리어싱은 성능에 눈에 띄는 영향을 주지 않으면서 렌더링 된 이미지의 품질을 향상시킵니다.

### 1 INTRODUCTION

사람의 눈에는 수많은 광수용체가 있지만 세상을 픽셀 단위로 보지 못합니다. 흥미롭게도 망막에 있는 색 감지 원추의 수는 개인마다 크게 다를 수 있습니다. 하지만 대부분의 사람들이 비슷하게 색을 인식한다는 것은 우리의 뇌가 시각에 중요한 역할을 한다는 것을 의미합니다. 또한 인간의 시각은 물체의 정렬을 매우 정밀하게 감지할 수 있습니다. 이러한 민감성 때문에 시각 자료에서 색상 오류보다 작은 공간 오류를 더 잘 알아챕니다.

이러한 점을 인식한 그래픽 하드웨어 개발자는 때때로 색상 정확도를 희생하여 이러한 공간적 부정확성을 개선하는 것을 목표로 합니다. 색상을 혼합하여 이러한 공간 오류를 줄이는 기술이 개발되었습니다. 디스플레이 해상도를 높이면 결국 이러한 문제를 해결할 수 있지만, 레이 트레이싱과 같은 특정 그래픽 기술의 경우 해상도를 높이는 것은 비효율적일 수 있습니다. 1980년 휘트가 제안한 방법과 같은 일부 방법은 필요할 때만 추가 광선을 투사하여 이 프로세스를 최적화하는 것을 목표로 합니다.

여러 연구자들이 다양한 기법을 사용하여 픽셀 내부의 색상 변화를 추정하여 이미지 품질을 개선하려고 시도했습니다. 일부는 물체의 가장자리에서 색상 오류가 가장 두드러진다는 관찰에 초점을 맞췄습니다. 렌더링된 이미지에서 이러한 가장자리를 개선하기 위한 기법이 개발되었습니다.

한 가지 중요한 인사이트는 많은 시각적 요소가 단일 픽셀에 모일 때 종종 흐릿한 평균 색상으로 혼합된다는 것입니다. 이 효과는 레오나르도 다빈치가 사용한 '스푸마토'라는 회화 기법에 비유할 수 있는데, 테두리가 흐릿하게 보입니다.

이 논문에서는 이미지에서 특정 패턴을 식별한 다음 그 주변의 색상을 혼합하여 공간 오류(앤티앨리어싱)를 줄이는 새로운 기법을 소개합니다. 컴퓨터 비전 알고리즘에서 영감을 얻은 이 방법은 형태학적 앤티앨리어싱(MLAA)이라고 하는데, 다양한 렌더링 방식에 사용할 수 있고 렌더링 프로세스 자체와는 완전히 분리되어 있다는 점에서 독특합니다. MLAA는 특히 효율적이며 수백만 개의 픽셀을 빠르게 처리할 수 있습니다. 또한 유휴 스레드를 활용하여 멀티코어 머신에서 성능을 극대화하도록 설계되었습니다.

### 2 MORPHOLOGICAL ANTIALIASING

형태학적 앤티앨리어싱(MLAA)은 추가 광선을 생성할 필요 없이 앨리어싱이라고 하는 이미지 왜곡을 줄이기 위해 만들어진 방법입니다. 이 프로세스는 크게 세 단계로 나눌 수 있습니다:

- 불연속성 식별: 이 단계에서는 이미지의 픽셀 간 불일치 또는 변화를 감지합니다.
- 패턴 인식: 시스템이 미리 정의된 특정 패턴을 검색합니다.
- 색상 혼합: 식별된 패턴을 중심으로 색상을 조화롭게 혼합하여 왜곡을 최소화합니다.

2.1 단단한 그림자 블렌딩

하드 섀도를 위한 바이너리 MLAA: 처음에 MLAA는 단순한 흑백 이미지를 사용하여 설명되며, 주로 딱딱한 그림자를 부드럽게 만드는 데 사용됩니다. 이 프로세스에는 대비되는 흑백 픽셀 사이의 경계를 구분하여 가장자리의 조각별 선형 근사치를 구하는 작업이 포함됩니다. 예를 들어, 텍스트에 표시된 가상의 이미지에서 흑백 픽셀 사이의 수직선 또는 수평선과 같은 구분선이 식별됩니다. 이러한 분리선은 패턴을 Z자형, U자형, L자형으로 분류하는 데 도움이 되며, 블렌딩 프로세스에 도움이 됩니다.

![왼쪽의 원본 이미지에 표시된 일부 Z, U, 및 L 형태와 함께 흑백 이미지의 MLAA 처리.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%201.png)

왼쪽의 원본 이미지에 표시된 일부 Z, U, 및 L 형태와 함께 흑백 이미지의 MLAA 처리.

![블렌딩 가중치 계산. L-형태는 중간에 분할된 보조 가장자리 v0v1에 의해 형성되며, 주요 가장자리는 v1v2입니다. 블렌딩 가중치는 사다리꼴 영역으로 계산됩니다.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%202.png)

블렌딩 가중치 계산. L-형태는 중간에 분할된 보조 가장자리 v0v1에 의해 형성되며, 주요 가장자리는 v1v2입니다. 블렌딩 가중치는 사다리꼴 영역으로 계산됩니다.

블렌딩 알고리즘: 알고리즘이 L자형 패턴을 식별하면 픽셀 조각의 면적을 고려하여 특정 공식을 사용하여 블렌딩 가중치를 계산하여 새로운 색상을 결정합니다. 이 접근 방식은 근사치이기는 하지만 이미지를 매끄럽게 하고 원치 않는 선명한 변화를 줄이는 경향이 있습니다. 중요한 차이점은 하드 섀도우에 적용할 때 MLAA는 추가 정보가 필요할 수 있는 다른 기법과 달리 이미지 데이터만을 기반으로 근사치를 생성한다는 점입니다.

비교 분석: MLAA는 이미지 데이터만을 기반으로 그림자 실루엣을 근사화하기 위해 노력하지만, 실루엣 맵과 같은 다른 방법은 최종 이미지 해상도에 맞게 조정하기 전에 여러 기술을 조합하여 실루엣 에지를 도출합니다. 이 때문에 단일 픽셀에 여러 실루엣 에지가 겹칠 경우 불일치가 발생할 수 있습니다. 하지만 MLAA는 이러한 왜곡을 줄여 보다 부드러운 이미지 표현을 보장하는 데 중점을 둡니다.

2.2 컬러 이미지 처리

- 불연속성을 찾는 데는 색상 차이 또는 기하학적 또는 재질 기반 정보가 사용될 수 있습니다.
- 색상 차이를 사용하면 효율성이 높다는 장점이 있지만, 특히 텍스처가 명백한 색상 차이를 만드는 경우 항상 정확하지는 않을 수 있습니다.
- 이 논문에서는 색상 차이를 결정하는 임계값 기반 접근 방식을 사용합니다.
- 블렌딩 표현식은 색상의 숫자 값에 따라 변경되지 않으며 이미지에서 채널별(R, G, B)로 적용될 수 있습니다.
- 패턴 간의 부드러운 전환을 위한 엄격한 규칙이 있습니다. 선형 방정식을 사용하여 블렌딩 매개변수를 결정합니다.
- 설정된 기준에 따라 패턴을 수락하거나 거부하여 부드러운 전환을 보장하고 불필요한 계산을 줄입니다.

![두 형태를 함께 연결하기. 스티칭 위치에서의 색상 차이를 최소화하기 위해 알려지지 않은 높이 hc와 hd를 선택합니다.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%203.png)

두 형태를 함께 연결하기. 스티칭 위치에서의 색상 차이를 최소화하기 위해 알려지지 않은 높이 hc와 hd를 선택합니다.

2.3 텍스처

- 이미지의 텍스처는 이미지 자체의 일부로 취급됩니다.
- 픽셀 간 색상 차이가 큰 텍스처의 경우 밉매핑과 유사하게 블렌딩이 발생할 수 있습니다.
- MLAA 기법은 불연속성 수준에 따라 블렌딩할 픽셀을 선택하는 것으로 보이며, 이는 피사체와의 거리에 따라 달라질 수 있습니다.

2.4 최적화

- 색상 불연속성을 검색하는 MLAA의 첫 번째 단계는 모든 픽셀에 대해 실행되므로 효율적인 SSE(스트리밍 SIMD 확장)를 구현할 수 있습니다.
- 주어진 코드는 SSE2 명령어를 사용하여 RGBA 값을 비교하는 함수를 보여줍니다.
- MLAA 단계의 특성상 최신 GPU 아키텍처의 이점을 활용할 수 있으며, 이 논문은 최적화된 성능을 위해 알고리즘을 포팅할 수 있는 가능성을 암시합니다.

### 3 MLAA LIMITATIONS

픽셀 크기의 특징을 처리할 수 없음:

- MLAA는 픽셀 크기 정도의 매우 미세한 디테일을 처리하는 데 어려움을 겪습니다.
- 예를 들어, 매우 좁지만 여러 픽셀에 걸쳐 있는 길쭉한 쿼드는 MLAA로 처리할 수 있습니다. 그러나 더 멀리 떨어져 있고 더 압축된 이미지의 경우, MLAA는 뚜렷한 특징을 식별할 수 없어 일종의 기하학적 에일리어싱인 모아레 패턴이 발생합니다.
- 마찬가지로 MLAA는 필터링되지 않은 텍스처에서는 어려움을 겪을 수 있지만, 밉매핑은 이러한 텍스처를 효과적으로 필터링할 수 있습니다.

기하학적 에일리어싱:

- 이는 작거나 얇은 오브젝트뿐만 아니라 큰 오브젝트 사이의 간격을 통과하는 광선이 거의 없을 때도 발생할 수 있습니다.
- 레이 트레이싱과 관련된 또 다른 에일리어싱 문제는 셰이딩 노멀을 사용할 때 발생합니다. 들어오는 광선과 기하학적 노멀 사이의 각도가 π/2에 가까우면 셰이딩 노멀의 경우 각도가 π/2를 초과하여 반사광의 방향이 잘못 지정될 수 있습니다. 이로 인해 일부 픽셀에 에일리어싱 효과가 발생할 수 있습니다.

고립된 픽셀의 문제:

- 고립된 픽셀은 여러 모양에 포함될 수 있으므로 일반적으로 MLAA 패스 후에 블렌딩됩니다.
- 이러한 고립된 픽셀을 식별하고 추가 블렌딩을 적용할 수는 있지만, 다양한 주파수의 간섭으로 인해 구조가 있는 것처럼 보이는 특정 모아레 패턴을 해결하지 못할 수 있습니다.

테두리 픽셀 처리:

- 완전한 주변 정보를 항상 사용할 수 있는 것은 아니기 때문에 MLAA는 가장자리 픽셀을 효율적으로 처리하지 못할 수 있습니다.
- 이는 픽셀당 단일 샘플에 의존하는 적응형 기술에서 흔히 발생하는 문제입니다.

프레임 간 전환이 매끄럽지 않음:

- MLAA는 재구성을 위해 이미지 데이터에만 의존하기 때문에 미묘한 변화가 있는 장면에서는 프레임 간에 매끄럽지 않은 전환이 나타날 수 있습니다.
- 이 문제는 카메라나 물체가 픽셀 크기보다 느린 속도로 움직이는 경우 발생할 수 있습니다. 그러나 해상도가 200x200픽셀을 초과하는 이미지의 경우 일반적으로 이 문제는 눈에 띄지 않습니다.
- 컬러 이미지의 경우 두 프레임의 모양 세트가 동일하더라도 블렌딩 계수가 색상 값에 따라 달라지기 때문에 MLAA 결과가 달라질 수 있습니다. 이러한 변화는 서브 픽셀 움직임을 어느 정도 포착할 수 있습니다.

텍스트 처리:

- MLAA는 전경과 배경을 구분하지 않기 때문에 텍스트가 왜곡될 수 있습니다.
- 이러한 왜곡은 원본 글꼴에 이미 앤티앨리어싱이 적용된 경우 특히 두드러집니다.

![상단 행: 비트맵 폰트; 두 번째 행: 트루타입 폰트 (안티에일리어싱 처리됨), 세 번째 행: 비트맵 폰트의 MLAA 처리; 네 번째 행: 트루타입 폰트의 MLAA 처리. 왼쪽에서 오른쪽으로 폰트 크기: 24, 12, 8, 6.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%204.png)

상단 행: 비트맵 폰트; 두 번째 행: 트루타입 폰트 (안티에일리어싱 처리됨), 세 번째 행: 비트맵 폰트의 MLAA 처리; 네 번째 행: 트루타입 폰트의 MLAA 처리. 왼쪽에서 오른쪽으로 폰트 크기: 24, 12, 8, 6.

기본적으로 MLAA는 앤티 앨리어싱에 장점이 있지만, 특히 매우 미세한 디테일, 기하학적 앨리어싱, 고립된 픽셀 및 텍스트를 처리할 때는 그 한계를 인식하는 것이 중요합니다.

### 4 COMPARISON WITH SUPERSAMPLING

설정:

- 단일 하프 플레인으로 구성된 모델을 렌더링했습니다. 6개의 픽셀이 흰색(위)과 검은색(아래) 영역 사이의 경계를 나타냅니다.
- 각 픽셀이 차지하는 영역을 분석적으로 결정하고 MLAA 및 두 가지 슈퍼샘플링 기법(픽셀당 4배 및 16배 샘플)과 비교했습니다.

정확도 및 추정:

- 모든 기법은 약 15%의 정확도로 픽셀 커버리지 영역을 추정했습니다.
- MLAA 기법은 바람직하지 않은 주파수를 도입하지 않고 선형 추정치를 생성했습니다. 반면, 분리선이 검은색 화살표로 표시된 두 간격과 교차하는 이미지의 경우 MLAA는 동일한 추정치를 생성합니다. 이 동작은 MLAA가 정확한 로컬 정확도보다 일관된 글로벌 실루엣 근사치를 우선시한다는 것을 의미합니다. 이러한 절충으로 인해 MLAA는 다양한 형태적 형태에 걸쳐 추정치를 연결합니다.

![검은색과 흰색 영역을 구분하는 6픽셀 샘플링 (픽셀 당 2x2 샘플이 표시됨). 하단 이미지: Z-형태는 녹색 선으로 둘러싸여 있으며, 빨간 선은 “진정한” 실루엣 가장자리의 MLAA 재구성을 보여줍니다. MLAA 재구성은 두 검은색 화살표 끝 간격을 교차하는 모든 “진정한” 곡선에 대해 동일할 것입니다.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%205.png)

검은색과 흰색 영역을 구분하는 6픽셀 샘플링 (픽셀 당 2x2 샘플이 표시됨). 하단 이미지: Z-형태는 녹색 선으로 둘러싸여 있으며, 빨간 선은 “진정한” 실루엣 가장자리의 MLAA 재구성을 보여줍니다. MLAA 재구성은 두 검은색 화살표 끝 간격을 교차하는 모든 “진정한” 곡선에 대해 동일할 것입니다.

Z형 관찰:

- 반평면 실루엣이 거의 수평에 가까운 뷰의 경우, 이 실루엣은 24픽셀에 걸쳐 Z자형 패턴으로 나타납니다.
- 2x2 샘플링 전략을 사용하면 상당한 면적 추정 오류가 발생합니다. 그러나 길쭉한 Z자 모양이 실제 이미지의 변동성을 최소화하기 때문에 MLAA 기법은 이러한 시나리오에 적합합니다. 이 경우 MLAA와 동일한 품질을 얻으려면 8x8 슈퍼샘플링 기법이 필요합니다.

![24 픽셀 샘플링.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%206.png)

24 픽셀 샘플링.

샘플링 분산:

- 이 예는 균일한 샘플링이 분산 감소에 가장 효과적인 방법이 아니라는 사실을 강조합니다.
- 전역 조명 기법은 종종 비균일 샘플링 패턴을 사용하지만, 레이 트레이싱 애플리케이션에서 안티 에일리어싱에 사용되는 경우는 드뭅니다. 하지만 하드웨어 가속 래스터화에서는 흔히 사용됩니다.
- 특히 레이 트레이싱에 스토캐스틱 샘플링을 사용한 초기 사례는 1985년 디페와 볼드의 작업에서 찾을 수 있습니다.

MLAA와 슈퍼샘플링 모두 장단점이 있지만, 핵심적인 차이점은 접근 방식에 있습니다. MLAA는 일관된 글로벌 실루엣 근사치를 강조하는 반면, 슈퍼샘플링은 이미지 충실도를 개선하기 위해 더 많은 샘플 수를 우선시합니다. 따라서 각 기법의 적합성은 특정 렌더링 시나리오와 원하는 결과에 따라 달라집니다.

### 5 SUMMARY AND FUTURE WORK

앤티앨리어싱에 대한 새로운 접근 방식이 도입되었습니다. 이미지에서 특정 모양을 검색하고 이러한 모양에 인접한 픽셀을 일련의 기본 규칙에 따라 처리하는 방식입니다. 이 방법은 개별 샘플링으로 인한 인위적인 고주파를 제거합니다.

![Edgar 모델의 텍스처 처리: (a) - 원본 에일리어싱 이미지; (d) - MLAA로 처리된 안티에일리어싱 이미지; (b,c) - 왼쪽과 오른쪽 이미지의 확대된 영역; (e,f,g) - 다양한 확대 레벨에서 MLAA로 처리된 픽셀의 시각화. 수평 모양에 속하는 픽셀은 녹색으로, 수직은 빨간색으로 표시됩니다. 수평 및 수직 모양에 동시에 포함된 픽셀은 파란색으로 표시됩니다. 에일리어싱 픽셀에 유의하세요.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%207.png)

Edgar 모델의 텍스처 처리: (a) - 원본 에일리어싱 이미지; (d) - MLAA로 처리된 안티에일리어싱 이미지; (b,c) - 왼쪽과 오른쪽 이미지의 확대된 영역; (e,f,g) - 다양한 확대 레벨에서 MLAA로 처리된 픽셀의 시각화. 수평 모양에 속하는 픽셀은 녹색으로, 수직은 빨간색으로 표시됩니다. 수평 및 수직 모양에 동시에 포함된 픽셀은 파란색으로 표시됩니다. 에일리어싱 픽셀에 유의하세요.

MLAA 기법의 고유한 특징:

- 다용도성: MLAA는 색상 값에만 의존하는 모든 이미지 처리 작업에 적용할 수 있습니다. 렌더링 파이프라인을 변경하거나 추가 광선을 사용할 필요 없이 원활하게 통합됩니다.
- 병렬 처리: 이 알고리즘은 본질적으로 병렬 처리 방식입니다. 즉, 이중 버퍼링을 통해 렌더링 스레드와 동시에 실행할 수 있으므로 프로세서 사용량을 최적화할 수 있습니다.
- 성능: MLAA는 눈에 띄는 영향 없이 만족스러운 성능을 제공하는 경우가 많습니다.
- 품질 비교: 슈퍼샘플링과 비교했을 때 MLAA는 다양한 근사화 속성을 보여줍니다. 특히 균일 샘플링에서 눈에 띄는 오류와 바람직하지 않은 주파수가 나타나는 시나리오에서 빛을 발합니다.
- 예시: 이 기법의 적응성을 보여주기 위해 게임 "Call of Duty®: 월드 앳 워"의 이미지에 적용했습니다. 이 게임은 게임 고유의 특성이 아닌 새로운 GPU 카드의 가용성 때문에 선택되었습니다. 하드웨어 앤티앨리어싱을 비활성화하고 게임 해상도를 낮춤으로써 인쇄물에서 아티팩트를 식별할 수 있게 만들었습니다.
    
    ![“Call of Duty®: World at War” 게임에서의 정글 장면. 이 스크린샷은 640x480 해상도로 기하학적 에일리어싱을 끈 상태로 캡처되었지만, 텍스처 안티에일리어싱은 최고 품질로 설정되었습니다. 일부 식물은 투명 텍스처로 구현되어 있어 하드웨어에서 안티에일리어싱 처리가 됩니다. 또한 멀리 떨어져 있는 빌보드도 있습니다. MLAA는 색상 불연속성을 분석하여 이러한 모든 경우를 일관되게 처리합니다.](Morphological%20Antialiasing%20d7feaf2b27ab40bc8f0b1a672bfd2ef7/Untitled%208.png)
    
    “Call of Duty®: World at War” 게임에서의 정글 장면. 이 스크린샷은 640x480 해상도로 기하학적 에일리어싱을 끈 상태로 캡처되었지만, 텍스처 안티에일리어싱은 최고 품질로 설정되었습니다. 일부 식물은 투명 텍스처로 구현되어 있어 하드웨어에서 안티에일리어싱 처리가 됩니다. 또한 멀리 떨어져 있는 빌보드도 있습니다. MLAA는 색상 불연속성을 분석하여 이러한 모든 경우를 일관되게 처리합니다.
    

향후 작업:

- 추가 정보 활용: 색상 값 외에 더 많은 정보에 액세스할 수 있다면 MLAA는 이를 활용하여 초기 불연속성 검색 단계를 세분화하거나 더 많은 효과를 통합할 수 있습니다.
- 소프트 섀도우 근사치: 곧 출시될 흥미로운 애플리케이션은 부드러운 그림자를 추정하는 데 MLAA를 사용하는 것입니다. 여기에는 광원과의 근접성을 기준으로 블렌딩된 영역을 확대하는 것이 포함되며, 이는 [Chan and Durand 2003]에서 언급한 "스무디" 기법과 유사합니다.
- 해상도 향상: 또 다른 탐색 방법은 출력 이미지의 해상도를 개선하는 것입니다. 여기에는 [Bala 외. 2003]에서 영감을 얻은 제약 보간이나 최신 LCD의 서브 픽셀 기능을 활용하는 방법이 포함될 수 있습니다.
- 색 공간 실험: RGB 색 공간에서의 전환과 비선형 색상 비교 및 블렌딩 기술에 대한 조사도 관심 분야입니다.