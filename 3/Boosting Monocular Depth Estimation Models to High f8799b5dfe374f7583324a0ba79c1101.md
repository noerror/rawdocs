# Boosting Monocular Depth Estimation Models to High-Resolution via Content-Adaptive Multi-Resolution Merging

*신경망은 단일 이미지에서 심도를 추정하는 데 효과적이지만, 결과물인 심도 맵은 해상도가 낮고 세밀한 디테일이 부족한 경우가 많습니다. 이 연구에서는 입력 해상도와 장면 구조가 깊이 추정 성능에 미치는 영향을 분석하여 일관된 장면 구조와 고주파수 디테일 사이의 상충 관계를 밝혀냈습니다. 연구진은 전체 이미지 깊이 추정을 개선하기 위한 이중 추정 방법과 로컬 디테일을 추가하기 위한 패치 선택 방법을 제시합니다. 서로 다른 해상도에서 추정치를 병합하여 사전 학습된 모델을 사용하여 높은 디테일의 멀티메가픽셀 심도 맵을 생성할 수 있습니다.*

[http://yaksoy.github.io/papers/CVPR21-HighResDepth.pdf](http://yaksoy.github.io/papers/CVPR21-HighResDepth.pdf)

[http://yaksoy.github.io/highresdepth/](http://yaksoy.github.io/highresdepth/)

### 1. Introduction

단안 깊이 추정은 단일 이미지에서 장면 구조를 추출하기 위해 오클루전 경계 및 원근과 같은 높은 수준의 단안 깊이 단서에 의존합니다. 이러한 작업에는 심층 신경망이 표준이지만, 우수한 경계 정확도와 일관된 장면 구조로 고해상도 깊이 추정치를 달성하는 것은 여전히 어려운 과제입니다.

이 연구에서는 사전 학습된 단안 깊이 추정 모델을 사용하여 높은 경계 정확도로 고해상도 결과를 얻는 방법을 제시합니다. 연구진은 입력 이미지 해상도에 따라 모델의 출력 특성이 달라지며, 저해상도는 일관된 구조를 생성하지만 고주파 디테일이 부족하고 고해상도는 더 많은 디테일을 캡처하지만 구조적 일관성이 떨어진다는 사실을 관찰했습니다. 연구진은 이미지 콘텐츠에 맞게 서로 다른 해상도에서 동일한 이미지에 대해 두 개의 깊이 추정치를 병합하여 구조적 일관성을 유지하면서 고주파 디테일이 포함된 결과를 생성하는 이중 추정 프레임워크를 제안합니다.

연구원들은 또한 네트워크에 이미지를 입력하는 데 적합한 해상도가 높은 수준의 깊이 단서의 분포에 따라 지역마다 국지적으로 달라지는 것을 관찰했습니다. 연구진은 입력 이미지에서 패치를 선택하여 국부적인 깊이 단서 밀도에 맞는 해상도로 모델에 공급하고, 이러한 추정치를 구조적으로 일관된 기본 추정치에 병합하여 매우 상세한 고해상도 깊이 추정을 달성합니다.

단안 심도 추정 모델의 특성을 활용하여 원본 네트워크를 재학습하지 않고도 해상도와 경계 정확도 측면에서 최신 기술을 뛰어넘는 결과를 얻을 수 있습니다.

### 2. Related Work

초기의 단안 깊이 추정 방법은 물체 크기, 텍스처 밀도, 선형 원근과 같은 그림의 깊이 단서를 인코딩하기 위해 수작업으로 만든 피처에 의존했습니다. 최근 심층 신경망의 발전으로 학습 데이터에서 직접 깊이 관련 전처를 학습할 수 있게 되었습니다. 대규모 깊이 데이터 세트와 아키텍처 설계, 기하학적 및 의미론적 제약 조건의 통합, 새로운 손실 함수 및 감독 전략의 기술적 혁신 덕분에 깊이 추정 성능이 크게 향상되었습니다.

![Untitled](Boosting%20Monocular%20Depth%20Estimation%20Models%20to%20High%20f8799b5dfe374f7583324a0ba79c1101/Untitled.png)

이 연구는 새로운 깊이 추정 방법을 개발하는 대신 기존 깊이 추정 모델이 서로 다른 해상도와 패치의 추정치를 병합하여 더 높은 품질의 결과를 생성할 수 있음을 보여줍니다. 대부분의 기존 방법은 상대적으로 작은 입력 해상도로 학습되어 고해상도 심도 맵이 필요한 애플리케이션에서는 사용이 제한적입니다. 일부 연구에서는 저해상도 심도 추정치를 위한 개선 방법을 제안하지만, 이 접근 방식은 네트워크 입력을 변경하고 여러 추정치를 병합하여 고주파수 디테일을 생성하는 데 중점을 둡니다.

![Untitled](Boosting%20Monocular%20Depth%20Estimation%20Models%20to%20High%20f8799b5dfe374f7583324a0ba79c1101/Untitled%201.png)

패치 기반 프레임워크는 이미지 패치에서 로컬 결과를 생성하여 글로벌 결과와 혼합하는 패치 기반 이미지 편집, 매팅 및 합성 기법과 유사합니다. 그러나 기존의 패치 기반 편집 기법은 패치 추정에서 다양한 깊이 값 범위, 이미지 패치 내의 컨텍스트에 대한 강한 의존성, 고해상도 깊이 추정에서 발생하는 특징적인 저주파 아티팩트 등의 문제로 인해 단안 깊이 추정에는 직접 적용하기 어렵습니다.

### 3. Observations on Model Behavior

단안 깊이 추정은 상황적 단서 또는 컨텍스트라고 하는 오클루전 및 원근 관련 단서와 같이 단일 이미지에 존재하는 높은 수준의 깊이 단서에 의존합니다. 단안 깊이 추정 모델의 성능은 입력에 포함된 컨텍스트 단서의 밀도에 영향을 받습니다.

대부분의 깊이 추정 방법은 사전 정의된 상대적으로 낮은 입력 해상도로 훈련하지만, 모델 자체는 완전한 컨볼루션 방식이므로 이론적으로는 임의의 입력 크기를 처리할 수 있습니다. 그러나 입력 해상도가 변경되면 결과 특성도 변경됩니다. 해상도가 낮을수록 고주파 디테일은 부족하지만 전체적인 씬 구조는 일관되게 생성됩니다. 입력 해상도가 높아지면 더 많은 디테일이 생성되지만 장면 구조에 불일치가 나타납니다.

이러한 이중성은 네트워크의 제한된 용량과 수용 필드 크기 때문입니다. 수용 필드 크기, 즉 출력에 기여하는 픽셀 주변 영역은 아키텍처와 훈련 해상도에 따라 달라집니다. 이미지의 컨텍스트 단서가 수용 필드보다 멀리 떨어져 있으면 네트워크는 충분한 정보가 부족한 픽셀 주위에 일관된 깊이 추정치를 생성할 수 없습니다.

컨볼루션 신경망은 용량이 제한되어 있어 저장하고 생성할 수 있는 정보의 양에 상한선이 있습니다. 이 용량 제한은 네트워크가 수용 필드 내에서 생성할 수 있는 것에 적용됩니다. 저해상도 추정치에 고주파 세부 정보가 부족한 것은 이 한계 때문입니다. 입력에 많은 컨텍스트 단서가 있는 경우 네트워크는 장면의 더 큰 구조를 추론할 수 있지만 단일 포워드 패스에서 생성할 수 있는 정보의 양이 제한되어 있기 때문에 고주파 디테일을 동시에 생성할 수 없습니다.

### 4. Method Preliminaries

목표는 단일 이미지에 대한 여러 깊이 추정치를 생성하고 이를 병합하여 고빈도 디테일과 일관된 전체 구조를 가진 결과를 얻는 것입니다. 이를 위해서는 (i) 네트워크에 대한 입력을 결정하기 위해 이미지의 컨텍스트 단서 분포를 추정하고, (ii) 구조적 일관성을 유지하면서 한 추정치에서 다른 추정치로 고빈도 디테일을 전송하는 병합 작업이 필요합니다.

문맥 단서 추정:
이미지에서 문맥 단서를 결정하는 것은 간단하지 않습니다. Hu 등[17]은 단안 심도 추정에 가장 관련성이 높은 픽셀을 식별하는 데 중점을 두었지만, 이 방법으로는 MiDaS에 필요한 고해상도 추정치를 생성할 수 없었습니다[35]. 대신, 이미지 가장자리는 상황적 단서와 상당한 상관관계가 있기 때문에 RGB 그라데이션을 임계값으로 설정하여 얻은 이미지의 대략적인 가장자리 맵을 프록시로 사용합니다.

단안 깊이 추정치 병합:
이 문제는 (i) 네트워크에 더 낮은 해상도의 입력으로 얻은 저해상도 맵과 (ii) 동일한 이미지(5초) 또는 패치(6초)의 고해상도 깊이 맵을 병합하여 깊이 불연속성 주변의 정확도는 높지만 저주파 아티팩트가 있는 두 가지 깊이 추정치를 병합하는 것입니다. 목표는 두 번째 입력의 고주파 디테일을 첫 번째 입력에 포함시켜 전체 이미지에 일관된 구조와 고정된 깊이 범위를 제공하는 것입니다.

푸아송 블렌딩[32]과 같은 기존의 그라데이션 전송 방법은 고해상도 추정에서 저주파 아티팩트가 발생하기 때문에 이러한 목적에 적합하지 않습니다. 대신, 표준 네트워크와 10계층 U-넷[36]을 생성기로 사용하는 Pix2Pix 아키텍처[19]가 사용됩니다. 네트워크는 고해상도 입력에서 저해상도 입력으로 세밀한 디테일을 전송하도록 훈련됩니다.

입력/출력 쌍을 생성하기 위해 Middlebury2014[38] 및 Ibims-1[24]에서 선택한 이미지 세트의 깊이 추정치에서 패치가 선택됩니다. 지상 실측과 고해상도 패치 추정에는 동일한 양의 세분화된 디테일이 있어야 합니다. 지상 실측 추정을 지침으로 사용하여 패치 추정에 가이드 필터를 적용합니다. 이렇게 수정된 고해상도 패치는 저해상도 및 고해상도 추정치의 매끄럽게 병합된 버전에 대한 프록시 기준점 역할을 합니다. 그림 6과 그림 7은 병합 작업을 보여줍니다.

### 5. Double Estimation

입력 해상도 변화에 따른 추정치의 일관된 장면 구조와 고주파 디테일 사이의 절충점은 섹션 3과 그림 3에서 설명합니다. 이미지의 컨텍스트 단서가 수용 필드 크기보다 더 멀리 떨어져 있으면 네트워크는 구조적으로 일관되지 않은 결과를 생성하기 시작합니다. 네트워크가 일관된 구조를 생성할 수 있는 최대 해상도는 이미지의 컨텍스트 단서 분포에 따라 달라집니다. 에지 맵을 문맥 단서의 프록시로 사용하면 이 최대 해상도(R0)를 결정할 수 있습니다.

R0(Rx) 이상의 해상도는 구조적 일관성을 잃게 되지만 고주파 콘텐츠가 더 풍부해집니다. 이러한 관찰을 바탕으로 "이중 추정" 알고리즘이 제안됩니다. 이미지가 두 가지 다른 해상도로 네트워크에 공급되고, 추정치가 병합되어 고주파 디테일이 포함된 일관된 결과를 얻습니다. 저해상도 추정치는 네트워크의 수용 필드 크기로 설정되고, 고해상도 추정치는 실험 분석을 통해 최대 R20으로 결정됩니다.

병합 네트워크는 고해상도 디테일을 저해상도 추정 구조에 최대 R20까지 성공적으로 병합할 수 있습니다. 그 이상에서는 저해상도 아티팩트가 병합된 결과를 손상시키기 시작합니다. 그림 6은 저해상도 추정 결과의 구조를 보존하면서 고해상도 추정 결과의 디테일을 성공적으로 통합할 수 있음을 보여줍니다. 병합을 통해 베이스 네트워크를 통과하는 두 번째 포워드 패스가 추가되기는 하지만 R0 이상의 일관된 결과를 생성할 수 있습니다.

### 6. Patch Estimates for Local Boosting

패치 선택 방법은 이미지의 여러 영역에 대해 서로 다른 해상도로 깊이 추정치를 생성한 다음, 이를 병합하여 일관된 전체 결과를 도출하는 것을 목표로 합니다. 이 접근 방식은 컨텍스트 단서 밀도가 높은 영역은 더 높은 해상도의 추정을 통해 더 많은 고주파 디테일을 생성하는 데 유리하다는 사실을 고려합니다.

기본 추정치: 전체 이미지에 대해 이중 추정(섹션 5에 설명됨)을 사용하여 기본 추정치를 생성합니다. 이 기본 추정치의 해상도는 일반적으로 대부분의 이미지에서 R20으로 고정됩니다.

패치 선택: 수용 필드 크기와 동일한 타일 크기와 1/3 겹침으로 기본 해상도로 이미지를 타일링합니다. 각 타일은 후보 패치 역할을 합니다. 패치 내 가장자리의 밀도를 전체 이미지의 가장자리 밀도와 비교하여 각 패치가 충분한 컨텍스트를 수신하는지 확인합니다. 가장자리 밀도가 원본 이미지와 일치할 때까지 패치 크기를 조정합니다.

![단안 깊이 추정 네트워크는 미터법 깊이를 제공하지 않기 때문에 패치 추정값의 깊이 값 범위가 기본 추정값과 다르다는 점에 유의해야 합니다. 대신, 그 결과는 이미지 영역 간의 수차원적 깊이 관계를 나타냅니다. 병합 네트워크는 패치 추정치의 고주파 세부 정보를 기본 추정치에 성공적으로 병합할 수 있습니다.](Boosting%20Monocular%20Depth%20Estimation%20Models%20to%20High%20f8799b5dfe374f7583324a0ba79c1101/Untitled%202.png)

단안 깊이 추정 네트워크는 미터법 깊이를 제공하지 않기 때문에 패치 추정값의 깊이 값 범위가 기본 추정값과 다르다는 점에 유의해야 합니다. 대신, 그 결과는 이미지 영역 간의 수차원적 깊이 관계를 나타냅니다. 병합 네트워크는 패치 추정치의 고주파 세부 정보를 기본 추정치에 성공적으로 병합할 수 있습니다.

패치 추정: 고정된 고해상도 추정 크기를 가진 다른 이중 추정 체계를 사용하여 패치에 대한 깊이 추정치를 생성합니다. 생성된 패치 추정치를 기본 추정치에 하나씩 병합하여 더 자세한 심도 맵을 만듭니다.

기본 해상도 조정: 이미지의 에지 밀도가 크게 달라지는 경우 패치를 선택하기 전에 기본 추정치를 더 높은 해상도로 업샘플링합니다. 최대 기본 크기(Rmax)를 결정하고 기본 추정치 크기에 대한 간단한 승수를 정의하여 기본 크기가 감소하지 않도록 합니다. 이 승수를 사용하면 전체 저밀도 이미지 내에서 작은 패치가 있는 작은 고밀도 영역을 선택할 수 있습니다.

이 패치 선택 방법은 추가 데이터 세트나 훈련 없이도 신뢰할 수 있는 고해상도 깊이 추정 파이프라인을 제공하므로 각 패치 추정치에 대해 안정적인 구조에 도달하기 위해 신중한 설계 결정을 내릴 수 있습니다. 병합 네트워크는 패치 추정치와 기본 추정치 간에 서로 다른 깊이 값 범위의 문제를 처리하도록 설계되어 패치 추정치의 고주파 세부 정보를 기본 추정치에 성공적으로 병합합니다.

연구원들은 표준 수심 평가 메트릭 세트를 사용하여 두 가지 다른 데이터 세트인 Middleburry 2014와 IBMS-1에 대해 이 방법을 평가했습니다. 또한 경계 정확도에 초점을 맞춘 깊이 추정에서 고주파의 품질을 측정하기 위해 깊이 불연속 불일치 비율(D3R)이라는 새로운 메트릭을 제안했습니다.

### 7. Results and Discussion

병합 네트워크는 가볍고, 이 방법의 실행 시간은 주로 파이프라인에서 기본 네트워크가 사용되는 횟수에 따라 달라집니다. 기본 추정치가 계산되는 해상도(R20)와 기본 추정치에 병합되는 패치 수는 이미지 콘텐츠에 따라 조정됩니다.

그 결과 콘텐츠 적응형 부스팅 프레임워크는 두 데이터 세트 모두에서 ORD 및 D3R 메트릭 측면에서 기준선보다 깊이 추정 정확도를 일관되게 개선하여 정확한 깊이 순서와 더 잘 보존된 경계를 나타냈습니다. 이 방법은 RMSE와 δ1.25 측면에서도 비슷한 성능을 보였습니다. 정성적 비교 결과, 원래 네트워크와 비교했을 때 고주파 디테일의 수가 크게 증가하고 경계 로컬라이제이션이 개선된 것으로 나타났습니다.

그러나 이 방법에는 몇 가지 한계가 있습니다. 단안 깊이 추정을 기반으로 구축되었기 때문에 상대적인 서수 깊이 추정치는 생성하지만 절대 깊이 값은 생성하지 못합니다. 기본 모델의 성능은 노이즈에 따라 저하되며, 이 방법은 노이즈가 있는 이미지에 대해 의미 있는 개선 효과를 제공하지 못합니다. 고주파 추정치는 병합 네트워크에서 항상 필터링되지 않는 낮은 크기의 화이트 노이즈로 인해 문제가 발생할 수 있으며, 그 결과 평평한 표면이 결과에서 노이즈가 있는 것처럼 보일 수 있습니다.

이러한 한계에도 불구하고 이 방법은 현재 공식으로 기본 모델을 크게 향상시킵니다. 상황적 단서와 패치 선택 프로세스에 대한 추가 연구를 통해 사전 학습된 단안 깊이 추정 네트워크의 잠재력을 최대한 발휘할 수 있습니다.

### 8. Conclusion

연구진은 사전 학습된 모델을 사용하여 단일 이미지에서 고해상도 심도 맵을 추론하는 알고리즘을 시연했습니다. 이전 작업은 서브메가픽셀 해상도로 제한되었지만, 이 기술은 최신 카메라로 캡처한 멀티메가픽셀 이미지도 처리할 수 있습니다. 고품질, 고해상도 단안 깊이 추정을 통해 이미지 분할과 같은 다양한 애플리케이션 시나리오를 구현할 수 있습니다. 연구진은 깊이 값을 임계값으로 설정하여 간단한 분할을 보여주었으며, 이 방법의 경계 로컬라이제이션도 시연했습니다.

이 연구는 기존 깊이 추정 네트워크의 능력과 이에 영향을 미치는 요인에 대한 면밀한 특성화를 기반으로 합니다. 저자들은 자신들의 접근 방식이 고해상도 깊이 추정에 대한 더 많은 연구를 촉진하고 향후 매력적인 애플리케이션을 위한 길을 열어주기를 희망합니다.

- Poisson blending
    
    푸아송 블렌딩 또는 푸아송 이미지 편집은 이미지를 매끄럽게 합성하기 위해 페레즈 등[47]이 제안한 방법입니다. 이 방법은 디리클레 경계 조건으로 푸아송 편미분 방정식을 푸는 것을 기반으로 합니다. 이 접근 방식은 두 가지 주요 통찰력을 활용합니다:
    
    ![Untitled](Boosting%20Monocular%20Depth%20Estimation%20Models%20to%20High%20f8799b5dfe374f7583324a0ba79c1101/Untitled%203.png)
    
    경계 영역의 스칼라 함수는 경계의 값과 내부의 라플라시안으로 고유하게 정의됩니다. 따라서 푸아송 방정식을 풀면 경계 조건과 영역 내부의 라플라시안 함수를 설명하는 함수가 주어진 영역을 매끄럽게 채울 수 있습니다.
    심리학 연구[37]에 따르면 인간의 지각 시스템은 다른 물체나 장면을 인식할 때 강도 값보다 이미지 그라데이션에 더 민감하다고 합니다.
    이러한 통찰력을 바탕으로 페레즈 등은 푸아송 방정식의 확장 버전을 풀어서 결과 함수 f의 그라데이션이 마스크 영역 M에서 소스 함수 g의 그라데이션을 따라 소스를 타겟 f∗에 매끄럽게 블렌딩할 것을 제안합니다. 이 방법은 다음 방정식으로 표현할 수 있습니다:
    
    x ∈ M의 경우 ∆f(x) = ∆g(x)
    x /∈ M의 경우 f(x) = f∗(x)
    
    최소화 문제로서 이 방정식을 풀려면 주어진 경계 조건에서 소스(g) 기울기에 가장 가까운 기울기(L2-노름)를 갖는 함수를 찾아야 합니다. 이렇게 하면 경계 조건을 안쪽으로 보간할 때 재구성된 함수가 소스 함수의 기울기를 최대한 가깝게 따릅니다.
    
    이 방정식을 이미지에 적용하기 위해 각 픽셀 i의 4로 연결된 이웃을 Ni로 정의합니다. 그런 다음 그림 5.2에 표시된 것처럼 푸아송 블렌딩을 사용하여 이미지를 매끄럽게 블렌딩할 수 있습니다.
    
    그러나 이전 답변에서 언급했듯이 푸아송 블렌딩은 구조적 불일치를 상속하지 않고 R0보다 높은 해상도에서 선명도와 디테일을 기본에 병합하는 데 적합하지 않을 수 있습니다.