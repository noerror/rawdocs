# Normal Map Estimation in the Wild

[https://papiro.unizar.es/ojs/index.php/jji3a/article/view/5977/4979](https://papiro.unizar.es/ojs/index.php/jji3a/article/view/5977/4979)

단 하나의 RGB 이미지로 3D 기하학적 정보를 제공하는 물체의 노멀 맵을 추정하는 방법을 소개합니다. 이 딥러닝 기반 접근 방식은 합성 데이터를 학습에 사용하며 이미지 기반 외형 편집 작업을 개선할 수 있습니다. 여러 시점이나 제어된 조명이 필요한 다른 방법과 달리, 이 기술은 제어되지 않은 환경과 조명 조건에서 촬영한 단일 이미지에서도 작동합니다.

### Our Method

이 방법은 합성곱 신경망(CNN)을 사용해 단일 뷰 RGB 이미지를 처리합니다. 다양한 일반 예측 작업에서 효과가 입증된 Pix2Pix 네트워크를 기반으로 아키텍처를 구축했습니다. 우리의 목표는 기하학적 디테일을 최대한 보존하면서 입력 이미지의 재질과 조명 조건의 변화에도 정상 예측이 영향을 받지 않도록 하는 것입니다.

### Architecture

저희 네트워크는 인코더에 4개의 다운샘플링 블록과 디코더에 4개의 업샘플링 블록으로 구성된 인코더-디코더 아키텍처를 사용합니다. 각 블록에는 4x4 컨볼루션, 배치 정규화 레이어, 누수ReLU 활성화 레이어와 같은 구조의 두 가지 반복이 포함되어 있습니다. 또한 최종 예측에서 스페큘러 반사의 영향을 줄이기 위해 마지막 디코더 뒤에 컨볼루션 블록을 추가로 추가합니다.

ResNet에서 제안한 대로 각 블록 내에 잔여 연결을 통합하여 네트워크를 안정화하고 예측에서 높은 분산 노이즈를 최소화합니다. 전치 컨볼루션을 사용하는 Pix2Pix와 달리, 저희의 방법은 이중 선형 업샘플링을 사용하여 바둑판 아티팩트 발생 가능성을 낮춥니다. 출력은 쌍곡탄젠트 함수(탄)를 사용하여 예측을 [-1,1] 범위로 제한합니다. 그런 다음 이 값은 단위 길이 벡터로 스케일링되고 [0,1] 범위로 정규화됩니다. 네트워크의 가중치는 표준 편차 0.02의 제로 평균 정규 분포를 사용하여 초기화됩니다.

### Training

손실 함수는 세 가지 구성 요소로 이루어져 있습니다:

- 목표 분포와 유사한 노멀 맵을 추론하기 위한 이진 교차 엔트로피(BCE) 함수가 포함된 적대적 손실(Ladv).
- 추론된 노멀에서 고빈도 기하학적 디테일을 보존하기 위해 ImageNet에서 사전 학습된 VGG16 모델을 사용하는 지각적 손실(Lvgg).
- 각 노멀의 예측을 직접 감독하기 위해 평균 제곱 오차(MSE) 함수(Lrec)를 사용합니다.

최종 손실은 이 세 가지 구성 요소의 가중치 합계로, 가중치 ʎadv = 0.25, ʎrec = 10, ʎvgg = 1이 우리 문제에 잘 맞는 것으로 확인되었습니다.

합성 데이터와 쌍을 이루는 실측 노멀 맵을 사용하여 모델을 훈련했습니다. 데이터 세트에는 12개의 지오메트리, 5개의 시점, 6개의 조명 조건, 100개의 머티리얼이 각각 포함되었으며, 128x128픽셀 크기의 총 42,000개의 이미지가 있었습니다. 무작위 90º 회전, 뒤집기, 무작위 감마, 색조, 채도, 밝기 변경과 같은 데이터 증강 기법이 적용되었습니다.

초기 학습률 0.0007, β1 = 0.9, β2 = 0.999의 아담 옵티마이저가 사용되었습니다. 네트워크는 파이토치 및 파이토치 라이트닝 프레임워크를 사용하여 구현되었습니다.

### Results

![그림1 우리가 평가한 실제 사진의 샘플 실제 사진 샘플과 예측된 노멀 맵입니다.](Normal%20Map%20Estimation%20in%20the%20Wild%207035caee8fa740778ed0bfb2e4006517/Untitled.png)

그림1 우리가 평가한 실제 사진의 샘플 실제 사진 샘플과 예측된 노멀 맵입니다.

그림 1은 보정되지 않은 실제 사진을 사용한 방법의 결과를 보여줍니다. 예측된 노멀 맵은 정확하며, 고주파 디테일을 포착하고 반사광을 배제합니다. 또한 지각적 특징을 사용하여 물체의 재질 모양을 변경하는 이미지 기반 외형 편집 프레임워크에서 이 방법의 적용 가능성을 보여줍니다. 정상 추정 모듈은 결과를 크게 향상시켜 스페큘러 반사를 개선하고 고주파 디테일을 보존합니다. 이러한 결과 중 일부는 그림 2에서 확인할 수 있습니다.

![그림2 일반 추정 모듈을 사용하는 이미지 기반 지각적 외관 편집 프레임워크로 편집한 실제 사진 샘플입니다.](Normal%20Map%20Estimation%20in%20the%20Wild%207035caee8fa740778ed0bfb2e4006517/Untitled%201.png)

그림2 일반 추정 모듈을 사용하는 이미지 기반 지각적 외관 편집 프레임워크로 편집한 실제 사진 샘플입니다.

### Conclusions

이 연구에서는 단 하나의 RGB 이미지만으로 실제 사물의 고품질 노멀 맵을 생성하는 방법을 소개했습니다. 이를 위해 딥러닝과 합성 이미지를 결합한 접근 방식을 사용했습니다. 이 방법을 성공적으로 구현한 애플리케이션을 시연하여 실제 이미지의 결과 품질을 크게 향상시켰습니다.

하지만 이 방법에는 한계가 있습니다. 향후 연구에서는 실제 물체 형상에서 반사를 필터링하여 광택이 강하거나 반사가 심한 재질에 대한 모델 성능을 향상시키는 데 초점을 맞출 수 있습니다. 또한 여러 색상을 가진 오브젝트로 사용 사례를 확장하는 것도 검토할 수 있습니다.