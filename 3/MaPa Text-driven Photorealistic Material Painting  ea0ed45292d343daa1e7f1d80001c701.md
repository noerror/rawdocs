# MaPa: Text-driven Photorealistic Material Painting for 3D Shapes

[https://arxiv.org/abs/2404.17569](https://arxiv.org/abs/2404.17569)

- Apr 2024
- SIGGRAPH 24

![MaPa 갤러리의 예시들, 일상적인 물체들에 대한 재료를 생성함으로써 사실적인 3D 렌더링을 용이하게 합니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled.png)

MaPa 갤러리의 예시들, 일상적인 물체들에 대한 재료를 생성함으로써 사실적인 3D 렌더링을 용이하게 합니다.

## 1 INTRODUCTION

논문의 서론 부분에서는 3D 콘텐츠 생성에 대한 증가하는 관심을 강조하고 있습니다. 비디오 게임, 영화, VR/AR과 같은 다양한 분야에서 3D 콘텐츠의 중요성이 부각되고 있으며, 이러한 콘텐츠 생성에 확산 모델이 통합되면서 이 분야는 눈에 띄는 발전을 이루고 있습니다. 특히, 텍스트 프롬프트나 단일 이미지로부터 3D 객체를 생성하는 연구가 주를 이루고 있습니다. 또한, 3D 메시(mesh)의 외형을 생성하는 것도 중요한 연구 주제로, 기존의 메시 외형 디자인 방식이 많은 수작업을 필요로 하기 때문에 이를 보다 효율적으로 개선할 필요성이 대두되고 있습니다.

이러한 배경에서, 3D 텍스처 합성 방법들이 제안되어 사용자의 텍스트 입력에 따라 다양한 3D 텍스처를 메시에 적용할 수 있는 기술이 개발되고 있습니다. 그러나 현재의 텍스처 생성 기술만으로는 실제 응용 분야의 요구를 충분히 만족시키지 못하는 경우가 많아, 더 나은 재료 생성 방법에 대한 연구가 필요한 상태입니다. 이에 본 논문은 텍스트 설명을 바탕으로 메시에 대해 사실적이고 고해상도의 재료를 생성할 수 있는 새로운 방법을 제안합니다. 이 방법은 실제 제조 공정에서 관찰될 수 있는 재료의 일관성을 모방하며, 이는 결과물을 보다 조직화된 방식으로 제공하고 사용자가 모델링 소프트웨어에서 특정 영역의 재료를 쉽게 변경할 수 있도록 지원합니다. 이러한 방법은 아직 해결되지 않은 여러 기술적 도전들을 포함하고 있지만, 새로운 프레임워크인 MaPa를 통해 이를 해결하고자 합니다.

## 2 RELATED WORKS

![파이프라인 설명. 저희 파이프라인은 주로 네 단계로 구성됩니다: a) 세그먼트 제어 이미지 생성. 우선, 입력 메시를 여러 세그먼트로 분해하고, 이 세그먼트들을 2D 이미지에 투영한 후 세그먼트 제어 ControlNet을 사용하여 해당 이미지들을 생성합니다. b) 재료 그룹화. 동일한 재료를 공유하고 유사한 외관을 가진 세그먼트들을 재료 그룹으로 묶습니다. c) 재료 그래프 선택 및 최적화. 각 재료 그룹에 대해 생성된 이미지를 기반으로 적절한 재료 그래프를 선택한 다음 이 재료 그래프를 최적화합니다. d) 반복적 재료 회복. 최적화된 재료 그래프로 입력 메시의 추가 시점을 렌더링하고, 이 렌더링된 이미지에서 누락된 영역을 수정하며, b)와 c) 단계를 반복하여 모든 세그먼트에 재료 그래프가 할당될 때까지 반복합니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%201.png)

파이프라인 설명. 저희 파이프라인은 주로 네 단계로 구성됩니다: a) 세그먼트 제어 이미지 생성. 우선, 입력 메시를 여러 세그먼트로 분해하고, 이 세그먼트들을 2D 이미지에 투영한 후 세그먼트 제어 ControlNet을 사용하여 해당 이미지들을 생성합니다. b) 재료 그룹화. 동일한 재료를 공유하고 유사한 외관을 가진 세그먼트들을 재료 그룹으로 묶습니다. c) 재료 그래프 선택 및 최적화. 각 재료 그룹에 대해 생성된 이미지를 기반으로 적절한 재료 그래프를 선택한 다음 이 재료 그래프를 최적화합니다. d) 반복적 재료 회복. 최적화된 재료 그래프로 입력 메시의 추가 시점을 렌더링하고, 이 렌더링된 이미지에서 누락된 영역을 수정하며, b)와 c) 단계를 반복하여 모든 세그먼트에 재료 그래프가 할당될 때까지 반복합니다.

2D 확산 모델을 사용한 이미지 생성과 3D 객체의 외형 모델링에 초점을 맞추고 있습니다.

1. **2D 확산 모델**: 최근 확산 모델이 이미지 생성 및 편집 분야에서 주목받고 있습니다. 이러한 모델들은 텍스트 프롬프트로부터 이미지를 생성할 수 있으며, 탁월한 결과를 달성했습니다. Stable Diffusion 같은 대규모 확산 모델은 널리 사용되고 있으며, ControlNet은 공간적 조절을 가능하게 하는 기술을 소개합니다. 예를 들어, inpainting 마스크, Canny 엣지, 깊이 맵 등을 조건으로 사용하여 확산 모델을 보다 정밀하게 제어할 수 있습니다. Textual Inversion과 DreamBooth는 모델이 예시 이미지를 텍스트 공간의 토큰으로 표현하게 하여 확산 모델을 미세 조정합니다.
2. **3D 외형 모델링**: 확산 모델의 등장으로, 3D 객체에 텍스처를 생성하는 연구가 활발해졌습니다. Latent-nerf는 3D 객체에 대한 텍스처 맵을 최적화하는 DreamFusion을 확장했으나, 긴 훈련 시간과 낮은 품질의 텍스처 맵이 문제로 지적됩니다. TEXTure와 Text2tex는 미리 학습된 깊이-이미지 확산 모델을 사용하여 다양한 시점에서 3D 모델을 반복적으로 페인팅합니다. 이러한 작업들은 텍스처 맵의 품질을 크게 향상시켰습니다. 그러나 이들은 텍스처 맵만을 생성할 뿐, 사실적인 재료를 생성하지는 못합니다. 반면, Material modeling은 3D 형태에 재료를 할당하는 방법을 연구하여, 이미지 컬렉션을 사용하여 3D 형태에 재료를 배정하는 PhotoShape와 같은 기술이 소개되었습니다. MATch 및 그 확장판은 절차적 재료 그래프를 사용하며, 이는 고해상도, 타일 가능, 사진 같은 재료를 생성할 수 있는 인기 있는 기법입니다.

## 3 METHOD

### **세그먼트 제어 이미지 생성**

메시를 여러 세그먼트로 분할한 후, 특정 시점으로 투영하여 2D 세그멘테이션 이미지를 생성합니다. 이 과정은 2D 확산 모델의 발전을 기반으로 하며, 선정된 시점에서 2D 세그먼트 마스크를 사용하여 해당 RGB 이미지를 생성합니다. 이 이미지는 후속 재료 예측 과정을 안내합니다.

### **재료 그룹화**

최적화 시간을 절약하고 시각적으로 일관된 결과를 얻기 위해, 유사한 외형을 가진 세그먼트를 그룹화합니다. 이는 각 세그먼트를 노드로 하는 그래프를 구성하고, 유사한 재료 클래스와 색상을 가진 세그먼트를 연결하여 그룹화합니다.

### **재료 그래프 선택 및 최적화**

생성된 이미지로부터 절차적 노드 그래프의 파라미터를 복구합니다. 각 재료 그룹에 대해, 재료 그래프 라이브러리에서 가장 유사한 재료 그래프를 검색하고, 차별화 가능한 렌더링 모듈을 사용하여 이를 최적화합니다.

### **반복적 재료 회복**

메시의 한 시점만을 대상으로 재료를 생성한 후, 다른 시점에 대해 미할당된 세그먼트에 재료를 입히는 반복적 접근법을 사용합니다. 이 과정에서 필요한 세그먼트에만 재료를 할당하고, 이전 반복에서 할당된 재료가 있는 세그먼트는 그 재료를 복사하여 사용합니다.

### **하류 편집**

사용자가 직접 재료 그래프를 편집할 수 있도록 하는 기능을 제공합니다. 예를 들어, 사용자가 "고급스러운 느낌의 패턴 추가"와 같은 텍스트 지시를 입력하면, 시스템은 해당 설명과 일치하는 패턴 마스크를 찾아 해당 변경을 적용할 수 있는 파이썬 명령을 생성합니다.

![하류 편집. 생성된 재료에 대해 재료 편집을 수행합니다. 사용자는 GPT-4와 미리 정의된 API 세트를 통해 텍스트 프롬프트를 사용하여 재료를 편집할 수 있습니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%202.png)

하류 편집. 생성된 재료에 대해 재료 편집을 수행합니다. 사용자는 GPT-4와 미리 정의된 API 세트를 통해 텍스트 프롬프트를 사용하여 재료를 편집할 수 있습니다.

이 방법론은 3D 메시에 대해 텍스트 기반의 사실적이고 조명 조건에 따라 변화하는 재료를 생성할 수 있도록 설계되었습니다. 각 단계는 연결된 구성 요소를 통해 전체 프로세스를 간소화하고 최적화하며, 이는 사용자가 상업 소프트웨어에서 손쉽게 재료를 편집하고 다양한 재료 변형을 생성할 수 있게 합니다.

## 4 EXPERIMENTS

### **구현 세부사항**

재료 그래프 최적화는 Adam 최적화기를 사용하여 총 300회의 반복을 수행합니다. 전체 과정은 A6000에서 10분 이내에 완료될 수 있으며, 이는 기존 방법들보다 빠른 것입니다. 사용된 재료 범주는 목재, 금속, 플라스틱, 가죽, 직물, 돌, 세라믹, 고무 등 8가지이며, 이는 대부분의 인공 객체에 대해 적용 가능합니다.

### **기준선과의 비교**

TEXTure, Text2tex, Fantasia3D 등 세 가지 강력한 기준선과 비교합니다. TEXTure와 Text2tex는 반복적인 텍스처 페인팅 방식을 도입하였고, Fantasia3D는 3D 객체의 지오메트리와 외형을 분리하여 모델링합니다. 실험 결과, 제안된 방법은 FID와 KID 메트릭에서 기준선들을 능가하는 성능을 보여주었으며, 사용자 연구 평가에서도 가장 높은 점수를 받았습니다.

### **질적 결과**

다양한 고품질 3D 모델을 사용하여 질적 실험을 수행했습니다. 결과적으로, 제안된 방법은 실제와 같은 더 사실적인 렌더링 결과를 달성하였으며, 기준선 방법들은 일관성 없는 텍스처로 인해 결과가 더럽게 보이는 경향이 있었습니다. 또한, 여러 가지 시드를 사용하여 생성된 다양한 이미지로부터 재료를 최적화할 때 자연스럽게 다양성이 생기는 것을 보여주었습니다.

![밀폐된 메시에 대한 결과. 그래프 컷 알고리즘을 사용하여 메시를 여러 세그먼트로 분해하고 각 세그먼트에 재료를 생성합니다. 두 예시에 대한 텍스트 프롬프트는 각각 “갈색 다리가 있는 현대적인 의자의 사진”과 "검정색과 흰색 안경"입니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%203.png)

밀폐된 메시에 대한 결과. 그래프 컷 알고리즘을 사용하여 메시를 여러 세그먼트로 분해하고 각 세그먼트에 재료를 생성합니다. 두 예시에 대한 텍스트 프롬프트는 각각 “갈색 다리가 있는 현대적인 의자의 사진”과 "검정색과 흰색 안경"입니다.

![질적 비교. 저희 방법과 모든 기준선에 의해 생성된 결과들은 비교를 위해 동일한 CG 환경에서 렌더링됩니다. 세 개의 객체에 대한 프롬프트는 각각 "나무로 된 침대 옆 테이블의 사진", "장난감 로켓의 사진", "새것 같은 검의 사진"입니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%204.png)

질적 비교. 저희 방법과 모든 기준선에 의해 생성된 결과들은 비교를 위해 동일한 CG 환경에서 렌더링됩니다. 세 개의 객체에 대한 프롬프트는 각각 "나무로 된 침대 옆 테이블의 사진", "장난감 로켓의 사진", "새것 같은 검의 사진"입니다.

![생성된 재료의 다양성. 저희 프레임워크로 동일한 프롬프트 “장난감 비행기의 사진”을 사용하여 합성된 결과의 다양성을 보여줍니다. 첫 번째 행의 이미지들은 확산 모델에 의해 생성되었으며, 두 번째 행의 모델들은 저희가 페인트한 메시입니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%205.png)

생성된 재료의 다양성. 저희 프레임워크로 동일한 프롬프트 “장난감 비행기의 사진”을 사용하여 합성된 결과의 다양성을 보여줍니다. 첫 번째 행의 이미지들은 확산 모델에 의해 생성되었으며, 두 번째 행의 모델들은 저희가 페인트한 메시입니다.

### **이미지 프롬프트에서 외형 전송**

IP-Adapter를 사용하여 이미지 프롬프트와 호환되도록 하여, 참조 이미지의 외형을 입력 객체에 전송할 수 있습니다. 이는 주어진 객체의 유사한 외형을 가진 이미지를 먼저 생성한 다음, 제안된 프레임워크를 사용하여 재료를 최적화하는 방식으로 진행됩니다.

![외형 전송. 저희 방법은 이미지 프롬프트를 입력으로 받아, 참조 이미지의 외형을 입력 객체에 전송할 수도 있습니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%206.png)

외형 전송. 저희 방법은 이미지 프롬프트를 입력으로 받아, 참조 이미지의 외형을 입력 객체에 전송할 수도 있습니다.

![하류 편집 결과. 생성된 재료에 대해 GPT-4와 미리 정의된 API 세트를 통해 텍스트 기반 편집을 수행합니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%207.png)

하류 편집 결과. 생성된 재료에 대해 GPT-4와 미리 정의된 API 세트를 통해 텍스트 기반 편집을 수행합니다.

![“w/o Albedo” 및 “w/o Grouping”에 대한 단측 연구. 텍스트 프롬프트 “어두운 갈색 가죽 소파”를 사용한 예시. “w/o Albedo”는 렌더링 결과와 생성된 이미지 사이의 색상 차이를 보이며, 유사한 색상의 세그먼트를 병합하는 데 실패합니다. “w/o Grouping”은 저희 방법과 유사한 렌더링 결과를 가집니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%208.png)

“w/o Albedo” 및 “w/o Grouping”에 대한 단측 연구. 텍스트 프롬프트 “어두운 갈색 가죽 소파”를 사용한 예시. “w/o Albedo”는 렌더링 결과와 생성된 이미지 사이의 색상 차이를 보이며, 유사한 색상의 세그먼트를 병합하는 데 실패합니다. “w/o Grouping”은 저희 방법과 유사한 렌더링 결과를 가집니다.

![재료 그래프 최적화에 대한 단측 연구. 저희의 재료 그래프 최적화와 잔여 조명의 효과에 대한 단측 연구를 보여줍니다. 기준선 “w/o Opt”와 “w/o Res”는 생성된 이미지(a) 및 렌더링된 이미지의 손실을 최소화하기 위해 최적화됩니다. 생성된 이미지(b)와(c)는 저희 방법이 소규모 재료 그래프 데이터 세트로도 다양한 결과를 얻을 수 있음을 증명하는 데 사용됩니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%209.png)

재료 그래프 최적화에 대한 단측 연구. 저희의 재료 그래프 최적화와 잔여 조명의 효과에 대한 단측 연구를 보여줍니다. 기준선 “w/o Opt”와 “w/o Res”는 생성된 이미지(a) 및 렌더링된 이미지의 손실을 최소화하기 위해 최적화됩니다. 생성된 이미지(b)와(c)는 저희 방법이 소규모 재료 그래프 데이터 세트로도 다양한 결과를 얻을 수 있음을 증명하는 데 사용됩니다.

### **추가적인 결과 및 소결**

분절된 메시뿐만 아니라 완전히 분리 가능한 메시에도 방법을 적용할 수 있음을 보여줍니다. 또한, 사용자 제공 프롬프트를 바탕으로 재료를 편집하는 결과를 여러 가지 보여주며, 이는 사용자가 다양한 패턴을 추가할 수 있음을 보여줍니다.

이러한 실험들을 통해 제안된 방법이 실제 환경에서도 효과적으로 작동함을 확인하고, 다양한 시나리오에서의 유용성과 적용 가능성을 검증합니다. 사용자 연구와 양적, 질적 비교 모두에서 기존 방법들을 상회하는 결과를 보여주며, 이는 제안된 방법의 우수성을 입증합니다.

## 5 CONCULUSION

제안된 방법은 3D 메시에 대해 고품질의 재료 맵을 생성하는 데 성공하였으며, 세그먼트별 절차적 재료 그래프 표현을 사용함으로써 복잡한 재료 작업을 수행할 수 있었습니다. 또한, 사전 훈련된 2D 확산 모델을 중간 매개체로 활용하여 이 표현의 예측을 안내하는 방법이 효과적이었습니다.

### **한계점**:

- 생성된 이미지와 렌더링 결과 간의 도메인 간 차이로 인해 때때로 결과가 일치하지 않는 문제가 발생했습니다. 이는 2D 확산 모델이 자연 이미지에 대해 훈련되었기 때문에 발생하는 문제로, 합성 이미지에 대한 확산 모델의 미세 조정이나 더 발전된 알베도 추정 네트워크의 사용을 통해 해결할 수 있을 것으로 보입니다.
    
    ![실패 사례. 확산에 의해 생성된 이례적인 조명 효과(노란색 조명이 있는 은색 금속) 때문에, 알베도 추정 네트워크가 알베도를 정확하게 추정하지 못하여, 재료 예측이 달라집니다.](MaPa%20Text-driven%20Photorealistic%20Material%20Painting%20%20ea0ed45292d343daa1e7f1d80001c701/Untitled%2010.png)
    
    실패 사례. 확산에 의해 생성된 이례적인 조명 효과(노란색 조명이 있는 은색 금속) 때문에, 알베도 추정 네트워크가 알베도를 정확하게 추정하지 못하여, 재료 예측이 달라집니다.
    
- 또한, 분절이 명확하지 않은 복잡한 객체의 경우, 과분할과 그룹화 과정에서 문제가 발생할 수 있으며, 이는 훈련 데이터의 부족으로 인한 것입니다.

### **향후 연구 방향**:

- 더 효율적인 알고리즘 개발을 위해 입력 이미지로부터 직접 재료 그래프의 파라미터를 예측할 수 있는 추론 네트워크의 학습을 탐구할 필요가 있습니다. 이는 전체 최적화 프로세스를 크게 단축시킬 수 있습니다.
- 더욱 다양한 재료와 복잡한 목표에 대응하기 위해서는 더 많은 재료 그래프를 포함하는 라이브러리의 확장이 필요합니다.

논문은 제안된 방법이 3D 메시의 재료 생성에 있어 현저한 진보를 이루었음을 강조하며, 이를 통해 사용자가 다양한 편집을 손쉽게 할 수 있도록 지원하는 유연성을 제공한다고 결론짓습니다. 또한, 이 방법은 사실적인 렌더링 결과를 생성하며, 다양한 응용 프로그램에서 활용될 수 있는 잠재력을 가지고 있습니다.