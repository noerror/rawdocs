# SDM-UniPS: Scalable, Detailed, and Mask-Free Universal Photometric Stereo

[https://github.com/satoshi-ikehata/SDM-UniPS-CVPR2023](https://github.com/satoshi-ikehata/SDM-UniPS-CVPR2023)

[https://arxiv.org/abs/2303.15724](https://arxiv.org/abs/2303.15724)

![알려지지 않은 공간적으로 변하는 조명 하에서 여러 이미지가 주어진 상황에서, 우리의 방법론은 비컨벡스(non-convex), 비램버트(non-Lambertian) 표면의 상세한 표면 정규 맵(surface normal map)을 복구할 수 있습니다 (왼쪽). 우리의 방법론은 심지어 일반 소비자용 3D 스캐너가 제공하는 디테일 수준을 뛰어넘습니다 (오른쪽).](SDM-UniPS%20Scalable,%20Detailed,%20and%20Mask-Free%20Univer%20673e9bc582564c61bbcbe3fa7630ded0/Untitled.png)

알려지지 않은 공간적으로 변하는 조명 하에서 여러 이미지가 주어진 상황에서, 우리의 방법론은 비컨벡스(non-convex), 비램버트(non-Lambertian) 표면의 상세한 표면 정규 맵(surface normal map)을 복구할 수 있습니다 (왼쪽). 우리의 방법론은 심지어 일반 소비자용 3D 스캐너가 제공하는 디테일 수준을 뛰어넘습니다 (오른쪽).

1 Introduction

측광 스테레오란 다양한 조명 조건에서 촬영한 이미지에서 표면의 질감을 유추하는 기술입니다. 기존의 방법은 조명 조건에 대한 가정과 학습 데이터의 한계로 인해 문제가 있었습니다. 범용 측광 스테레오 방법(UniPS)은 알 수 없는 임의의 조명 조건에서 작동하도록 설계되었지만, 세 가지 주요 문제로 인해 생성된 표면 맵이 흐릿하고 디테일이 부족했습니다:

다운샘플링 이미지의 정보 손실로 인해 흐릿한 결과물이 출력됩니다.
글로벌 정보 부족으로 인해 UniPS의 픽셀 단위 네트워크가 전체 모양을 정확하게 복구하지 못함.
학습 데이터의 모양, 재질, 조명 조건이 다양하지 않아 특정 조건, 특히 고주파 광원에서는 성능이 저하됩니다.
이러한 문제를 해결하기 위해 확장 가능하고 상세하며 마스크가 없는 범용 측광 스테레오 네트워크(SDM-UniPS)라는 새로운 네트워크가 개발되었습니다. 이 네트워크는 제어되지 않은 조명 조건에서 촬영한 이미지에서 상세한 표면 맵을 생성합니다. 고해상도 이미지로 작업할 수 있으며 기존의 많은 방법처럼 마스크가 필요하지 않습니다. SDM-UniPS의 세 가지 기술적 특징은 다음과 같습니다:

성능 저하 없이 다양한 입력 이미지 크기를 수용하면서 조명 특징을 효과적으로 추출하는 스케일 불변 공간 조명 특징 인코더.
픽셀 샘플링 트랜스포머를 사용해 전역 정보를 고려하는 새로운 표면 법선 디코더.
다양한 물체, 텍스처, 조명 조건이 포함된 합성 훈련 데이터 세트.
SDM-UniPS의 가장 큰 장점은 조명 제어에 대한 요구 사항이 덜 엄격하기 때문에 기존 방식에 비해 시간을 크게 절약할 수 있다는 점입니다. 따라서 가정과 같은 '야생' 환경에서도 측광 스테레오를 수행할 수 있습니다.

2. Related Works

단일 직교 카메라 가정에 초점을 맞춘 측광 스테레오 문헌은 일반적으로 최적화 기반 접근 방식과 학습 기반 접근 방식으로 나뉩니다.

최적화 기반 방식은 보정된 방향성 조명을 가정하고 물리 기반 이미지 형성 모델을 사용하여 파라미터를 최적화합니다. 이러한 방법은 견고한 방법, 모델 기반 방법, 예제 기반 방법으로 나눌 수 있습니다. 외부 학습 데이터가 필요하지 않지만 상호 반사와 같은 복잡한 조명 현상을 처리하는 데 한계가 있습니다.

학습 기반 방법은 단순한 이미지 형성 모델로는 표현하기 어려운 복잡한 현상을 처리하는 데 효과적입니다. 그러나 초기 측광 스테레오 네트워크는 훈련과 테스트를 위해 일관된 조명 조건이 필요했는데, 이는 최근 연구에서 다양한 전략으로 해결된 한계입니다. 이러한 방법은 발전에도 불구하고 단일 방향 광원에서만 작동하는 경향이 있으며 보다 복잡한 조명 환경을 처리하는 데는 한계가 있습니다.

유니버설 측광 스테레오 네트워크(UniPS)는 글로벌 조명 컨텍스트라는 비물리적 조명 표현을 사용하여 사전 조명 모델의 가정을 없앤 최초의 솔루션입니다. 또한 고해상도 이미지를 처리하는 방법도 도입했지만, 입력 정보의 손실과 비로컬 원근감의 부재로 인해 성능이 저하되는 결과를 초래했습니다.

새로운 방법인 SDM-UniPS는 UniPS에서 영감을 받았으며 피처 통신 및 통합을 위한 트랜스포머 사용과 같은 몇 가지 기본 아이디어를 공유합니다. 그러나 비로컬 방식으로 입력 정보를 완전히 활용함으로써 재구성 품질을 크게 향상시킨다는 점에서 차별화됩니다.

3. Method

범용 측광 스테레오를 위한 스케일-왜곡된 방법(SDM-UniPS)으로 알려진 이 방법은 표면 형상, 재료 특성 또는 조명 조건에 대한 가정이 없는 이전 연구에서 소개된 문제인 까다로운 범용 측광 스테레오 작업을 대상으로 합니다. 직교 카메라를 사용하여 알 수 없는 조명 조건에서 캡처한 일련의 이미지에서 노멀 맵을 복구하는 것이 목표입니다.

접근 방식은 스케일 불변 공간 조명 특징 인코더와 픽셀 샘플링 트랜스포머라는 두 가지 주요 구성 요소로 이루어집니다.

![(a)에서 우리의 전체 프레임워크를 설명하고 있습니다. 여러 이미지와 객체 마스크(선택 사항)가 주어지면, 스케일 불변 공간-광 특징 인코더(scale-invariant spatial-light encoder)는 각 이미지에 대한 특징 맵을 추출합니다((b)에서 자세히 설명됨). 표면 정규 벡터들은 보간된 특징 맵과 원시 관측치에서 집계된 특징들 사이의 비지역적 상호작용 후 각 픽셀 샘플(즉, 2048)에서 독립적으로 복구됩니다.](SDM-UniPS%20Scalable,%20Detailed,%20and%20Mask-Free%20Univer%20673e9bc582564c61bbcbe3fa7630ded0/Untitled%201.png)

(a)에서 우리의 전체 프레임워크를 설명하고 있습니다. 여러 이미지와 객체 마스크(선택 사항)가 주어지면, 스케일 불변 공간-광 특징 인코더(scale-invariant spatial-light encoder)는 각 이미지에 대한 특징 맵을 추출합니다((b)에서 자세히 설명됨). 표면 정규 벡터들은 보간된 특징 맵과 원시 관측치에서 집계된 특징들 사이의 비지역적 상호작용 후 각 픽셀 샘플(즉, 2048)에서 독립적으로 복구됩니다.

스케일 불변 공간-광 특징 인코더는 공간 축과 광축을 따라 상호작용을 통해 이미지와 선택적 오브젝트 마스크에서 특징 맵을 추출하는 방식으로 작동합니다. 원본 이미지의 정보를 보존하기 위해 이 방법은 입력 텐서를 일정하고 작은 해상도의 겹치지 않는 하위 텐서로 분할하는 것을 제안합니다. 각 서브 텐서를 처리한 후 다시 텐서로 병합하고, 순진하게 축소된 이미지에서 인코딩된 다른 특징 맵을 추가하여 블록 아티팩트를 완화합니다.

접근 방식의 두 번째 부분인 픽셀 샘플링 트랜스포머는 피처 맵과 이미지를 사용하여 광축을 따라 픽셀 단위로 피처를 집계한 후 표면 법선을 복구합니다. CNN과 같은 기존의 이미지 단위 신경망에 의존하는 대신 입력 좌표계의 임의 위치에서 고정된 수의 픽셀 샘플에 트랜스포머 모델을 활용하는 픽셀 샘플링 트랜스포머 개념을 도입합니다. 이 접근 방식은 샘플 세트당 메모리 소비를 일정하게 유지하며 피처 맵의 과도한 평활화를 방지합니다.

이 범용 측광 스테레오 네트워크를 훈련하기 위해 PS-Mix라는 새로운 훈련 데이터 세트를 만들었습니다. 이 데이터 세트는 동일한 장면에 서로 다른 재질을 가진 여러 오브젝트를 포함하고 다양한 광원 구성을 사용하여 PS-Wild 훈련 데이터 세트의 몇 가지 문제를 해결합니다. 이 데이터 세트는 34,921개의 장면으로 구성되며, 각 장면은 10개의 이미지를 출력하도록 렌더링됩니다.

4. Results

이 섹션에서는 다양한 조명 조건에서 이미지의 표면 법선 추정에 적용된 제안된 ConvNeXt-T 기반 네트워크의 훈련 결과와 실험 결과에 대한 심층적인 보고서를 제공합니다.

4.1. 제거 연구: 스케일 불변 공간 조명 특징 인코더와 픽셀 샘플링 변환기와의 비국소적 상호 작용의 개별적인 기여도를 평가하기 위해 일련의 실험을 수행했습니다. 이 실험은 PS-Wild-Test 데이터 세트를 사용하여 다양한 조명 조건에서 수행되었습니다. 그 결과 스케일 불변 인코더와 비로컬 상호 작용이 특히 방향성 조명 조건에서 성능을 크게 개선하는 것으로 나타났습니다. 또한 이러한 개선 효과는 샘플 크기가 줄어든 경우에도 지속되었습니다.

![객체 마스크를 포함한 단일 방향 조명 조건 하에서의 객체에 대한 결과.](SDM-UniPS%20Scalable,%20Detailed,%20and%20Mask-Free%20Univer%20673e9bc582564c61bbcbe3fa7630ded0/Untitled%202.png)

객체 마스크를 포함한 단일 방향 조명 조건 하에서의 객체에 대한 결과.

![객체 마스크를 제외한 단일 방향 조명 조건 하에서의 장면에 대한 결과.](SDM-UniPS%20Scalable,%20Detailed,%20and%20Mask-Free%20Univer%20673e9bc582564c61bbcbe3fa7630ded0/Untitled%203.png)

객체 마스크를 제외한 단일 방향 조명 조건 하에서의 장면에 대한 결과.

4.2. 방향성 조명에서의 평가: 이 방법은 여러 보정 및 비보정 광도계 스테레오 알고리즘과 비교하여 DiLiGenT 벤치마크에서 평가되었습니다. 제안된 방법은 특정 조명 모델을 가정하지 않고도 방향성 조명을 위해 설계된 최첨단 보정 방법보다 성능이 뛰어났습니다. 또한 더 적은 수의 입력 이미지에서도 안정적인 성능을 보였습니다. 또한 이 방법은 오브젝트 마스크가 필요하지 않아 전역 조명 효과가 큰 복잡한 장면에서도 마스크 없이 오브젝트 경계를 성공적으로 캡처할 수 있었습니다.

4.3. 공간적으로 변화하는 조명에서의 평가: 제안된 방법은 공간적으로 다양한 조명 조건이 있는 까다로운 장면에서 테스트되어 최초의 범용 네트워크(UniPS) 및 보정되지 않은 광도 스테레오 방법과 비교되었습니다. 제안된 방법은 3D 스캐너보다 더 높은 해상도의 표면 노멀 맵을 복구하고 다양한 표면 재질에서 우수한 성능을 발휘하여 더 정확한 결과를 생성한다는 것이 입증되었습니다. 이 방법은 복잡한 비볼록 장면에 적용하여 균일한 표면 법선을 성공적으로 복구하고 표면의 미세한 모양을 효과적으로 재구성함으로써 그 효과를 더욱 강조했습니다.

![오브젝트 마스크 없이 공간적으로 다양한 조명 조건에서 이미지의 표면 노멀 복구.](SDM-UniPS%20Scalable,%20Detailed,%20and%20Mask-Free%20Univer%20673e9bc582564c61bbcbe3fa7630ded0/Untitled%204.png)

오브젝트 마스크 없이 공간적으로 다양한 조명 조건에서 이미지의 표면 노멀 복구.

5. Conclusion

이 논문에서는 확장 가능하고 디테일 지향적이며 마스크가 없는 범용 광도계 스테레오 방법을 제안합니다. 이 방법은 DiLiGenT 벤치마크에서 기존의 대부분의 보정 및 비보정 방법보다 우수한 성능을 보여주었습니다. 또한 기존의 유일한 범용 광도계 스테레오 방법보다 상당한 개선을 보였습니다.

하지만 여전히 해결해야 할 몇 가지 과제가 남아 있습니다. 첫째, 제안된 방법은 다양한 조명 조건에서 견고하지만 조명의 변화가 적을 때는 효과가 떨어지는 것으로 나타났습니다. 둘째, 제안된 방법은 머티리얼에 대한 양방향 반사율 분포 함수(BRDF) 파라미터를 출력하는 등 손실 함수 및 데이터를 변경하여 노멀 맵 복구 이상으로 확장할 수 있습니다. 그럼에도 불구하고 내재된 모호성으로 인해 복구된 BRDF 파라미터를 평가하는 것은 어려운 일입니다.

이 논문은 독자들이 부록에서 이러한 한계와 기타 결과에 대한 추가 논의를 참조하여 이 연구에 대해 더 깊이 이해할 수 있도록 제안합니다. 향후 연구에서는 이러한 한계를 해결하고 제안된 방법의 추가 적용을 모색할 수 있습니다.