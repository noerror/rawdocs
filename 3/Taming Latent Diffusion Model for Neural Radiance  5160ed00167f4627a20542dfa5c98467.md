# Taming Latent Diffusion Model for Neural Radiance Field Inpainting

[https://arxiv.org/abs/2404.09995](https://arxiv.org/abs/2404.09995) 

[https://hubert0527.github.io/MALD-NeRF/](https://hubert0527.github.io/MALD-NeRF/)

- Apr 2024

## 1 Introduction

![NeRF 인페인팅. 인페인팅 마스크와 연관된 포즈된 이미지 세트를 바탕으로, 제안된 프레임워크는 고품질의 새로운 시점을 렌더링하는 NeRF를 추정합니다. 여기서 인페인팅 영역은 현실적이며 고주파 세부 정보를 포함합니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled.png)

NeRF 인페인팅. 인페인팅 마스크와 연관된 포즈된 이미지 세트를 바탕으로, 제안된 프레임워크는 고품질의 새로운 시점을 렌더링하는 NeRF를 추정합니다. 여기서 인페인팅 영역은 현실적이며 고주파 세부 정보를 포함합니다.

이 논문에서는 신경 방사장(NeRF)을 이용한 연구의 최근 진전을 다룹니다. NeRF는 여러 이미지를 이용해 장면의 고해상도 3D 재구성과 새로운 관점에서의 시각화를 성공적으로 수행할 수 있습니다. 이 기술의 성공은 3D 장면의 스타일화, NeRF 편집 등 NeRF의 다양한 조작 방법에 대한 관심을 증가시켰습니다.

특히, 이 연구는 NeRF 인페인팅 문제에 초점을 맞춥니다. 주어진 장면의 이미지 세트와 인페인팅 마스크를 사용하여, 새로운 시점에서 고품질 이미지를 렌더링할 수 있는 완성된 NeRF를 추정하는 것이 목표입니다. 이러한 NeRF 인페인팅 작업은 장면에서 객체를 제거하거나, 관찰되지 않은 장면 부분을 완성하고, 지정된 영역에 내용을 생성하는 등 다양한 3D 콘텐츠 생성 응용 프로그램을 가능하게 합니다.

기존 알고리즘은 먼저 2D 생성 모델을 사용하여 입력 이미지를 인페인팅한 다음, 인페인트된 이미지를 사용하여 NeRF를 최적화합니다. 최근 확산 모델의 성공을 바탕으로, 이러한 접근법은 시각적 충실도를 높이고 있지만 여전히 비현실적인 시각적 외형과 부정확한 기하학적 특성이 문제로 남아 있습니다.

![일관성 없음과 질감 이동 문제. 우리는 라텐트 확산 모델에서 나온 2D 인페인팅 결과를 제시합니다. 동일한 입력 이미지와 마스크를 사용할 때, 결과는 1) 일관성이 없으며 2) 원본과 인페인팅된 픽셀 간에 질감 이동을 발생시킵니다. 이러한 문제들은 NeRF 인페인팅 결과에 눈에 띄는 아티팩트를 도입합니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%201.png)

일관성 없음과 질감 이동 문제. 우리는 라텐트 확산 모델에서 나온 2D 인페인팅 결과를 제시합니다. 동일한 입력 이미지와 마스크를 사용할 때, 결과는 1) 일관성이 없으며 2) 원본과 인페인팅된 픽셀 간에 질감 이동을 발생시킵니다. 이러한 문제들은 NeRF 인페인팅 결과에 눈에 띄는 아티팩트를 도입합니다.

이 문제에 대응하기 위해, 이 논문에서는 마스크 적대적 학습을 사용하여 위에서 언급한 두 가지 주요 문제를 해결하고자 합니다. 우리는 라텐트 확산 모델을 사용하여 입력 이미지를 인페인팅하고, 인페인팅 및 재구성된 영역 사이의 질감 차이가 없는 NeRF를 최적화하는 것을 목표로 합니다. 이를 위해, 인페인트된 이미지와 NeRF에서 렌더링된 이미지 사이에 패치 기반 적대적 목표를 도입하여 NeRF 최적화에 적용합니다.

## 2 Related Work

### **2.1 3D 인페인팅**

3D 데이터의 인페인팅은 컴퓨터 비전 분야에서 오랫동안 연구된 문제입니다. 주로 포인트 클라우드나 복셀 완성 같은 작업이 포함됩니다. 고전적인 접근법은 대규모 데이터셋을 수집하고, 해당 데이터 분포에 대한 닫힌 형태의 모델을 훈련하는 것입니다. 이 방법은 높은 다양성을 유지하고 테스트 분포와 일치하는 대규모 데이터셋을 필요로 합니다. 현재는 대규모 NeRF 데이터셋이 존재하지 않고, NeRF 표현에 직접적으로 인페인팅 모델을 훈련할 수 있는 실현 가능한 방법도 없습니다.

![ 방법 개요. 제안된 방법은 라텐트 확산 모델을 사용하여 부분 DDIM을 이용해 NeRF에서 렌더링된 이미지로부터 인페인트된 훈련 이미지를 얻습니다. 인페인트된 이미지는 반복적 데이터셋 업데이트 프로토콜을 따라 NeRF 훈련 데이터셋을 업데이트하는 데 사용됩니다. (재구성) 우리는 입력 이미지에서 관찰된 영역을 재구성하기 위해 NeRF에서 렌더링된 픽셀과 실제 픽셀 간의 픽셀 수준 회귀 손실을 사용합니다. (인페인팅) 우리는 인페인팅 영역을 감독하기 위해 적대적 손실과 판별자 특성 매칭 손실을 포함하는 마스크된 패치 기반 적대적 학습을 설계합니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%202.png)

 방법 개요. 제안된 방법은 라텐트 확산 모델을 사용하여 부분 DDIM을 이용해 NeRF에서 렌더링된 이미지로부터 인페인트된 훈련 이미지를 얻습니다. 인페인트된 이미지는 반복적 데이터셋 업데이트 프로토콜을 따라 NeRF 훈련 데이터셋을 업데이트하는 데 사용됩니다. (재구성) 우리는 입력 이미지에서 관찰된 영역을 재구성하기 위해 NeRF에서 렌더링된 픽셀과 실제 픽셀 간의 픽셀 수준 회귀 손실을 사용합니다. (인페인팅) 우리는 인페인팅 영역을 감독하기 위해 적대적 손실과 판별자 특성 매칭 손실을 포함하는 마스크된 패치 기반 적대적 학습을 설계합니다.

### **2.2 NeRF 인페인팅**

최근 NeRF 인페인팅에 대한 연구는 개별 2D 이미지를 인페인팅하고 3D 불일치 문제를 다양한 솔루션으로 완화하는 데 초점을 맞추고 있습니다. NeRF-In은 NeRF와 인페인트된 이미지를 픽셀 복원 손실로 훈련시킬 경우 결과가 흐릿해진다고 보고했습니다. SPInNeRF는 퍼셉추얼 손실을 사용하여 NeRF가 더 높은 주파수 세부 정보를 드러낼 수 있게 하고, 깊이 예측을 이용해 NeRF 기하학을 감독하는 새로운 방법을 제안했습니다. InpaintNeRF360은 유사한 전략을 사용하되, 퍼셉추얼 및 깊이 손실에 의존합니다. Reference-guided 인페인팅은 보다 정교한 메커니즘을 도입하여 교차 시점 불일치를 해결합니다.

![ 2D 이미지 인페인팅 비교. LaMa [35] 접근법의 인페인팅 품질은 LDM [30] 모델에 비해 현실성이 떨어집니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%203.png)

 2D 이미지 인페인팅 비교. LaMa [35] 접근법의 인페인팅 품질은 LDM [30] 모델에 비해 현실성이 떨어집니다.

### **2.3 희소 시점 NeRF 재구성 사용 생성적 사전**

희소한 이미지 세트로부터 NeRF를 재구성하는 것은 그 응용 범위가 넓기 때문에 인기 있는 연구 주제입니다. 여러 최근 연구들은 확산 모델과 같은 생성적 사전을 활용하고 있습니다. 이러한 연구는 조건이 나쁜 희소한 이미지 세트로부터 합리적인 기하학적 대응을 찾고, 저조도 지역의 표면 품질을 향상시키는 데 중점을 둡니다. 이러한 연구들은 보통 실제 기하학이 접근 가능하다고 가정하지만, NeRF 인페인팅 문제는 알고리즘이 스크래치부터 인페인팅된 기하학을 형성해야 하기 때문에 차이가 있습니다.

## 3 Methodology

### **3.1 예비 사항**

이 연구에서는 여러 이미지 {Ii}와 그에 상응하는 카메라 포즈 {Pi}를 사용하여 3D 장면을 나타내기 위한 신경 방사장(NeRF)에 대해 설명합니다. NeRF는 3D 위치와 관측 방향을 밀도와 색으로 매핑하는 신경 함수 fθ를 사용하여 학습됩니다. 볼륨 렌더링을 적용하여, 렌더링된 픽셀 {x}와 실제 픽셀 {x^} 사이에서 픽셀 수준의 회귀 손실을 사용하여 NeRF를 최적화할 수 있습니다.

### **3.2 NeRF 인페인팅과 라텐트 확산 모델**

이 프레임워크는 내부 이미지 인페인팅 데이터셋에서 사전 훈련된 라텐트 확산 모델을 사용하여 2D 이미지를 인페인팅하고, 이를 NeRF 훈련의 입력으로 사용합니다. 인페인팅 영역을 위해서는 마스크된 적대적 학습을 사용하며, 이는 픽셀 거리 손실을 사용하지 않고 적대적 손실과 패치 기반의 구분자 특성 매칭 손실을 사용합니다.

### **3.3 퍼-씬 맞춤형 라텐트 확산 모델**

장면별로 라텐트 확산 모델을 세밀하게 조정하여, 장면과 더욱 일치하고 일관된 결과를 생성합니다. 이를 위해 각 장면에 대해 맞춤형 텍스트 토큰을 설정하고, 이를 LoRA 기법을 사용하여 텍스트 인코더와 U-Net을 세밀하게 조정합니다. 이는 무작위로 샘플링된 인페인팅 마스크를 사용하여 인페인팅 손실을 자가 감독하면서 진행됩니다.

### **훈련 목표 및 절차**

전체 훈련 목표는 NeRF의 인페인팅 및 재구성 단계를 최적화하는 다양한 손실 함수로 구성됩니다. 각 훈련 반복은 인페인팅 및 재구성을 최적화하는 세 단계로 이루어집니다. 추가적으로, 불규칙한 데이터셋 업데이트와 노이즈 일정 조정을 사용하여 확산 모델의 높은 다양성과 임의성이 다양한 시점 간 일관성 문제를 일으키는 문제를 완화합니다.

## 4 Experiments

### **4.1 실험 설정**

- **데이터셋**: 두 가지 실제 세계 데이터셋을 사용합니다. 첫 번째는 SPIn-NeRF 데이터셋으로, 10개의 장면이 포함되어 있으며, 각 장면은 객체 제거 벤치마크용으로 60개의 훈련 뷰와 객체가 물리적으로 제거된 40개의 테스트 뷰를 포함합니다. 두 번째는 LLFF 데이터셋으로, 다양한 장면을 포함하며 3D 기반 객체 제거 마스크로 주석이 달린 여섯 장면의 부분집합을 사용합니다.
- **이미지 사이즈**: 연구에 따라 모든 이미지는 긴 가장자리 크기가 1008로 조정됩니다.

### **4.2 평가 설정**

![: LPIPS의 단점. 일부 경우에서 LPIPS 점수는 시각적 품질을 나타내는 데 실패합니다. 예를 들어, 현실적인 야구 모자를 생성하는 것은 실제 이미지에서 인페인팅 영역에 객체가 없기 때문에 점수를 낮춥니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%204.png)

: LPIPS의 단점. 일부 경우에서 LPIPS 점수는 시각적 품질을 나타내는 데 실패합니다. 예를 들어, 현실적인 야구 모자를 생성하는 것은 실제 이미지에서 인페인팅 영역에 객체가 없기 때문에 점수를 낮춥니다.

![장면별 맞춤. 우리의 장면별 맞춤은 라텐트 확산 모델이 일관되고 맥락에 맞는 내용을 뷰 전반에 걸쳐 합성하도록 효과적으로 유도합니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%205.png)

장면별 맞춤. 우리의 장면별 맞춤은 라텐트 확산 모델이 일관되고 맥락에 맞는 내용을 뷰 전반에 걸쳐 합성하도록 효과적으로 유도합니다.

![정성적 비교. 우리는 SPIn-NeRF [26] 데이터셋에서의 결과를 제시합니다. 추가 결과는 부록 자료에 나와 있습니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%206.png)

정성적 비교. 우리는 SPIn-NeRF [26] 데이터셋에서의 결과를 제시합니다. 추가 결과는 부록 자료에 나와 있습니다.

- **LPIPS**: 지각적 차이를 측정하기 위해 사용되며, NeRF에서 렌더링한 이미지와 실제 테스트 뷰 이미지 간의 지각적 차이를 측정합니다.
- **M-LPIPS**: 인페인팅 성능을 더 잘 이해하기 위해, 객체 인페인팅 마스크 외부 영역을 마스킹하고 LPIPS 점수를 측정합니다.
- **FID/KID**: 생성 작업에 적합한 메트릭으로, 두 이미지 세트 간의 분포 유사성을 정량화하고 시각적 아티팩트에 민감합니다. LLFF 데이터셋에 대해서는 테스트 뷰가 물리적으로 객체가 제거된 것을 포함하지 않기 때문에, 인페인팅 경계 근처의 시각적 품질을 측정하기 위해 C-FID/C-KID 점수를 대안적으로 보고합니다.

### **4.3 비교된 방법**

- **SPIn-NeRF**: 공식 구현을 사용합니다.
- **SPIn-NeRF (LDM)**: 기존 LaMa 모델을 라텐트 확산 모델로 교체하여 실험합니다.
- **InpaintNeRF360**: 소스 코드가 제공되지 않아, 라텐트 확산 모델을 사용하여 각 뷰를 인페인팅하고 동일한 네트워크 구조를 사용하여 NeRF를 최적화합니다.
- **Inpaint3D**: SPIn-NeRF 데이터셋에서 평가를 위해 모든 렌더링된 테스트 뷰 이미지를 저자로부터 받아 사용합니다.

### **4.4 장면별 세밀 조정의 효과**

- **개별적 접근**: 장면별로 라텐트 확산 모델을 세밀 조정하며, 이로 인해 생성된 인페인팅 결과는 개별 인페인팅 결과 간 높은 일관성을 유지합니다.
- **정량적 평가**: 제안된 방법은 SPIn-NeRF 및 LLFF 벤치마크에서 모든 메트릭에 대해 기존 방법들을 크게 앞서는 성능을 보여줍니다. FID와 KID 메트릭은 시각적 품질 측면에서 우리 방법의 우수성을 더욱 강조합니다.

### **4.5 실험 결과**

- **정성적 분석**: 가장 도전적인 장면을 보여주며, 우리의 MALD-NeRF와 InpaintNeRF360만이 복잡한 텍스처를 정확하게 완성할 수 있습니다.
- **정량적 분석**: 테이블에 요약된 데이터는 우리의 방법이 모든 메트릭에서 모든 방법을 능가함을 보여줍니다.

이 실험들을 통해 제안된 방법의 유효성과 기존 방법들과의 비교 우위를 입증합니다.

![정성적 손실 연구. 이 연구에서는 SPIn-NeRF 데이터셋 [26]을 사용하여 마스크된 적대적 손실, 특성 매칭 손실, 장면별 맞춤의 효과를 검증하고, 일반적으로 사용되는 픽셀 기반(I-Recon) 및 LPIPS가 필요한지를 평가합니다.](Taming%20Latent%20Diffusion%20Model%20for%20Neural%20Radiance%20%205160ed00167f4627a20542dfa5c98467/Untitled%207.png)

정성적 손실 연구. 이 연구에서는 SPIn-NeRF 데이터셋 [26]을 사용하여 마스크된 적대적 손실, 특성 매칭 손실, 장면별 맞춤의 효과를 검증하고, 일반적으로 사용되는 픽셀 기반(I-Recon) 및 LPIPS가 필요한지를 평가합니다.

## 5 Conclusions and Discussions

이 논문에서는 NeRF 인페인팅 성능을 향상시키기 위해 라텐트 확산 모델과 마스크 적대적 학습 방법을 활용하였습니다. 우리의 방법은 주요 성능 지표에서 최신 기술에 비해 우수한 결과를 보여주며, 이는 제안된 각 구성 요소의 효과성을 확인하는 강력한 실험적 근거를 제공합니다.

### **잠재적 부정적 영향**

NeRF 인페인팅은 생성적 인페인팅과 밀접한 관련이 있으며, 특정 프레임워크는 NeRF 재구성에 환상적인 내용을 삽입하는 것을 목표로 할 수 있습니다. 이는 잘못된 정보를 조작하거나 사실적으로 잘못된 렌더링을 생성할 가능성이 있습니다. 우리의 연구는 이러한 응용 프로그램에 직접 초점을 맞추지는 않지만, 이러한 기술들이 활용될 수 있는 가능성을 인지하고 있습니다.

### **한계점**

우리의 접근 방식은 적대적 목표를 포함하며, 이는 최근의 생성적 적대적 네트워크 문헌의 진전에도 불구하고 성능이 매우 변동적일 수 있습니다. 또한 저샷(소수의 예제로 학습) NeRF 재구성이나 너무 큰 인페인팅 마스크를 사용하는 응용 시나리오에서 잘 작동하지 않을 수 있습니다. 우리의 프레임워크는 확산 모델이 일관된 결과를 생성하도록 하여 NeRF의 수렴을 크게 개선하지만, 확산 과정의 확률적 노이즈로 인해 생기는 미세한 질감 변화를 완전히 제거하지는 못합니다. 결과적으로, 인페인팅된 질감은 실제 세계의 질감보다 시각적으로 더 흐릿할 수 있습니다.

이러한 결론들은 NeRF 인페인팅의 성능을 향상시키기 위한 접근 방식의 중요성을 강조하며, 연구의 가능성과 한계를 모두 밝힙니다. 이 연구는 향후 NeRF 및 관련 기술의 발전을 위한 기반을 마련합니다.