# Spherical Fibonacci Mapping

[https://dl.acm.org/doi/10.1145/2816795.2818131](https://dl.acm.org/doi/10.1145/2816795.2818131)
[https://dokumen.tips/documents/spherical-fibonacci-mapping-fibonacci-mapping-benjamin-keinert-1matthias-innmann.html?page=1](https://dokumen.tips/documents/spherical-fibonacci-mapping-fibonacci-mapping-benjamin-keinert-1matthias-innmann.html?page=1)

### 1 Introduction

![SF^32i의 점 집합 구성을 보여주는 그림입니다. 격자를 통해 원통을 거쳐 구체로의 매핑이 보여집니다. 점 집합의 첫 번째 점은 파란색으로 표시되어 있습니다.](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled.png)

SF^32i의 점 집합 구성을 보여주는 그림입니다. 격자를 통해 원통을 거쳐 구체로의 매핑이 보여집니다. 점 집합의 첫 번째 점은 파란색으로 표시되어 있습니다.

구형 피보나치(SF) 포인트 세트는 구의 표면을 균일하게 샘플링하는 데 널리 사용되며, 수치 시뮬레이션, 구형 표면의 픽셀 표시, 준 몬테카를로 광선 추적 기법 등 다양한 용도로 활용되고 있습니다. 그러나 이러한 점 집합의 핵심 과제는 구의 특정 점에 대해 가장 가까운 샘플 점을 찾는 것으로, 기존에는 철저한 검색이 필요했습니다. 이 논문에서는 이 문제에 대한 분석적이고 효율적인 해결책을 제시합니다. 저자는 모든 크기의 SF 점 집합을 사용하여 구의 모든 점에 대해 가장 가까운 샘플과 주변 샘플을 빠르게 결정하는 방법을 제안합니다. 이는 정밀도 문제를 해결하고 SF 점 집합의 고유한 속성을 활용함으로써 달성됩니다. 이 솔루션은 이전에는 비효율적이라고 여겨졌던 애플리케이션에서 SF 포인트 집합을 실용적으로 사용할 수 있게 해줍니다. 또한 저자들은 이 방법을 효율적인 벡터 양자화, 구형 함수 저장 셀 크기의 균일성 개선, 절차적 모델링에 역매핑 적용에 어떻게 사용할 수 있는지 보여줍니다. 이 방법은 주로 구체에 대해 논의되지만 반구에도 적용할 수 있습니다.

### 2 Previous Work

자연에서 발견되는 피보나치 관련 필로택틱 패턴은 해바라기 머리 모델링 등의 응용 분야를 통해 광범위하게 연구되어 왔습니다. 구형 피보나치(SF) 포인트 세트는 역매핑 성능 개선의 어려움에도 불구하고 노멀 비닝을 위한 구형 데이터 구조에서 뛰어난 정확도로 인정받아 왔습니다. 구형에 대한 수치 적분에서 SF 포인트 세트는 유리한 것으로 입증되었습니다. 또한 준 몬테카를로 레이 트레이싱에서도 반구에 대한 다른 샘플링 전략보다 뛰어난 성능을 보였습니다.

필로택시에서 파생된 패턴은 절차적 콘텐츠 생성에 유용하게 사용되었으며, SF 그리드 픽셀 분포를 활용하여 인쇄 광학으로 반구형 디스플레이를 설계하고 개발하는 데 적용되었습니다. 그 외에도 기상학과 같은 다른 분야에서는 SF 포인트 세트의 균일하고 거의 등방성인 샘플 분포를 높이 평가하여 얕은 수심 시뮬레이션을 위한 유한 차분 모델에서 그 잠재력을 입증했습니다.

![(a) n = 64일 때의 격자 (φ, z) T에 대한 기저 벡터 bk. 붉은 사각형들은 서로 다른 연속적인 기저 벡터들에 의해 형성된 격자의 셀들에 해당합니다. 가로로 둘러싼 덕분에 b1 ≡ b2입니다. (b)-(e) n = 1024이며 왼쪽에서 오른쪽으로 k = 6, 7, 8, 9일 때의 기저 벡터 쌍 bk, bk+1. 각 기저 벡터 쌍은 구의 다른 영역에서 거의 같은 크기의 격자 셀을 형성합니다. (f) n = 1024일 때 주요 SF 기저 벡터 쌍 시각화, 극점은 붉게, SF 샘플은 녹색으로, Voronoi tessellation은 연한 회색으로 표시되어 있습니다.](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled%201.png)

(a) n = 64일 때의 격자 (φ, z) T에 대한 기저 벡터 bk. 붉은 사각형들은 서로 다른 연속적인 기저 벡터들에 의해 형성된 격자의 셀들에 해당합니다. 가로로 둘러싼 덕분에 b1 ≡ b2입니다. (b)-(e) n = 1024이며 왼쪽에서 오른쪽으로 k = 6, 7, 8, 9일 때의 기저 벡터 쌍 bk, bk+1. 각 기저 벡터 쌍은 구의 다른 영역에서 거의 같은 크기의 격자 셀을 형성합니다. (f) n = 1024일 때 주요 SF 기저 벡터 쌍 시각화, 극점은 붉게, SF 샘플은 녹색으로, Voronoi tessellation은 연한 회색으로 표시되어 있습니다.

SF 점 집합에 관한 포괄적인 관계를 도출한 이러한 이전 연구는 이 논문에서 제시된 연구의 토대가 되었습니다.

### 3 Spherical Fibonacci Point Sets

이 섹션에서는 2013년에 Marques 등이 자세히 설명한 구형 피보나치(SF) 점 집합에 대해 중점적으로 설명합니다. SF 포인트 세트는 구형 좌표(φ, θ)를 사용하여 구형에 나선형 패턴을 생성하고, 이 나선형의 단계 크기는 황금비 Φ로 정의됩니다. 이 나선형의 포인트는 황금비 및 총 샘플 수 n을 기반으로 특정 공식을 사용하여 계산됩니다.

SF 격자는 피보나치수 인덱스 차이가 있는 점으로 구성된 유용한 기저 벡터를 사용하여 2D의 1급 격자에 비유할 수 있습니다. 중요한 관찰 사항은 두 개의 연속적인 기저 벡터로 형성된 그리드 셀이 다양한 정도의 이방성을 가지며, 이는 구에 매핑할 때 변경된다는 것입니다.

![(a)-(d) 다양한 n에 대한 Delaunay 삼각 분할의 인접 행렬. n ≥ 16에 대해 극에서의 타일링이 일정해집니다. (e) 북극(녹색)에서의 최대 ∆max와 최소 ∆min을 생성하는 기하학을 보여주는 확대 이미지입니다. 이 이미지에서의 직선은 대원호를 나타냅니다.](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled%202.png)

(a)-(d) 다양한 n에 대한 Delaunay 삼각 분할의 인접 행렬. n ≥ 16에 대해 극에서의 타일링이 일정해집니다. (e) 북극(녹색)에서의 최대 ∆max와 최소 ∆min을 생성하는 기하학을 보여주는 확대 이미지입니다. 이 이미지에서의 직선은 대원호를 나타냅니다.

구의 각 점에 대해 거의 정사각형에 가까운 셀을 생성하는 기저 벡터 쌍을 우세 쌍이라고 하며, 이 쌍은 구에 따라 달라집니다. 이러한 로컬 그리드는 다음 섹션에서 설명하는 역 매핑의 기초를 형성합니다.

![n = 128 SF 샘플(흰색 점)에 대한 역 매핑을 위해 사용되는 셀의 시각화. 강조된 셀은 구체(파란색 점)에서의 샘플에 대해 SF 점 집합에서 가장 가까운 이웃을 찾는 데 사용됩니다. 흰색 점들 중 검은색 원으로 표시된 것들은 찾은 가장 가까운 이웃을 보여줍니다. 북극(빨간색) 근처의 타원형 셀들은 올바른 가장 가까운 이웃을 제공합니다. 색의 그라디언트는 가장 가까운 SF 점까지의 거리를 나타냅니다. 이 그림의 애니메이션은 부가 자료를 참조하십시오.](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled%203.png)

n = 128 SF 샘플(흰색 점)에 대한 역 매핑을 위해 사용되는 셀의 시각화. 강조된 셀은 구체(파란색 점)에서의 샘플에 대해 SF 점 집합에서 가장 가까운 이웃을 찾는 데 사용됩니다. 흰색 점들 중 검은색 원으로 표시된 것들은 찾은 가장 가까운 이웃을 보여줍니다. 북극(빨간색) 근처의 타원형 셀들은 올바른 가장 가까운 이웃을 제공합니다. 색의 그라디언트는 가장 가까운 SF 점까지의 거리를 나타냅니다. 이 그림의 애니메이션은 부가 자료를 참조하십시오.

연구진은 또한 구에 걸쳐 부드럽게 전환되는 실수 값의 영역 수를 계산하여 로컬 그리드의 부드러운 전환을 유도합니다. 그러나 규칙적인 그리드 구조는 극 근처에서 무너집니다. 그럼에도 불구하고 극 근처의 불규칙한 보로노이 셀은 n의 값이 클수록 일정해지며, 이는 보로노이 셀의 범위에 영향을 미칩니다.

보로노이 셀의 최소 각도와 최대 각도도 정의되어 있어 벡터 양자화 및 절차적 모델링과 같은 애플리케이션에서 개체를 각 셀로 제한하는 데 유용합니다.

### 4 Inverse Mapping

구의 한 점(S2)을 구형 피보나치(SF) 점 집합의 가장 가까운 이웃에 매핑하는 과정을 소개합니다. 이는 이전 섹션에서 설명한 SF 격자의 속성을 사용하여 수행됩니다. 관심 점과 관련된 기저 벡터를 사용하여 가장 가까운 이웃을 포함하는 그리드 셀을 찾을 수 있다는 점에 주목합니다. 또한 SF 샘플의 인덱스와 해당 z 좌표 사이의 직접적인 관계를 통해 SF 포인트 집합에서 실제 인덱스를 검색할 수 있습니다.

설명된 방법은 다음 단계를 포함합니다:

구(S2)의 점 p가 주어지면 방정식 5를 사용하여 적분 영역 번호 k0을 계산합니다. 이 영역 번호는 로컬 그리드의 기초를 형성합니다.

연속된 두 기저 벡터로부터 행렬 Bk0을 구축합니다. 이 행렬 Bk0이 로컬 그리드의 기초를 형성합니다.

저자는 로컬 그리드에서 좌표를 계산하는 변환(방정식 9)과 역변환(방정식 10)을 제시합니다.

주어진 점 p에 대해 구성 요소별로 반내림하여 로컬 그리드에서 해당 셀의 최하위 좌표를 계산합니다(방정식 11). 로컬 그리드에서 셀 모서리가 식별됩니다.

각 셀 모서리에 대해 S2에서 점을 계산하고 점 p까지 가장 작은 측지 거리를 산출하는 점을 찾습니다. 이 모서리는 SF 점 집합에서 가장 가까운 이웃입니다.

i에 대해 방정식 2를 풀고 가장 가까운 정수로 반올림하여 z 값에서 인덱스 i를 구합니다(방정식 12).

또한 저자는 수치 부정확성을 피하기 위해 더 높은 정밀도의 계산이 필요하다는 점을 강조하면서 고급 셰이딩 언어(HLSL)로 구현하는 방법에 대해 설명합니다. 정밀도 문제를 피하는 방법에 대해 논의하고, 32비트 부동 소수점 값으로 최대 2^21의 임의의 n과 최대 n = 2^23의 두 값의 거듭 제곱에 대해 구현이 성공적이라고 언급합니다.

```glsl
#define madfrac(A,B) mad((A),(B),-floor((A)*(B)))

float inverseSF(float3 p, float n) {
	float phi = min(atan2(p.y, p.x), PI), cosTheta = p.z;
	float k = max(2, floor(
		log(n * PI * sqrt(5) * (1 - cosTheta*cosTheta))
			/ log(PHI*PHI)));
	float Fk = pow(PHI, k)/sqrt(5);
	float F0 = round(Fk), F1 = round(Fk * PHI);

	float2x2 B = float2x2(
		2*PI*madfrac(F0+1, PHI-1) - 2*PI*(PHI-1),
		2*PI*madfrac(F1+1, PHI-1) - 2*PI*(PHI-1),
		-2*F0/n,
		-2*F1/n);
	float2x2 invB = inverse(B);
	float2 c = floor(mul(invB, float2(phi, cosTheta - (1-1/n))));

	float d = INFINITY, j = 0;
	for (uint s = 0; s < 4; ++s) {
		float cosTheta = dot(B[1], float2(s%2, s/2) + c) + (1-1/n);
		cosTheta = clamp(cosTheta, -1, +1)*2 - cosTheta;
		float i = floor(n*0.5 - cosTheta*n*0.5);
		float phi = 2*PI*madfrac(i, PHI-1);
		cosTheta = 1 - (2*i + 1)*rcp(n);
		float sinTheta = sqrt(1 - cosTheta*cosTheta);
		float3 q = float3(
		cos(phi)*sinTheta,
		sin(phi)*sinTheta,
		cosTheta);
		float squaredDistance = dot(q-p, q-p);
		if (squaredDistance < d) {
			d = squaredDistance;
			j = i;
		}
	}
	return j;
}
```

### 5 Applications

단위 벡터 양자화: SF 포인트 세트는 일반 벡터를 압축하는 데 사용할 수 있으며, 이는 g-버퍼 압축과 같이 메모리 대역폭이 병목 현상을 일으키는 렌더링 애플리케이션에 필수적입니다. SF 접근 방식은 8면체 노멀 벡터(ONV)에 비해 대표값의 분포가 더 균일하여 셀 영역의 표준 편차가 감소합니다. 따라서 비트 수가 증가하더라도 뛰어난 정밀도와 효율성을 제공합니다. 인코딩 시간은 ONV보다 약간 길지만 디코딩 성능은 더 빠르기 때문에 SF 포인트 세트는 전처리 중에 인코딩을 수행하고 렌더링 중에 디코딩하는 렌더링 애플리케이션에 특히 유용합니다.

텍스처 및 필터링: SF 포인트 세트는 균일한 분포로 인해 구형 신호를 저장하는 데도 유용합니다. 이러한 세트는 텍스처 룩업을 위해 큐브 매핑과 유사한 방식으로 사용할 수 있습니다. SF 포인트 세트는 샘플링 품질 측면에서 큐브 맵과 OEM(옥타헤드론 환경 맵)을 모두 능가할 수 있습니다. SF 포인트 세트에서 샘플을 검색하고 필터링하는 방법으로 근사 이웃 및 부드러운 필터링 기법이 언급되지만, 후자는 캐시 효율이 낮고 GPU 하드웨어 가속이 부족하기 때문에 비용이 더 높습니다.

![SF 텍스처 매핑 예: 가장 가까운 이웃 필터링 (위쪽 행) 및 부드러운 필터링 (아래쪽 행) 필터링은 128, 512, 2048, 8192, 그리고 65536 샘플에 대해 적용됩니다.](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled%204.png)

SF 텍스처 매핑 예: 가장 가까운 이웃 필터링 (위쪽 행) 및 부드러운 필터링 (아래쪽 행) 필터링은 128, 512, 2048, 8192, 그리고 65536 샘플에 대해 적용됩니다.

절차적 모델링: SF 포인트 세트는 절차적 모델링, 특히 구형 표면을 따라 오브젝트를 배치하거나 SF 격자를 따라 변위를 생성하는 데 사용할 수 있습니다. SF 포인트 세트에서 보로노이 셀의 경계는 그리드에 배치할 수 있는 오브젝트의 최대 크기를 결정하는 데 사용할 수 있습니다. 이 응용 프로그램은 암시적 함수 표현을 사용하여 SF 구체 플레이크 오브젝트와 SF 변위가 있는 구를 생성하는 데 시연됩니다. 이러한 복잡한 오브젝트는 구체 트레이싱을 사용하여 효율적으로 렌더링할 수 있습니다.

결론적으로 SF 포인트 세트는 노멀 벡터 압축, 텍스처 매핑, 절차적 모델링 등 컴퓨터 그래픽에서 다양하게 활용되는 강력한 툴로, ONV나 큐브 매핑과 같은 기존 방식에 비해 이점을 제공합니다.

### 6 Limitations

주소 지정 가능 포인트 수: 32비트 GPU 구현이 처리할 수 있는 주소 지정 가능 포인트의 수는 사용 가능한 부동 소수점 정밀도에 의해 제한됩니다. 최대 2^23개의 샘플을 처리할 수 있으며, 샘플 수는 n ≤ 2^21에 대해서만 임의로 선택할 수 있습니다(즉, 2의 거듭제곱이 아닌 값). 배정밀도 변형을 사용하면 이 제한을 개선할 수 있지만, GPU 구현에 미치는 성능 영향은 상당합니다. 잠재적인 해결 방법은 32비트 산술을 사용하면서 더 많은 수의 SF 포인트를 처리할 수 있는 고정 소수점 산술을 사용하는 것입니다.

![(a) 네 번의 재귀 수준을 가진 Sphereflake와 같은 프랙탈로, 총 2^24 + 1개의 구를 사용하여 256 SF 샘플이 사용되었습니다. (b) 역 매핑을 사용하여 암시적 displacement mapping이 적용된 구면(n = 128 SF 샘플 사용).](Spherical%20Fibonacci%20Mapping%206fce33854ab24672ab3f859410c97b4f/Untitled%205.png)

(a) 네 번의 재귀 수준을 가진 Sphereflake와 같은 프랙탈로, 총 2^24 + 1개의 구를 사용하여 256 SF 샘플이 사용되었습니다. (b) 역 매핑을 사용하여 암시적 displacement mapping이 적용된 구면(n = 128 SF 샘플 사용).

계산 강도가 높습니다: 역매핑을 위해 제안된 구현은 계산 집약적입니다. 그러나 더 작은 n(n ≤ 2^16)의 경우 가장 안쪽 루프에서 재연산을 생략함으로써 성능을 크게 향상시킬 수 있습니다. 그래픽 하드웨어의 컴퓨팅 성능이 지속적으로 개선되고 있는 반면 메모리 처리량/지연 시간이 여전히 주요 병목 현상으로 남아 있다는 점을 고려하면 이러한 제한은 시간이 지남에 따라 감소할 가능성이 높습니다. 또한 역매핑에는 메모리 연산이 필요하지 않으므로 지연 시간 숨기기 기술을 적용할 수 있습니다.

텍스처 필터링: 텍스처 필터링에 역매핑을 적용하는 것은 현재 직접적인 하드웨어 지원이 부족하고 일관되지 않은 메모리 액세스가 필요하기 때문에 성능 측면에서 문제가 있습니다. 이 문제를 해결하기 위해 모튼 오더와 같은 공간 채우기 곡선에 기반한 매핑을 로컬 그리드에 적용할 수 있습니다. 이는 향후 연구를 위한 흥미로운 방향입니다.

따라서 SF 포인트 세트는 상당한 이점을 제공하지만, 이러한 한계는 지속적인 개발과 최적화의 여지가 있음을 나타냅니다.