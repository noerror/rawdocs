# Attention Mesh: High-fidelity Face Mesh Prediction in Real-time

*이 논문은 실시간 얼굴 랜드마크 정확하게 예측하기 위한 통합된 어텐션 메시 모델을 제시합니다. 이 모델은 가상 메이크업 시도나 퍼펫팅과 같은 증강 현실 응용 프로그램에서 중요한 역할을 합니다.*

*기존 방식들과의 차별점으로, 이 논문은 여러 영역별 모델을 동시에 사용하는 대신 하나의 통합된 모델을 사용합니다. 이를 위해 어텐션 메커니즘을 활용하여 중요한 얼굴 영역(입술, 눈 등)에 더 많은 계산 리소스를 할당합니다. 이렇게 하면 여러 모델을 연달아 실행하는 cascaded 방식보다 정확성을 높이면서도 더 빠른 속도를 제공할 수 있습니다.*

*논문에서는 모델의 성능과 품질을 검증하기 위해 가상 메이크업 적용과 퍼펫팅 예시를 제시하며, 사용된 데이터셋과 결과를 자세히 설명합니다. 실험 결과, 어텐션 메시 모델은 기존 방식들보다 효과적이고 정확한 얼굴 랜드마크 예측을 가능케 한다는 것을 입증합니다.*

*이러한 효과적인 얼굴 랜드마크 예측 모델은 실시간 증강 현실 응용 프로그램에 큰 잠재력을 제공하며, 이 논문에서 제시된 모델과 결과는 개발자들이 다양한 AR 응용 프로그램을 더 현실적이고 효과적으로 구현하는 데 도움이 될 것으로 기대됩니다.*

[https://arxiv.org/abs/2006.10962](https://arxiv.org/abs/2006.10962)

[https://github.com/google/mediapipe](https://github.com/google/mediapipe)

- Jun 2020

### 1. Introduction

이 연구에서 저자는 상세한 3D 메시 템플릿을 이미지 속 사람의 얼굴에 정렬하는 문제에 초점을 맞춥니다. 이렇게 정렬된 메쉬는 가상 립스틱을 발라보거나 사실적인 입술과 눈동자 움직임으로 가상 아바타에 애니메이션을 적용하는 등 다양한 애플리케이션에 사용할 수 있습니다.

![어텐션 메시 서브모델에 의해 예측된 중요 윤곽](Attention%20Mesh%20High-fidelity%20Face%20Mesh%20Prediction%20%20d05f743fc1db41c7b850ecd83683a7ae/Untitled.png)

어텐션 메시 서브모델에 의해 예측된 중요 윤곽

연구진은 성능 저하 없이 입술과 눈과 같은 중요한 얼굴 영역에서 높은 정확도를 달성하는 것을 목표로 하는 '주의 메시'라는 새로운 접근 방식을 제안합니다. 얼굴 전체에 단일 회귀 네트워크를 사용하는 이전 방법에서는 이러한 중요한 영역의 품질이 저하되는 문제가 있었습니다.

이 문제를 해결하기 위해 저자는 계단식 접근 방식을 제안하지만, 이 방식에는 성능 문제가 있습니다. 대신 공간 변환기를 활용하여 중요한 영역의 정확도를 향상시키는 영역별 헤드가 있는 단일 모델을 사용합니다. 이 주의 메시 아키텍처는 캐스케이드 접근 방식과 동일한 성능을 제공하지만 추론 중에 최대 30% 더 빠르므로 모바일 장치에 더 적합합니다.

저자들은 이전 연구를 바탕으로 다양한 얼굴 감지기를 다루는 네트워크에서 영감을 얻었습니다. 이 새로운 접근 방식은 공간 변환기 및 지역별 헤드와 함께 단일 대규모 네트워크를 사용할 때보다 눈에 띄게 개선되었습니다.

이 백서에는 눈, 홍채, 입술의 랜드마크를 생성하기 위한 구현 세부 사항과 품질 및 성능 벤치마크가 포함되어 있습니다. 관심 메시 접근 방식은 서로 연결된 여러 개의 개별 네트워크에 비해 훈련 및 배포가 더 쉬우며, 내부적으로 일관성이 높다는 것이 입증되었습니다.

### 2. Attention mesh

주의 메시 모델은 세부적인 3D 메시 템플릿을 256×256 이미지의 사람 얼굴에 정렬하도록 설계되었습니다. 모델 아키텍처에는 여러 개의 하위 모델로 분할하는 작업이 포함됩니다. 하나의 하위 모델은 478개의 얼굴 메시 랜드마크를 모두 3D로 예측하고 특정 관심 영역(입술과 눈)에 대한 자르기 경계를 정의합니다. 다른 하위 모델은 주의 메커니즘을 사용하여 더 작은 24×24 피처 맵에서 눈과 입술의 랜드마크를 예측합니다.

![추론 파이프라인과 모델 아키텍처 개요](Attention%20Mesh%20High-fidelity%20Face%20Mesh%20Prediction%20%20d05f743fc1db41c7b850ecd83683a7ae/Untitled%201.png)

추론 파이프라인과 모델 아키텍처 개요

주의 메커니즘은 공간 변환기를 사용하여 더 큰 특징 맵에서 영역 특징을 추출합니다. 이 변환기는 아핀 변환 행렬에 의해 제어되며, 이를 통해 샘플링된 포인트 그리드를 확대/축소, 회전, 변환 및 기울일 수 있습니다. 이 메커니즘은 주의 모델에서 사용하는 기능을 향상시키고 엔드투엔드 학습을 가능하게 합니다.

![어텐션 메커니즘으로 사용되는 공간 변환기](Attention%20Mesh%20High-fidelity%20Face%20Mesh%20Prediction%20%20d05f743fc1db41c7b850ecd83683a7ae/Untitled%202.png)

어텐션 메커니즘으로 사용되는 공간 변환기

훈련에 사용된 데이터 세트는 다양한 조건에서 촬영된 30,000장의 실제 모바일 카메라 사진으로 구성되어 있습니다. 두드러진 윤곽의 일관성을 보장하기 위해 수동 주석을 달았으며, 합성 모델을 사용하여 근사화된 Z 좌표와 함께 2D의 실측 메쉬 정점 좌표를 얻었습니다.

### 3. Results

주의 메시 모델의 결과는 기본 메시, 눈, 입술에 대해 독립적으로 학습된 영역별 모델로 구성된 캐스케이드 모델과 비교되며, 이 모델은 순차적으로 실행됩니다.

성능:

- 주의 메시가 일반적인 최신 모바일 디바이스에서 캐스케이드 모델보다 25% 이상 빠르게 실행됩니다.
- 개별 구성 요소의 추론 시간은 다음과 같습니다:
    - 메시: 8.82ms
    - 입술: 4.18ms
    - 눈 및 홍채: 4.70ms
- 캐스케이드 모델의 총 추론 시간은 22.4ms이며, 주의 메시 모델의 경우 16.6ms입니다.

메시 품질:

- 두 모델의 메시 품질은 스케일 불변성을 위해 3D 안구 간 거리(입술과 눈의 경우 모서리 간 거리)로 정규화된 특정 지점의 예측 위치와 지상 실측 위치 사이의 평균 거리를 사용하여 비교합니다.
- 주의 메시 모델은 눈 영역에서 캐스케이드 모델보다 성능이 뛰어나며 입술 영역에서도 비슷한 성능을 보입니다.
- 특정 영역에 대한 평균 정규화 오류는 다음과 같습니다:
    - 전체: 메시(2.99), 입술(3.28), 눈(6.6)
    - 캐스케이드: 메시(2.99), 입술(2.70), 눈(6.28)
    - 주의 메시: 메시(3.11), 입술(2.89), 눈(6.04)

전반적으로 주의 메시 모델은 특정 얼굴 영역에서 더 빠른 추론 시간과 향상된 메시 품질을 제공하므로 3D 메시 템플릿을 이미지의 사람 얼굴에 정렬하는 데 더 효율적이고 정확한 솔루션이 될 수 있습니다.

### 4. Applications

관심도 메시 모델은 특히 실시간 증강 현실(AR) 시나리오에서 여러 가지 실용적인 용도로 사용할 수 있습니다:

AR 메이크업: 부자연스럽고 비현실적인 효과를 피하려면 AR 메이크업 애플리케이션에서 얼굴 메시를 정확하게 정렬하는 것이 중요합니다. 주의 메시 모델은 립스틱과 같은 메이크업 제품의 가상 시착에 사용할 수 있습니다. 입술 서브모델의 윤곽을 사용하여 사용자의 입술에 가상 립스틱을 정확하게 배치합니다. 10개의 이미지와 80명을 대상으로 한 A/B 테스트 결과, AR 메이크업 샘플의 46%가 실제 메이크업 샘플로 분류되었고, 실제 메이크업 샘플의 38%가 AR로 오인되는 등 긍정적인 결과가 나타났습니다.

![가상 메이크업 비교: 세부 조정 없는 기본 메시 (왼쪽) 대 어텐션 메시와 서브모델 (오른쪽)](Attention%20Mesh%20High-fidelity%20Face%20Mesh%20Prediction%20%20d05f743fc1db41c7b850ecd83683a7ae/Untitled%203.png)

가상 메이크업 비교: 세부 조정 없는 기본 메시 (왼쪽) 대 어텐션 메시와 서브모델 (오른쪽)

인형극: 주의 메시 모델은 애니메이션이나 게임에서 가상 인형극과 얼굴 트리거에도 사용할 수 있습니다. 입과 눈의 블렌드 모양 계수를 예측하기 위해 완전히 연결된 작은 모델이 구축됩니다. 주의 메시 서브모델의 출력은 이 블렌드 셰이프 네트워크에 공급됩니다. 다양한 사람 얼굴의 차이를 고려하기 위해 라플라시안 메시 편집을 적용하여 표준 메시를 예측된 메시로 변환합니다. 이를 통해 추가적인 미세 조정 없이 다양한 사람의 얼굴에 블렌드 셰이프 계수를 사용할 수 있습니다. 이 모델은 그림 5에서 볼 수 있듯이 얼굴 애니메이션과 퍼펫티어링을 효과적으로 구현할 수 있습니다.

![퍼펫팅 (Puppeteering)](Attention%20Mesh%20High-fidelity%20Face%20Mesh%20Prediction%20%20d05f743fc1db41c7b850ecd83683a7ae/Untitled%204.png)

퍼펫팅 (Puppeteering)

이러한 애플리케이션은 주의 메시 모델이 제공하는 정확하고 효율적인 정렬을 활용하여 AR 경험과 가상 캐릭터 애니메이션의 사실감과 성능을 향상시킵니다.

### 5. Conclusion

결론적으로, 유니티는 실시간으로 얼굴 메시를 정확하게 예측할 수 있는 통합 모델을 도입했습니다. 이 접근 방식의 핵심 혁신은 차별적인 주의 메커니즘을 사용하여 별도의 영역별 모델을 실행하는 데 따른 성능 저하 없이 입술과 눈과 같은 중요한 얼굴 영역에 컴퓨팅 리소스를 집중할 수 있다는 데 있습니다.

제안된 관심 메시 모델은 기존의 계단식 접근 방식에 비해 성능과 메시 품질 모두에서 상당한 개선을 보여줍니다. 특히 눈 영역에서 캐스케이드 모델의 정확도를 유지하거나 심지어 능가하면서 최신 모바일 디바이스에서 25% 이상의 속도 향상을 달성합니다.

우리의 모델은 가상 메이크업 트라이얼, 얼굴 인형극 등 다양한 실시간 증강 현실 애플리케이션에 활용될 수 있습니다. 가상 립스틱을 정확하게 바르는 AR 메이크업 컴포넌트는 사용자 테스트에서 유망한 결과를 보여주었습니다. 또한 얼굴 인형극 애플리케이션은 얼굴에 따라 미세 조정할 필요 없이 애니메이션과 표정을 제어할 수 있습니다.

곧 모델과 데모를 미디어파이프 라이브러리에 공개할 계획이며, 이를 통해 개발자들이 실시간 애플리케이션에 관심 메시의 성능을 활용할 수 있도록 지원할 예정입니다. 우리는 커뮤니티와 모델을 공유함으로써 실시간 얼굴 메시 예측과 그 응용 분야의 혁신과 발전을 촉진하는 것을 목표로 하고 있습니다.

- 모델의 입력과 출력
    
    어텐션 메시 (Attention Mesh) 모델의 입력과 출력은 다음과 같습니다:
    
    입력:
    
    - 어텐션 메시 모델은 256 × 256 크기의 이미지를 입력으로 받습니다. 이 이미지는 얼굴 감지기로부터 제공되거나 이전 프레임으로부터 추적된 이미지일 수 있습니다.
    
    출력:
    
    - 모델은 여러 개의 서브모델로 나뉘어져 있습니다. 첫 번째 서브모델은 얼굴 메시의 모든 478개 랜드마크를 3D로 예측하며, 각 관심 영역에 대한 자르기(crop) 경계를 정의합니다.
    - 나머지 서브모델들은 어텐션 메커니즘을 사용하여 24×24 크기의 특성 맵으로부터 해당하는 영역의 랜드마크를 예측합니다. 주로 립스와 두 개의 눈의 특정 얼굴 영역을 예측합니다.
    - 눈 서브모델은 개별적으로 분리된 결과로 아이리스도 따로 출력하여, 더 정적인 눈 랜드마크와 독립적인 아이리스를 모델링합니다.
    
    이와 같이 어텐션 메시 모델은 입력으로부터 얼굴에 대한 랜드마크와 관심 영역을 예측하여 출력합니다. 이렇게 예측된 랜드마크와 관심 영역은 가상 메이크업 적용이나 퍼펫팅과 같은 다양한 응용 프로그램에서 사용될 수 있습니다.
    
- 의의
    
    어텐션 메시 (Attention Mesh) 모델은 이전의 페이셜 랜드마크 방식들과 다른 점이 여럿 있습니다:
    
    1. 하나의 통합된 모델: 이전 방식들은 얼굴의 특정 영역(예: 눈, 입)에 대해 별도의 모델을 사용하는 경우가 많았습니다. 반면 어텐션 메시는 하나의 통합된 모델로 모든 얼굴 영역에 대한 랜드마크를 예측합니다. 이는 모델 구조를 단순화하고 내부적으로 일관성을 유지하는 데 도움이 됩니다.
    2. 어텐션 메커니즘: 어텐션 메시는 얼굴의 중요한 영역(예: 입술, 눈)에 더 많은 계산 리소스를 할당하는 어텐션 메커니즘을 사용합니다. 이를 통해 별도의 영역별 모델을 사용하는 것보다 높은 정확성을 달성할 수 있습니다.
    3. 속도와 성능: 어텐션 메시는 성능을 희생하지 않으면서도 더 빠른 속도를 제공합니다. 이전 방식들은 별도의 모델을 연달아 실행하는 cascaded(단계적인) 방식으로 동작하는 경우가 많았는데, 어텐션 메시는 한 번의 추론으로 더 빠르게 결과를 얻을 수 있습니다.
    4. 다양한 응용 프로그램: 어텐션 메시는 가상 메이크업 적용과 퍼펫팅과 같은 다양한 실시간 증강 현실(AR) 응용 프로그램에 사용될 수 있습니다. 더 높은 정확성과 빠른 속도를 제공하여 실제 환경에서 더 자연스러운 결과를 얻을 수 있습니다.
    
    이렇게 어텐션 메시는 이전의 페이셜 랜드마크 방식들과 비교하여 더 효율적이고 정확한 얼굴 랜드마크 예측을 가능하게 합니다.