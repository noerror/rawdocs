# Harmonic Coordinates

[https://graphics.pixar.com/library/HarmonicCoordinates/paper.pdf](https://graphics.pixar.com/library/HarmonicCoordinates/paper.pdf)

- SIGGRAPH 2007

![조화 좌표를 사용하여 케이지(검은색)로 변형된 캐릭터(파란색). (a) 바인딩 시점의 캐릭터와 케이지; (b) - (d) 세 가지 다른 케이지 자세에 따른 변형된 캐릭터.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled.png)

조화 좌표를 사용하여 케이지(검은색)로 변형된 캐릭터(파란색). (a) 바인딩 시점의 캐릭터와 케이지; (b) - (d) 세 가지 다른 케이지 자세에 따른 변형된 캐릭터.

## **1. Introduction**

2차원 바리센트릭 좌표는 다양한 응용 분야에서 중요한 역할을 합니다. 대표적으로 삼각형의 고로 쉐이딩(Gouraud shading)과 삼각형 베지에 패치(Bezier patch)의 정의에 사용됩니다. 삼각형의 꼭짓점 T1, T2, T3가 주어지면, 바리센트릭 좌표를 이용하여 삼각형 평면 내의 모든 점 p를 고유하게 표현할 수 있습니다. 이는 p를 β1(p)T1 + β2(p)T2 + β3(p)T3으로 나타내는 식으로 가능하며, 여기서 β1(p), β2(p), β3(p)는 점 p에 대한 T1, T2, T3의 바리센트릭 좌표입니다. 이러한 좌표는 여러 방식으로 정의될 수 있으며, 가장 간단한 방법은 다음 보간 조건을 만족하는 유일한 선형 함수로 정의하는 것입니다: βi(Tj) = δi,j (i, j = 1, 2, 3).

마찬가지로 3차원 바리센트릭 좌표는 꼭짓점 T1, T2, T3, T4를 가진 비퇴화 사면체(tetrahedron)에 대해 정의될 수 있습니다. 이러한 좌표는 2차원 경우와 같은 보간 조건을 만족하는 유일한 선형 함수로 정의됩니다.

Ju et al. (2005)이 설명한 바와 같이, 바리센트릭 좌표의 대부분의 용도는 보간 함수를 구성하는 데에서 비롯됩니다. 예를 들어, 고로 쉐이딩에서는 삼각형의 꼭짓점에 할당된 색상 c1, c2, c3가 삼각형 전체에 걸쳐 바리센트릭 좌표에 따라 보간됩니다. 이와 유사하게, 2차원 공간의 변형을 정의하는 공식도 사용할 수 있습니다. 예를 들어, 원래 삼각형의 꼭짓점의 새로운 위치 T'1, T'2, T'3이 주어지면, 점 p의 변형된 위치 p'는 β1(p)T'1 + β2(p)T'2 + β3(p)T'3으로 정의될 수 있습니다.

![두 개의 다른 객체(파란색)를 케이지(검은색)를 사용하여 변형하기 위해 사용된 2차원 일반화된 바리센트릭 좌표. 첫 번째 행은 "바인딩" 시점의 케이지와 객체를 보여줍니다. 두 번째 행은 평균 값 좌표를 사용하여 변형된 객체와 수정된 케이지를 보여줍니다. 마지막 행은 조화 좌표를 사용하여 변형된 객체와 수정된 케이지를 보여줍니다. 마지막 두 행에서는 원래 변형되지 않은 객체를 흰색으로 표시합니다. 두 방법은 볼록한 형태에서 유사한 성능을 보입니다. 이족 보행의 경우, 조화 좌표는 왼쪽 다리의 케이지 점의 움직임이 오른쪽 다리의 점에 영향을 미치지 않아 더 나은 성능을 보입니다.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled%201.png)

두 개의 다른 객체(파란색)를 케이지(검은색)를 사용하여 변형하기 위해 사용된 2차원 일반화된 바리센트릭 좌표. 첫 번째 행은 "바인딩" 시점의 케이지와 객체를 보여줍니다. 두 번째 행은 평균 값 좌표를 사용하여 변형된 객체와 수정된 케이지를 보여줍니다. 마지막 행은 조화 좌표를 사용하여 변형된 객체와 수정된 케이지를 보여줍니다. 마지막 두 행에서는 원래 변형되지 않은 객체를 흰색으로 표시합니다. 두 방법은 볼록한 형태에서 유사한 성능을 보입니다. 이족 보행의 경우, 조화 좌표는 왼쪽 다리의 케이지 점의 움직임이 오른쪽 다리의 점에 영향을 미치지 않아 더 나은 성능을 보입니다.

이제 꼭짓점이 세 개 이상인 다각형에 대해 이러한 2차원 좌표와 보간 함수를 정의하는 문제를 고려해보겠습니다. 보간 조건은 여전히 중요하지만, 선형 함수만으로는 이러한 조건을 만족시키기에 충분하지 않습니다. 따라서 바리센트릭 좌표를 임의의 닫힌 다각형과 다면체로 일반화하는 방법이 중요한 질문으로 등장합니다.

바리센트릭 좌표의 일반화 문제는 매우 풍부하며, 최근 몇 년 동안 많은 주목을 받아왔습니다. Ju et al. (2005)은 이러한 연구의 좋은 개요를 제공합니다. 모든 바리센트릭 좌표의 속성을 일반화 과정에서 유지할 수 없기 때문에, 속성을 어떻게 완화할 수 있는지에 따라 다양한 방법이 존재합니다.

우리는 특히 Ju et al. (2005)에서 설명된 것처럼, 캐릭터 변형을 위해 일반화된 바리센트릭 좌표를 사용하는 것에 관심이 있습니다. 이 응용에서는 변형할 객체가 케이지(cage)라고 부르는 닫힌 형태에 상대적으로 배치됩니다. 케이지 꼭짓점 Ci에 대한 각 객체 점 p의 일반화된 바리센트릭 좌표 gi(p)를 계산하여 객체를 케이지에 "바인딩"합니다. 케이지 꼭짓점이 새로운 위치 C'i로 이동할 때, 변형된 점 p'는 gi(p)C'i로 계산됩니다.

여러 일반화된 바리센트릭 좌표 공식 중에서 평균 값 좌표(mean value coordinates)는 특히 유용합니다. 왜냐하면:

- 변형을 제어하는 케이지는 2차원에서는 단순한 닫힌 다각형, 3차원에서는 단순한 닫힌 삼각형 메쉬일 수 있습니다.
- 좌표가 부드럽기 때문에 변형도 부드럽습니다.
- 좌표가 선형 함수를 재생하기 때문에 객체가 바인딩될 때 "팝" 현상이 발생하지 않습니다. 즉, Equation 5에서 C'i를 Ci로 설정하면 p'는 p로 줄어듭니다.

평균 값 좌표는 캐릭터의 관절 움직임에 적합하지 않습니다. 이를 해결하기 위해 비음성(non-negativity)과 내부 국소성(interior locality) 등의 추가 속성을 가진 일반화된 바리센트릭 좌표가 필요합니다. 이 논문에서는 라플라스 방정식의 해로서 이러한 좌표를 생성하는 방법을 보여줍니다. 이 좌표를 조화 좌표(harmonic coordinates)라고 부르며, 이들이 생성하는 변형을 조화 변형(harmonic deformations)이라고 합니다.

![평균 값과 조화 보간의 비교. (a) 평균 값 보간에 해당하는 직선 경로. (b) 조화 보간에 해당하는 브라운 경로.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled%202.png)

평균 값과 조화 보간의 비교. (a) 평균 값 보간에 해당하는 직선 경로. (b) 조화 보간에 해당하는 브라운 경로.

## **2. Theory**

이 섹션에서는 앞서 소개한 내용을 이론적으로 형식화합니다. 먼저, C를 d 차원에서 조각면으로 이루어진 닫힌 부피(케이지)라고 정의합시다. 기하학에서는 이러한 형태를 다포체(polytopes)라고 하지만, 이 논문에서는 이를 케이지(cage)라고 부르겠습니다. 2차원에서는 케이지가 닫힌 다각형으로 둘러싸인 평면의 영역을 나타내며, 3차원에서는 평면으로 둘러싸인 닫힌 공간 영역을 나타냅니다.

케이지의 각 꼭짓점 Ci에 대해 C 내의 함수 hi(p)를 다음 조건을 만족하도록 정의하고자 합니다:

1. **보간 조건(Interpolation):** hi(Cj) = δi,j.
2. **아핀 불변성(Affine-invariance):** ∑i hi(p) = 1 for all p ∈ C.
3. **바리센트릭 좌표의 엄격한 일반화(Strict generalization of barycentric coordinates):** C가 단순체(simplex)일 때, hi(p)는 Ci에 대한 p의 바리센트릭 좌표입니다.
4. **부드러움(Smoothness):** 함수 hi(p)는 최소한 C^1 부드러움(C^1 smooth)을 가져야 합니다.
5. **비음성(Non-negativity):** hi(p) ≥ 0 for all p ∈ C.
6. **선형 재생(Linear reproduction):** 임의의 함수 f(p)에 대해, 좌표 함수는 다음과 같이 정의된 보간자 H[f](https://www.notion.so/p)를 사용하여 선형 함수를 정확하게 재생해야 합니다:
H[f](https://www.notion.so/p) = ∑i hi(p)f(Ci).
7. **내부 국소성(Interior locality):** 비음성에 더해, 좌표 함수가 내부 극점을 가지지 않아야 합니다.

평균 값 좌표(mean value coordinates)는 비음성과 내부 국소성을 제외한 모든 조건을 충족합니다. 이 논문에서는 라플라스 방정식의 해로서 이러한 모든 조건을 만족하는 좌표 함수를 얻을 수 있다고 주장합니다:
∇^2 hi(p) = 0 for all p ∈ Int(C).

경계 조건이 적절히 선택되면, 라플라스 방정식의 해로서 이러한 좌표를 얻을 수 있습니다.

이를 이해하기 위해, 2차원에서 조화 좌표를 구성하는 방법을 먼저 살펴보겠습니다. 이후에 이를 d 차원으로 일반화하는 것이 명확해질 것입니다. 2차원에서 hi(p)에 대한 적절한 경계 조건은 다음과 같습니다: ∂p가 C의 경계 ∂C 위의 점일 때, hi(∂p) = φi(∂p) for all ∂p ∈ ∂C, 여기서 φi(∂p)는 φi(Cj) = δi,j를 만족하는 구간별 선형 함수입니다.

이제 위 조건을 만족하는 함수가 앞서 열거한 조건들을 충족함을 보이겠습니다. 선형 재생 속성은 여러 조건을 포함하므로, 이를 증명하기 위해 다른 순서로 조건을 검증합니다.

- **보간(Interpolation):** hi(Cj) = φi(Cj) = δi,j.
- **부드러움(Smoothness):** 조화 함수는 경계에서 C^∞ 부드러움을 가집니다.
- **비음성(Non-negativity):** 조화 함수는 경계에서 극값을 가지므로, 내부 값은 [0, 1] 범위에 속합니다.
- **선형 재생(Linear reproduction):** f(p)가 임의의 선형 함수일 때, H[f](https://www.notion.so/p) = f(p)를 만족합니다.
- **아핀 불변성(Affine invariance):** 함수 f(p) = 1은 선형 함수이므로, 선형 재생 속성에서 바로 따라옵니다.
- **바리센트릭 좌표의 엄격한 일반화(Strict generalization of barycentric coordinates):** 케이지가 단순 삼각형일 때, 조화 좌표는 바리센트릭 좌표로 환원됩니다.
- **내부 국소성(Interior locality):** 비음성과 조화 함수가 내부 극점을 가지지 않음으로부터 따라옵니다.

이제 조화 좌표를 1차원에서부터 3차원, 더 나아가 d 차원으로 확장하는 방법을 설명하겠습니다. 1차원에서 케이지는 두 꼭짓점 C0와 C1로 구성된 선분이며, 라플라스 방정식은 d^2 hi(p) / dp^2 = 0로 단순화됩니다. 따라서 hi(p)는 선형 함수가 되며, 보간 조건에 의해 결정됩니다.

![오목한 케이지에 대한 좌표 함수의 비교. (a) 꼭짓점 C1,...,C15를 가진 2D 케이지; (b) C2에 대한 평균 값 좌표의 값 (노란색은 양수 값을, 초록색은 음수 값을 나타냄); (c) C2에 대한 조화 좌표의 값 (빨간색은 함수가 정의되지 않은 케이지 외부를 나타냄). 값이 0에 가까운 값을 강조하기 위해, 노란색과 초록색의 강도는 좌표 함수 값의 제곱근에 비례합니다. (b)에서 오른쪽 다리에 초록색이 존재하는 것은 C2의 위치가 오른쪽 다리의 객체 점에 큰 영향을 미친다는 것을 나타냅니다. (c)에서의 해당 영향은 본질적으로 0입니다.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled%203.png)

오목한 케이지에 대한 좌표 함수의 비교. (a) 꼭짓점 C1,...,C15를 가진 2D 케이지; (b) C2에 대한 평균 값 좌표의 값 (노란색은 양수 값을, 초록색은 음수 값을 나타냄); (c) C2에 대한 조화 좌표의 값 (빨간색은 함수가 정의되지 않은 케이지 외부를 나타냄). 값이 0에 가까운 값을 강조하기 위해, 노란색과 초록색의 강도는 좌표 함수 값의 제곱근에 비례합니다. (b)에서 오른쪽 다리에 초록색이 존재하는 것은 C2의 위치가 오른쪽 다리의 객체 점에 큰 영향을 미친다는 것을 나타냅니다. (c)에서의 해당 영향은 본질적으로 0입니다.

이제 2차원 조화 좌표를 구성하는 방법을 다시 서술하면 다음과 같습니다: 보간 조건 hi(Cj) = δi,j를 시작점으로 합니다. 이는 C의 0차원 조각(꼭짓점)에서 좌표를 결정합니다. 다음으로 1차원 조각(모서리)에 대해 1차원 라플라스 방정식을 사용하여 좌표를 확장합니다. 마지막으로 2차원 조각(내부)에 대해 2차원 라플라스 방정식을 사용하여 좌표를 확장합니다.

이 방법을 3차원 및 더 높은 차원으로 확장하면, d 차원 케이지 C의 꼭짓점 Ci에 대한 d 차원 조화 좌표 hi(p)는 다음 조건을 만족하는 유일한 함수입니다:

1. hi(Cj) = δi,j.
2. 모든 차원 k ≤ d의 조각에 대해 k 차원 라플라스 방정식을 만족합니다.

이렇게 정의된 조화 좌표가 요구되는 속성을 가지는지 증명하기 위해, 1차원 조각을 기준으로 귀납적으로 증명할 수 있습니다. 2차원에 대한 증명은 일반화 가능하며, 모든 차원에서 유효합니다.

또한, 조화 좌표와 Warren의 방법은 다음 속성을 공유합니다:

- **차원 축소(Dimension reduction):** d 차원 조화 좌표는 k < d 차원 조각에 대해 k 차원 조화 좌표로 축소됩니다. 예를 들어, 삼각형 면으로 경계가 형성된 3차원 케이지의 조화 좌표는 면에 대해 바리센트릭 좌표로 축소됩니다.

이로써, 조화 좌표가 라플라스 방정식의 해로서 정의되고, 이러한 좌표가 다양한 유용한 속성을 가짐을 설명하였습니다.

## **3. Implementation**

이 섹션에서는 조화 좌표(harmonic coordinates)를 구현하는 방법을 설명합니다. 2차원과 3차원 모두에서 간단한 계층적 유한 차분 솔버를 사용하며, 원칙적으로는 라플라스 방정식의 해를 구하기 위해 어떤 해법(예: 유한 요소법)도 사용할 수 있습니다.

먼저 비계층적(non-hierarchical) 솔버의 구현 방법을 설명하고, 이후 계층적(hierarchical) 솔버로의 확장을 설명합니다. 케이지의 각 꼭짓점 Ci에 대해, 케이지 내부에서 hi(p)를 다음과 같은 단계로 근사합니다:

1. **격자 할당(Allocate a grid):** 케이지를 포함할 수 있는 크기의 정규 격자(grid)를 할당합니다. 우리는 격자를 한 변에 2^s개의 셀을 가지도록 선택합니다. 모든 2차원 예제는 s = 6을 사용하였고, 3차원 예제는 s = 7을 사용하였습니다. 각 격자 셀은 값과 태그를 가집니다. 태그는 UNTYPED, BOUNDARY, INTERIOR 또는 EXTERIOR 중 하나입니다.
2. **격자 초기화(Initialize the grid):**
    - 모든 셀을 UNTYPED로 태그합니다.
    - 경계 조건을 격자에 스캔 변환(scan-convert)하여 각 스캔 변환된 셀을 BOUNDARY 태그로 마크합니다. 2차원에서는 섹션 2에서 정의된 함수 φi(p)를 격자에 스캔 변환합니다. 3차원에서는 구간별 선형적으로 변하는 경계 값을 사용하여 간단한 복셀 기반의 삼각형 스캔 변환기를 사용합니다.
    - 모서리 셀 중 하나에서 시작하여 외부를 플러드 필(flood fill)하여 방문한 각 셀을 EXTERIOR 태그로 마크합니다. 플러드 필 재귀는 BOUNDARY 태그를 만날 때 중지됩니다. 경계가 닫혀 있으므로 이 단계에서는 외부 셀만 방문합니다.
    - 남은 UNTYPED 셀을 INTERIOR로 마크하고, 조화 좌표 값을 0으로 설정합니다.
3. **라플라스 평활화(Laplacian smooth):** 각 INTERIOR 셀에 대해 해당 셀의 값을 이웃 셀 값의 평균으로 대체합니다. 2차원에서는 셀이 4연결(4-connected)로 간주되고, 3차원에서는 6연결(6-connected)로 간주됩니다. 이 라플라스 평활화 단계는 종료 조건에 도달할 때까지 반복됩니다. 우리 솔버는 셀의 평균 변화가 특정 임계값 τ 이하로 떨어질 때 종료합니다. 이 논문에서는 τ = 10^-5를 사용하였습니다.

위에서 설명한 솔버는 라플라스 방정식이 매우 부드럽게 변하는 함수를 생성한다는 점에서 상당히 가속될 수 있습니다. 문제를 더 낮은 해상도에서 먼저 해결하면 반복 단계의 더 나은 시작점을 얻을 수 있습니다. 계층적 솔버는 이 관찰을 활용하여 경계 조건을 더 거친 레벨로 "풀링"하고, 재귀적으로 해결한 다음, 더 거친 해를 더 세밀한 레벨로 "푸시"한 다음 라플라스 평활화 단계를 반복하여 수렴할 때까지 진행합니다.

2차원에서 풀링 단계는 2^s × 2^s 격자에서 2^(s-1) × 2^(s-1) 격자로 거친 레벨 격자를 계산합니다. 3차원에서는 각 거친 레벨 격자 셀이 더 세밀한 레벨의 여덟 개 셀을 대표합니다. 두 경우 모두, 거친 셀은 자식 셀 중 하나라도 BOUNDARY로 태그된 경우 BOUNDARY로 태그되고, 모든 자식이 EXTERIOR인 경우 EXTERIOR로 태그되며, 모든 자식이 INTERIOR인 경우 INTERIOR로 태그됩니다. 거친 레벨 BOUNDARY 셀의 값은 더 세밀한 레벨 BOUNDARY 셀 값의 평균입니다. INTERIOR 셀은 0으로 초기화됩니다.

푸시 단계는 거친 레벨 셀의 값을 더 세밀한 레벨의 INTERIOR 셀로 전파합니다. 구체적으로, 더 세밀한 레벨의 모든 INTERIOR 셀은 해당 부모 셀의 값을 받습니다.

이렇게 해서 2차원과 3차원에서 조화 좌표를 계산할 수 있으며, 예제를 통해 그 성능을 확인할 수 있습니다.

## **4. Results**

이 섹션에서는 2차원 및 3차원에서 조화 좌표(harmonic coordinates)를 사용한 변형의 결과를 소개합니다. 결과는 논문에 첨부된 비디오와 그림 2에서 시각적으로 확인할 수 있습니다. 3차원 조화 변형의 예는 그림 1에 제시되어 있으며, 여기에서는 8019개의 꼭짓점을 가진 객체를 112개의 꼭짓점을 가진 케이지(cage)에 바인딩(binding)했습니다. 이 예에서 계층적 솔버(hierarchical solver)를 사용하여 가장 세밀한 격자가 한 변에 2^7개, 가장 거친 격자가 한 변에 2^4개인 경우 바인딩 시간은 262초가 걸렸습니다. 종료 허용 오차 τ는 10^-5였습니다. 평균 값 좌표(mean value coordinates)의 경우 Ju et al. (2005)에서 발표된 알고리즘을 사용하여 바인딩 시간은 443초가 걸렸습니다.

![내부 제어의 예. (a) 케이지와 객체의 바인딩 시점을 보여주며, 케이지에 고립된 내부 꼭짓점이 추가되었습니다; (b) 내부 꼭짓점의 움직임에 대한 응답으로 변형된 객체를 보여줍니다.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled%204.png)

내부 제어의 예. (a) 케이지와 객체의 바인딩 시점을 보여주며, 케이지에 고립된 내부 꼭짓점이 추가되었습니다; (b) 내부 꼭짓점의 움직임에 대한 응답으로 변형된 객체를 보여줍니다.

이 예에서는 조화 좌표 솔버가 평균 값 좌표 솔버보다 더 빠르게 동작합니다. 주된 이유는 조화 좌표 솔버가 한 번에 전체 좌표 함수를 계산하기 때문입니다. 한 번 좌표 함수가 계산되면 각 객체 점의 값을 조회하는 것은 매우 저렴합니다. 따라서 조화 좌표 솔버의 실행 시간은 케이지 꼭짓점의 수에 가장 크게 영향을 받습니다. 반면, 평균 값 좌표 솔버는 각 객체 점에 대해 전체 케이지를 반복합니다. 객체 점의 수가 케이지 점의 수에 비해 적을 때는 평균 값 솔버가 더 빠릅니다. 객체 점의 수가 증가함에 따라 조화 솔버가 결국 평균 값 솔버보다 성능이 뛰어나게 됩니다. 이 경향은 표 1에 나타나 있습니다.

조화 좌표의 잠재적인 단점은 메모리 오버헤드입니다. 평균 값 좌표의 간단한 구현은 케이지의 각 면에 대해 일정량의 추가 메모리만 필요합니다. 반면, 단순한 조화 솔버의 메모리 요구량은 솔버 격자에 의해 지배됩니다. 2차원에서는 격자가 일반적으로 작아서(우리 예제에서는 약 40Kbytes) 큰 문제가 되지 않지만, 3차원에서는 격자가 상당히 커질 수 있습니다(우리 예제에서는 약 25Mbytes).

앞서 설명한 방법으로 계산된 조화 좌표는 수치적 근사치일 뿐입니다. 셀 크기와 종료 임계값에 따라 정확도가 결정됩니다. 일반적으로 근사 오차는 객체 점 p가 케이지에 바인딩될 때 잔차 Δ(p)을 경험하게 합니다:
Δ(p) = p - ∑i hi(p)Ci.

또한, 임계값 이하의 좌표를 합에서 제거하는 과정을 희소화(sparsification)라고 합니다. 희소화로 인한 잔차는 평균 값 좌표와 조화 좌표 모두에서 발생합니다. 해결의 정확도가 떨어지거나 희소화가 지나치게 공격적인 경우, 잔차를 계산하여 바인딩 시점에 객체 점마다 저장할 수 있습니다. 그런 다음 변형 시점에 잔차를 추가하여 변형의 정확도를 개선할 수 있으며, 실행 시간 오버헤드는 거의 없습니다. 이 논문과 첨부 비디오에서 사용된 예제들은 충분히 정확하여 잔차를 사용하지 않았습니다.

**4.1 확장: 세포 복합체로의 확장(Extension to cell complexes)**

조화 좌표는 현재까지 폴리토프(polytope)로 구성된 케이지를 기준으로 정의되었습니다. 이는 변형이 케이지의 경계 꼭짓점에 의해 완전히 제어됨을 의미합니다. 많은 경우 이는 이상적이지만, 때로는 아티스트가 변형의 세부 사항을 더 잘 제어할 수 있도록 하는 것이 유용합니다. 간단한 예로, 캐릭터의 머리 부분 변형을 더 세밀하게 제어하기 위해 추가적인 고립된 꼭짓점을 추가하는 방법을 들 수 있습니다(그림 5 참조).

또한, 케이지에 내부 면과 모서리를 포함하도록 확장할 수도 있습니다. 내부 모서리 집합을 포함하는 예가 그림 6에 나와 있습니다. 이 그림에서 내부 제어는 매니폴드(manifold)를 형성할 필요가 없으며, 케이지의 내부가 선형 세포 복합체(linear cell complex)를 형성하면 충분합니다. 직관적으로, 선형 세포 복합체는 교차점이 빈 공간이거나 다른 세포인 세포(꼭짓점, 선형 모서리, 평면 면)들의 집합입니다.

조화 좌표는 내부 경계 조건을 경계와 동일하게 처리하여 이러한 케이지에 쉽게 적응할 수 있습니다. 조화 함수는 내부 경계 조건에서 연속성(C^0)을 가지므로, 내부 면을 포함하는 경우 조화 좌표는 내부 면을 따라 C^0 부드러움만을 가집니다. 실제로는 내부 면이 사용될 때, 변형될 객체가 내부 면을 가로지르지 않도록 배치해야 합니다.

이로써, 조화 좌표를 사용한 변형의 성능과 다양한 응용 가능성을 설명하였습니다.

![선형 세포 복합체를 사용한 내부 제어의 예. (a) 내부 제어가 없는 케이지를 사용하여 변형된 객체. (b) 케이지에 내부 세포 복합체가 추가된 동일한 객체의 바인딩 시점. (c) 내부 제어가 있는 케이지에서 변형된 객체. (c)에서 수정된 케이지 점의 영향이 훨씬 더 국부적(local)임을 알 수 있습니다.](Harmonic%20Coordinates%20cc5ba375038249daaa306bb780631052/Untitled%205.png)

선형 세포 복합체를 사용한 내부 제어의 예. (a) 내부 제어가 없는 케이지를 사용하여 변형된 객체. (b) 케이지에 내부 세포 복합체가 추가된 동일한 객체의 바인딩 시점. (c) 내부 제어가 있는 케이지에서 변형된 객체. (c)에서 수정된 케이지 점의 영향이 훨씬 더 국부적(local)임을 알 수 있습니다.

## **5. Summary**

이 논문에서는 라플라스 방정식(Laplace's equation)의 해를 통해 일반화된 바리센트릭 좌표(generalized barycentric coordinates)를 생성하는 새로운 방법을 제시했습니다. 이를 통해 평균 값 좌표(mean value coordinates)가 갖는 비음성(non-negativity)과 내부 국소성(interior locality) 등의 문제를 해결할 수 있음을 보여주었습니다. 이 새로운 조화 좌표(harmonic coordinates)는 평균 값 좌표보다 다음과 같은 점에서 개선된 특성을 가지고 있습니다:

1. **내부 국소성(Interior locality):** 좌표가 케이지와 객체의 점들 사이의 거리 함수로서 감소하므로, 객체가 자연스럽게 변형됩니다.
2. **비음성(Non-negativity):** 객체의 점들이 케이지의 점들과 동일한 방향으로 움직이도록 보장합니다.

또한, 조화 좌표는 d 차원에서도 쉽게 확장 가능하며, 내부 세부 사항의 제어를 위해 내부 꼭짓점, 모서리 및 면을 포함한 케이지를 사용할 수 있습니다.

**주요 특성 및 개선점:**

- **부드러움(Smoothness):** 조화 좌표는 부드러운 변형을 생성합니다.
- **선형 재생(Linear reproduction):** 선형 함수를 정확하게 재생하여 변형 과정에서 객체가 튀지 않도록 보장합니다.
- **차원 축소(Dimension reduction):** d 차원 조화 좌표는 k < d 차원 조각에 대해 k 차원 조화 좌표로 축소될 수 있습니다.

**구현 및 성능:**

- 계층적 유한 차분 솔버(hierarchical finite difference solver)를 사용하여 2차원 및 3차원에서 효율적으로 조화 좌표를 계산할 수 있습니다.
- 조화 좌표는 객체 점의 수가 케이지 점의 수보다 많을 때 평균 값 좌표보다 계산이 더 빠르며, 메모리 요구량은 더 크지만, 효율적인 근사 방법을 통해 성능을 향상시킬 수 있습니다.

이 논문은 조화 좌표가 다양한 응용 분야, 특히 캐릭터 변형(character deformation)에서 유용함을 강조하며, 기존의 평균 값 좌표의 단점을 극복하는 새로운 방법을 제안합니다. 조화 좌표는 특정 속성을 유지하면서 다양한 방식으로 일반화될 수 있어, 다양한 차원과 상황에서 적용할 수 있습니다.