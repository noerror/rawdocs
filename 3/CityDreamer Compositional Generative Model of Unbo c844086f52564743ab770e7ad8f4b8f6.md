# CityDreamer: Compositional Generative Model of Unbounded 3D Cities

[https://arxiv.org/abs/2309.00610](https://arxiv.org/abs/2309.00610)

[https://infinitescript.com/project/city-dreamer/](https://infinitescript.com/project/city-dreamer/)

- Sep 2023

### 1 Introduction

메타버스의 개념이 성장함에 따라 3D 에셋, 특히 3D 도시 제작에 대한 관심이 높아지고 있습니다. 이러한 도시는 도시 계획, 시뮬레이션, 비디오 게임 등에 활용되고 있습니다. 3D 씬 제작의 일부 발전에도 불구하고 건물의 다양한 외관으로 인해 3D 도시를 제작하는 것은 여전히 어려운 과제입니다.

![제안된 CityDreamer는 정의된 기하학과 다양한 스타일의 무한 도시 레이아웃 및 다양한 시점 일관성을 가진 외관을 생성합니다.](CityDreamer%20Compositional%20Generative%20Model%20of%20Unbo%20c844086f52564743ab770e7ad8f4b8f6/Untitled.png)

제안된 CityDreamer는 정의된 기하학과 다양한 스타일의 무한 도시 레이아웃 및 다양한 시점 일관성을 가진 외관을 생성합니다.

이에 시티드리머라는 새로운 접근 방식이 도입되었습니다. 이전 모델과 달리 시티드리머는 건물과 도로, 공원과 같은 배경 요소를 분리하여 생성합니다. 건물용 모듈과 도시 배경용 모듈의 두 가지 모듈을 사용합니다. 이 모델에는 건물의 다양한 외관과 배경 요소의 일관되지만 불규칙한 텍스처를 처리하기 위한 특수 설계가 적용되었습니다.

생성된 도시를 실제처럼 보이게 하기 위해 두 개의 데이터 세트, 즉 OSM과 GoogleEarth가 생성됩니다. 오픈스트리트맵의 OSM은 80개 도시에 대한 지도와 건물 높이를 제공합니다. Google 어스 스튜디오의 GoogleEarth는 건물과 도로에 대한 데이터를 포함하여 다양한 각도에서 촬영한 24,000장의 뉴욕시 이미지를 제공합니다.

요약하면, 시티드리머는 사실적인 대규모 3D 도시를 제작할 수 있는 새로운 도구로, 포괄적인 데이터 세트로 뒷받침되며 다른 주요 3D 모델과 비교했을 때 우수한 성능을 발휘하는 것으로 나타났습니다.

### 2. Related Work

1. 3D 인식 GAN:
- 생성적 적대 신경망(GAN)은 2D 이미지 생성에서 놀라운 성공을 거두었습니다.
- GAN을 3D 영역으로 확장하려는 시도가 있었습니다. 이러한 시도 중 일부는 복셀 기반 표현을 활용했으며, 기본적으로 2D CNN에 깊이 차원을 추가했습니다.
- 그러나 3D 장면에는 더 높은 연산 및 메모리 요구량이 따른다는 문제가 있습니다.
- 신경 방사장(NeRF)의 발전으로 볼륨 렌더링이 도입되어 GAN이 2D 이미지에서 3D 특성을 학습할 수 있게 되었습니다.
- 현재 대부분의 3D 인식 GAN은 미리 정의된 경계가 있는 사람의 얼굴, 신체, 물체와 같은 특정 장면을 위해 설계되었습니다.

2. 장면 수준 이미지 생성:

- 개별 오브젝트를 생성하는 데 성공한 2D 모델은 많지만, 전체 장면을 생성하는 것은 다양성으로 인해 더 어렵습니다.
- 시맨틱 세그멘테이션 맵이나 뎁스 맵과 같이 픽셀 밀도가 높은 입력을 기반으로 하는 장면 수준의 콘텐츠 생성 기술이 도입되었습니다.
- 일부 모델은 3D 씬 합성을 달성했지만 완전한 3D 일관성이나 새로운 월드의 전방 생성 기능이 부족할 수 있습니다.
- 몇 가지 고급 방법을 사용하면 대규모로 일관된 3D 장면을 생성할 수 있습니다.
- 일부 작업은 리소스 집약적인 3D 데이터세트 또는 CAD 검색을 사용하여 실내 장면을 만드는 데 중점을 둡니다.

### 3. The Proposed Method

1.  시티드리머 프레임워크:

- 무한한 도시 레이아웃 생성기: 도시의 대규모 레이아웃을 생성합니다.
- 도시 배경 생성기: 배경 이미지와 마스크를 생성합니다.
- 건물 인스턴스 생성기: 개별 건물의 이미지와 해당 마스크를 생성합니다.
- 컴포지터: 배경 이미지와 건물 이미지를 하나의 일관된 장면으로 병합합니다.

2.  무제한 도시 레이아웃 생성기:

- 도시 레이아웃 표현: 시맨틱 맵과 높이 필드를 사용하여 3D 객체와 그 위치를 정의하는 3D 도시 레이아웃을 생성합니다.
- 도시 레이아웃 생성: MaskGIT [9] 및 VQVAE [49, 54]를 사용하여 도시 레이아웃을 생성합니다.
- 손실 함수: 이 단계는 L1 손실, 교차 엔트로피 손실, 평활도 손실의 조합으로 훈련됩니다.
    
    ![CityDreamer 개요. 무한 레이아웃 생성기는 도시 레이아웃 L을 만듭니다. 그런 다음 도시 배경 생성기는 L에서 기능을 검색하기 위해 레이-샘플링을 수행하고, 도로, 녹지, 물 지역과 같은 배경 객체에 중점을 둔 배경 이미지를 생성합니다. 마찬가지로 건물 인스턴스 생성기는 또 다른 부피 렌더러로 건물 인스턴스 이미지를 렌더링합니다. 마지막으로 합성기는 렌더링 된 배경과 건물 인스턴스를 병합하여 통합되고 일관된 최종 이미지를 만듭니다. "Mod.", "Cond.", "Bg.", 및 "Bldg."는 각각 "Modulation", "Condition", "Background", 및 "Building"을 나타냅니다.](CityDreamer%20Compositional%20Generative%20Model%20of%20Unbo%20c844086f52564743ab770e7ad8f4b8f6/Untitled%201.png)
    
    CityDreamer 개요. 무한 레이아웃 생성기는 도시 레이아웃 L을 만듭니다. 그런 다음 도시 배경 생성기는 L에서 기능을 검색하기 위해 레이-샘플링을 수행하고, 도로, 녹지, 물 지역과 같은 배경 객체에 중점을 둔 배경 이미지를 생성합니다. 마찬가지로 건물 인스턴스 생성기는 또 다른 부피 렌더러로 건물 인스턴스 이미지를 렌더링합니다. 마지막으로 합성기는 렌더링 된 배경과 건물 인스턴스를 병합하여 통합되고 일관된 최종 이미지를 만듭니다. "Mod.", "Cond.", "Bg.", 및 "Bldg."는 각각 "Modulation", "Condition", "Background", 및 "Building"을 나타냅니다.
    

3. 도시 배경 생성기:

- 씬 표현: 조감도(BEV)를 사용하여 표현합니다.
    
    ![제안된 데이터 세트 개요. (a) OSM 데이터 세트는 쌍으로 된 높이 필드와 의미 맵을 포함하여 실제 세계 도시 레이아웃을 제공합니다. (b) 높이 필드와 의미 맵에서 생성된 도시 레이아웃은 자동 주석 생성을 용이하게 합니다. (c) GoogleEarth 데이터 세트는 의미론적 분할과 건물 인스턴스 분할과 함께 실제 도시 모양을 포함합니다. (d) 데이터 세트 통계는 GoogleEarth 데이터 세트에서 사용 가능한 다양한 관점을 보여줍니다.](CityDreamer%20Compositional%20Generative%20Model%20of%20Unbo%20c844086f52564743ab770e7ad8f4b8f6/Untitled%202.png)
    
    제안된 데이터 세트 개요. (a) OSM 데이터 세트는 쌍으로 된 높이 필드와 의미 맵을 포함하여 실제 세계 도시 레이아웃을 제공합니다. (b) 높이 필드와 의미 맵에서 생성된 도시 레이아웃은 자동 주석 생성을 용이하게 합니다. (c) GoogleEarth 데이터 세트는 의미론적 분할과 건물 인스턴스 분할과 함께 실제 도시 모양을 포함합니다. (d) 데이터 세트 통계는 GoogleEarth 데이터 세트에서 사용 가능한 다양한 관점을 보여줍니다.
    
- 씬 파라미터화: 글로벌 인코더를 사용하여 로컬 씬을 인코딩하고 신경 해시 함수를 활용하여 씬 전반의 특징을 학습합니다.
- 볼류메트릭 렌더링: 적분 방식을 사용하여 픽셀 값을 도출합니다.
- 손실 함수: 도시 배경 생성기는 L1 손실, 지각 손실 및 GAN 손실을 사용하여 학습됩니다.

인스턴스 생성기 구축:

- 씬 표현: BEV 장면 표현을 사용합니다. 건물 인스턴스화는 연결된 구성 요소를 감지하여 수행됩니다.
- 씬 파라미터화: 로컬 인코더를 사용하여 픽셀 수준의 피처를 생성합니다.
- 볼류메트릭 렌더링: 다양한 건물 스타일을 표현하기 위해 스타일 코드를 통합합니다.
- 손실 함수: GAN 손실만을 사용하여 건물 생성기를 훈련합니다.

컴포지터:

- 이 섹션에서는 생성된 배경과 건물 이미지를 각각의 마스크를 사용하여 통합된 장면으로 구성합니다.

이 포괄적인 방법론은 GAN을 사용하여 상세한 3D 도시를 생성하기 위한 혁신적인 접근 방식을 제공합니다. 정교한 손실 함수와 결합된 BEV 표현을 활용하면 도시의 복잡한 건축물과 레이아웃을 캡처할 수 있는 고품질 3D 씬을 보장합니다.

### 4. The Proposed Datasets

평가 지표 :

- 시티드리머의 효율성을 평가하기 위해 몇 가지 평가 지표를 사용했습니다:
- 구조적 유사성 지수(SSIM): 생성된 이미지와 실측 이미지 간의 시각적 유사성을 측정하는 데 사용됩니다.
- 피크 신호 대 잡음비(PSNR): 원본 이미지와 압축 또는 재구성된 이미지 간의 차이를 평가하여 이미지 품질을 측정하는 표준 메트릭입니다.
- IoU(교차 교차): 의미론적 세분화에 사용되며 예측된 세분화와 기준 진실 간의 중첩을 측정합니다.
- 프레셰 시작 거리(FID): 실제 샘플과 생성된 샘플의 특징 분포 사이의 거리를 측정하는 것으로, 생성된 이미지의 품질을 평가하기 위해 GAN에서 일반적으로 사용됩니다.

구현 세부 사항 :

- 시티드리머는 텐서플로우를 사용하여 구현되었으며, 엔비디아 테슬라 V100 GPU에서 훈련되었습니다. 네트워크 트레이닝에는 학습률 0.0002, 배치 크기 16의 아담 옵티마이저를 사용했습니다. 두 데이터 세트에 대한 훈련에는 약 200회의 에포크가 소요되었으며, 완료까지 약 120시간이 걸렸습니다.

정량적 결과 :

- OSM과 GoogleEarth 데이터세트 모두에서 시티드리머를 GANCraft, 인피니시티, 씬드리머와 같은 최신 방법과 비교했습니다. PSNR과 SSIM 측면에서 시티드리머는 다른 방법보다 일관되게 우수한 성능을 보였습니다. 또한, IoU를 메트릭으로 사용한 시맨틱 세분화의 경우, CityDreamer는 GoogleEarth 데이터 세트에서 87.4%, OSM 데이터 세트에서 89.2%의 점수를 기록했습니다. FID 점수 역시 다른 방법과 비교했을 때 시티드리머가 더 낮았으며, 이는 이미지 품질이 더 우수함을 나타냅니다.
    
    ![질적 비교. 제안된 CityDreamer는 모든 기준에 비해 더 현실적이고 다양한 결과를 생성합니다. InfiniCity [34]의 시각적 결과는 작성자가 제공하며 최적의 시청을 위해 확대됩니다.](CityDreamer%20Compositional%20Generative%20Model%20of%20Unbo%20c844086f52564743ab770e7ad8f4b8f6/Untitled%203.png)
    
    질적 비교. 제안된 CityDreamer는 모든 기준에 비해 더 현실적이고 다양한 결과를 생성합니다. InfiniCity [34]의 시각적 결과는 작성자가 제공하며 최적의 시청을 위해 확대됩니다.
    

![무한한 3D 도시 생성에 대한 사용자 연구. 모든 점수는 5 범위 내에 있으며, 5는 최고를 나타냅니다.](CityDreamer%20Compositional%20Generative%20Model%20of%20Unbo%20c844086f52564743ab770e7ad8f4b8f6/Untitled%204.png)

무한한 3D 도시 생성에 대한 사용자 연구. 모든 점수는 5 범위 내에 있으며, 5는 최고를 나타냅니다.

정성적 평가 :

- 시티드리머로 생성된 도시를 육안으로 살펴본 결과 그림자, 건물 텍스처, 수역의 반사 등 인상적인 디테일을 확인할 수 있었습니다. 실제 도시에 대한 충실도가 분명했으며, 생성된 레이아웃은 도시의 원래 디자인과 매끄럽게 일치했습니다.

절제 연구 :

- 시티드리머의 각 구성 요소의 중요성을 파악하기 위해 제거 연구를 수행했습니다. 평활도 손실을 제거하자 건물 가장자리의 선명도가 눈에 띄게 감소했습니다. 또한 건물 인스턴스 생성기에서 GAN 손실만 사용하면 건물 스타일이 덜 다양해졌습니다.

한계점 및 향후 작업 :

- 시티드리머는 유망한 결과를 보여주지만, 특히 밀도가 높은 도시 지역에서는 비현실적인 건물 배치를 생성하는 경우가 있습니다. 또한 이 방법은 때때로 매우 복잡한 도로 네트워크에서 어려움을 겪습니다. 향후 작업에서는 이러한 측면을 개선하고 움직이는 차량이나 사람과 같은 동적 요소를 통합하는 데 중점을 둘 것입니다.

시티드리머는 시맨틱 맵과 높이 필드의 조합을 통해 사실적인 무한 3D 도시를 생성하는 데 있어 상당한 발전을 이루었습니다. 오픈스트리트맵과 구글 어스의 데이터를 활용하는 이 모델은 양적, 질적으로 기존 방식에 비해 뛰어난 성능을 보여줍니다.

### 5. Experiments

1. 데이터 세트:
- 오픈스트리트맵에서 파생된 오픈스트리트맵 데이터 세트는 전 세계 80개 도시에 대한 래스터화된 시맨틱 맵과 높이 필드로 구성되어 있습니다.
- GoogleEarth 데이터 세트에는 Google 어스 스튜디오에서 제공한 맨해튼과 브루클린의 궤도 궤적 400개와 세분화를 위한 주석이 포함되어 있습니다.

2. 평가 프로토콜:

- 언바운디드 레이아웃 생성기를 사용하여 뚜렷한 도시 레이아웃을 생성합니다.
- 세 가지 평가 지표가 제시되었습니다: 이미지 품질에 대한 FID 및 KID, 3D 지오메트리를 평가하기 위한 DE(Depth Error), 멀티뷰 일관성을 평가하기 위한 CE(Camera Error)가 그것입니다.

3. 구현:

- 언바운드 레이아웃 생성기, 도시 배경 생성기, 빌딩 인스턴스 생성기와 같은 다양한 모듈의 하이퍼파라미터와 훈련에 대한 세부 정보가 제공됩니다.
- 실험에는 8개의 NVIDIA Tesla V100 GPU가 사용되었습니다.

4. 비교:

- 시티드리머를 네 가지 최신 방법과 비교했습니다: SGAM, 퍼시스턴트네이처, 씬드리머, 인피니시티.
- 정성적 및 정량적 비교 결과 시티드리머가 사실성, 3D 일관성, 지오메트리 측면에서 기준선보다 뛰어난 성능을 발휘하는 것으로 나타났습니다.

5. 절제 연구:

- 언바운디드 레이아웃 생성기 및 빌딩 인스턴스 생성기와 같은 시티드리머 모델의 개별 컴포넌트의 효율성을 평가했습니다.
- 도시 배경 생성기와 건물 인스턴스 생성기의 다양한 씬 파라미터화를 테스트하고 논의했습니다.

6. 토론:

- 시티드리머는 효율적인 콘텐츠 제작이 필요한 산업, 특히 엔터테인먼트 산업에 도움이 될 수 있습니다.
- 하지만 이 모델에는 오목한 지오메트리를 모델링할 수 없다는 점과 추론 시 높은 계산 비용이 드는 점 등의 한계가 있습니다.

### 6. Conclusion

이 논문에서는 무한한 3D 도시 경관을 제작하기 위해 맞춤화된 고유한 생성 모델인 '시티드리머'를 소개했습니다. 건물을 동질적인 카테고리로 묶는 기존 방식과 달리, 시티드리머는 개별 건물 인스턴스와 더 넓은 도시 배경을 구분합니다. 이러한 미묘한 접근 방식을 통해 보다 사실적인 도시 표현이 가능하며, 건물이 가질 수 있는 다양한 외관을 수용합니다. 연구팀은 사실감을 높이고 폭넓게 적용하기 위해 전 세계의 추가 도시를 포함하도록 확장할 수 있는 실제 도시 레이아웃을 캡처하는 두 가지 데이터 세트, 즉 OSM과 GoogleEarth를 만들었습니다. 기존 모델과의 벤치마크 테스트를 통해 방대하고 다양한 3D 도시 환경을 생성하는 데 있어 시티드리머의 뛰어난 역량을 입증했습니다.