# Score Distillation Sampling with Learned Manifold Corrective

[https://arxiv.org/abs/2401.05293](https://arxiv.org/abs/2401.05293)

- Jan 2024

### 1. Introduction

최근 텍스트-이미지 모델은 이미지 생성 분야의 표준으로 자리 잡았습니다. 이 모델들은 고품질의 다양한 이미지 생성이 가능하며 자연어로 제어되어 사용이 용이합니다.

![주어진 이미지 z, 프롬프트 y = "가을", t = 0.5에 대한 픽셀 값과 예상 노이즈 제거 이미지에 대한 SDS 및 LMC-SDS 그래디언트 시각화. 음의 그라데이션, 즉 변화의 방향을 시각화합니다. 자세한 내용은 텍스트를 참조하십시오.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled.png)

주어진 이미지 z, 프롬프트 y = "가을", t = 0.5에 대한 픽셀 값과 예상 노이즈 제거 이미지에 대한 SDS 및 LMC-SDS 그래디언트 시각화. 음의 그라데이션, 즉 변화의 방향을 시각화합니다. 자세한 내용은 텍스트를 참조하십시오.

이러한 모델들은 이미지 복원, 편집, 초해상도 등 여러 응용 프로그램에서 활용되었습니다. 하지만, 확산 모델을 일반적인 이미지 사전처럼 사용하는 연구는 제한적입니다.

이 논문에서는 Score Distillation Sampling (SDS) 손실 함수를 분석하고, 그 문제점을 식별하여 새로운 손실 함수인 LMC-SDS (Score Distillation Sampling with Learned Manifold Corrective)를 제안합니다. 이 손실 함수는 이미지 합성 및 편집, 영상 번역 네트워크 훈련, 텍스트-3D 합성 등 다양한 응용에서 효과를 입증합니다.

논문의 주요 기여는 SDS 손실의 분석, 문제 식별, 새로운 LMC-SDS 손실의 제안 및 그 효과적인 적용입니다.

### 2. Related Work

이미지 확산 모델을 활용하는 방법은 크게 두 가지로 나눌 수 있습니다: 특정 작업을 위한 확산 샘플링 과정 활용과, 반복적 최적화 설정에서 확산 모델을 일반 목적의 손실 함수로 사용하는 것입니다.

첫 번째 방식의 예로는 DDRM, DPS, MCG, SDEdit, RePaint 등이 있습니다. 이들은 이미지 편집 및 복원과 같은 구체적인 문제를 해결하기 위해 사전 훈련된 확산 모델을 사용합니다.

두 번째 방식은 확산 모델을 최적화의 일반 목적 손실 함수로 활용하는 것으로, Score Jacobian Chaining, DreamFusion, DDS, SparseFusion, ProlificDreamer 등의 연구가 여기에 해당합니다. 이들은 SDS 손실 함수의 변형을 사용하며, 이 논문에서는 이러한 방식을 더 발전시키고자 합니다.

이 논문은 기존 SDS 방법의 한계를 극복하고, 이미지 확산 모델을 더 효과적으로 활용하기 위한 새로운 접근 방법을 제시합니다. 이를 통해 더 나은 이미지 생성, 편집, 3D 모델링 등이 가능해질 것으로 기대됩니다.

### 3. Analysis

이미지 확산 모델은 자연 이미지를 순수한 노이즈로 변환하는 확산 과정을 역으로 수행하는 생성 모델입니다. 텍스트-이미지 모델은 텍스트에 기반하여 이 확산 과정을 유도합니다.

SDS 손실 함수의 원리를 설명합니다. 이 함수는 주어진 이미지와 텍스트 설명에 따라 확산 모델이 예측한 노이즈와 실제 노이즈 간의 차이를 최소화하는 것을 목표로 합니다.

SDS의 한계점을 분석합니다. SDS 손실 함수는 과도한 채도나 흐릿한 결과를 초래할 수 있으며, 이는 손실 함수의 두 구성 요소, 즉 텍스트 프롬프트에 따른 이미지 조정을 극대화하는 Lcond와 이미지를 단일 확산 단계로 제거하는 Lproj의 상호작용에서 비롯됩니다.

DreamFusion에서 사용된 가이드라인 가중치 ω가 높으면 Lcond가 Lproj에 비해 불균형하게 높은 가중치를 받게 되어, 이는 과도한 색상 포화나 기타 아티팩트를 초래할 수 있습니다. 반대로 ω 값을 낮추면 이미지가 흐려질 수 있습니다.

두 구성 요소를 분리하여 분석함으로써 SDS 손실 함수의 이러한 한계점을 명확하게 이해할 수 있으며, 이를 기반으로 개선 방안을 모색합니다.

기타 접근 방식들, 예를 들어 DDS(Deep Dream Synthesis)의 경우, SDS 손실의 두 가지 버전의 차이를 사용하여 이미지 편집을 수행하지만, 이 역시 원래의 이미지 상태에서 벗어나지 않도록 하는 데 한계가 있습니다. 다른 방법들은 더 나은 노이즈 예측을 시도하지만, 이러한 방법들은 종종 계산적으로 비싸거나 특정 적용 사례에만 국한됩니다.

이러한 분석을 통해 SDS 손실 함수의 핵심적인 문제점을 식별하고 이를 해결하기 위한 새로운 접근 방식을 제안합니다.

### 4. Method

이 연구는 새로운 손실 함수인 LMC-SDS (Score Distillation Sampling with Learned Manifold Corrective)를 제안합니다. 이 함수는 기존의 SDS 손실 함수의 문제점을 해결하고, 이미지 매니폴드 방향으로 더 나은 그라디언트를 제공하도록 설계되었습니다.

![최적화 기반 이미지 합성 결과. 원본 SDS 공식인 LMC-SDS와 Lcond를 사용하여 주어진 프롬프트에 맞게 빈 이미지를 최적화합니다. 낮은 안내 ω를 사용하면 SDS는 세부적인 콘텐츠를 생성하는 데 어려움을 겪습니다. 높은 ω는 세부적인 결과를 생성하지만 색상이 과포화(침팬지 얼굴)되거나 가짜 세부 사항(두 번째 마우스 꼬리)이 나타나거나 아티팩트가 나타날 수 있습니다. Lcond는 최적화가 불안정하고 비현실적인 색상을 생성합니다. 반면, 유니티의 방법은 균형 잡힌 색상으로 디테일한 결과물을 생성합니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%201.png)

최적화 기반 이미지 합성 결과. 원본 SDS 공식인 LMC-SDS와 Lcond를 사용하여 주어진 프롬프트에 맞게 빈 이미지를 최적화합니다. 낮은 안내 ω를 사용하면 SDS는 세부적인 콘텐츠를 생성하는 데 어려움을 겪습니다. 높은 ω는 세부적인 결과를 생성하지만 색상이 과포화(침팬지 얼굴)되거나 가짜 세부 사항(두 번째 마우스 꼬리)이 나타나거나 아티팩트가 나타날 수 있습니다. Lcond는 최적화가 불안정하고 비현실적인 색상을 생성합니다. 반면, 유니티의 방법은 균형 잡힌 색상으로 디테일한 결과물을 생성합니다.

![최적화 기반 이미지 편집 결과의 예시. 한 쌍의 입력 이미지(왼쪽)와 편집 결과(오른쪽)를 보여줍니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%202.png)

최적화 기반 이미지 편집 결과의 예시. 한 쌍의 입력 이미지(왼쪽)와 편집 결과(오른쪽)를 보여줍니다.

![Lcond에서 ϵ를 고정하면 다양한 편집 결과를 얻을 수 있습니다. '해질녘의 산'이라는 주어진 프롬프트에서 입력 이미지의 최적화 기반 편집 결과의 네 가지 변형을 보여줍니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%203.png)

Lcond에서 ϵ를 고정하면 다양한 편집 결과를 얻을 수 있습니다. '해질녘의 산'이라는 주어진 프롬프트에서 입력 이미지의 최적화 기반 편집 결과의 네 가지 변형을 보여줍니다.

LMC-SDS는 확산 모델의 시간 단계에 따른 이미지의 변형을 모델링합니다. 이를 통해, 확산 과정에서 발생하는 이미지의 변형을 보정하고, 이미지가 자연스러운 매니폴드에 더 가깝게 유도됩니다.

LMC-SDS의 핵심은 이미지의 전역 변화에 집중하고, 이미지를 더 자연스럽고 현실적으로 만드는 것입니다. 이는 고주파 세부 사항에 지나치게 집중하는 기존의 SDS 손실 함수와 대조됩니다.

이 손실 함수는 두 부분으로 구성됩니다:

1. 첫 번째 부분은 이미지가 텍스트 프롬프트와 얼마나 일치하는지를 최대화하는 것을 목표로 합니다.
2. 두 번째 부분은 단일 확산 단계를 수행하여 이미지가 더 잘 복원될 수 있도록 하는 그라디언트를 제공합니다.

LMC-SDS는 다양한 이미지 생성 및 편집 작업에 적용될 수 있습니다. 이는 기존 SDS 손실 함수의 한계를 극복하고, 이미지 품질을 향상시키는 데 중점을 둡니다.

이 방법은 이미지 매니폴드에 더 잘 맞추어진 그라디언트를 생성함으로써, 이미지 생성 및 편집 과정을 더 안정적이고 효과적으로 만들 수 있습니다.

### 5. Experiments

**5.1 이미지 합성 및 편집 (Image Synthesis & Editing)**

![다양한 손실로 훈련된 고양이-타인 이미지 번역 네트워크에서 얻은 결과. SDS 손실로 훈련된 네트워크는 세부적인 결과를 생성하지 못합니다. DDS 네트워크는 다소 균일한 결과를 생성하는 반면, LMC-SDS로 훈련된 네트워크는 사실적이고 세밀한 이미지를 생성합니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%204.png)

다양한 손실로 훈련된 고양이-타인 이미지 번역 네트워크에서 얻은 결과. SDS 손실로 훈련된 네트워크는 세부적인 결과를 생성하지 못합니다. DDS 네트워크는 다소 균일한 결과를 생성하는 반면, LMC-SDS로 훈련된 네트워크는 사실적이고 세밀한 이미지를 생성합니다.

- **합성 실험**: 임의 해상도의 이미지를 생성하기 위해, 이미지를 50% 회색으로 초기화하고 주어진 프롬프트에 맞게 이미지 픽셀 값을 최적화합니다. 이 과정에서 LMC-SDS와 기존 SDS 손실을 비교합니다. 기존 SDS는 낮은 가이드라인에서 흐릿한 이미지를 생성하는 반면, LMC-SDS는 높은 시각적 품질을 유지하면서 프롬프트를 잘 반영합니다.
- **편집 실험**: 기존 이미지를 로드하여 직접 픽셀 값을 최적화함으로써 이미지를 편집합니다. 이때 선택적으로 원본 이미지에 대한 L2 손실을 사용하여 최적화를 제한할 수 있습니다. 다양한 대상 프롬프트와 함께 편집된 이미지의 결과를 제시하며, 이 결과들은 프롬프트를 잘 반영하면서도 이미지 구조를 유지합니다.

**5.2 이미지-이미지 변환 네트워크 훈련 (Image-to-Image Translation Network Training)**

- 이 실험에서는 최적화 기반 편집이 항상 최적의 선택이 아닐 때 LMC-SDS를 사용하여 신뢰할 수 있고 빠른 이미지-이미지 변환 네트워크를 훈련합니다. 고양이 이미지를 다른 동물로 변환하는 네트워크를 훈련시켜, LMC-SDS 손실을 사용한 네트워크가 현실적이고 설득력 있는 편집 결과를 생성한다는 것을 입증합니다.

**5.3 텍스트-3D 자산 생성 (Text-to-3D Asset Generation)**

- LMC-SDS를 사용하여 DreamFusion 스타일의 텍스트-3D 모델을 개선하는 방법을 보여줍니다. 여기서는 다양한 가이드라인 가중치를 사용하여 3D 자산을 생성하고, 이를 원래의 DreamFusion 수식과 LMC-SDS를 사용한 변형으로 비교합니다. LMC-SDS를 사용한 결과가 더 선명하고 상세한 것으로 나타났습니다.

![ω = 20에 대해 원래의 손실 공식(오른쪽)과 제안된 LMC-SDS(왼쪽)를 사용한 DreamFusion의 결과. 모든 예제에서 훨씬 더 선명하고 디테일이 풍부한 결과를 얻을 수 있습니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%205.png)

ω = 20에 대해 원래의 손실 공식(오른쪽)과 제안된 LMC-SDS(왼쪽)를 사용한 DreamFusion의 결과. 모든 예제에서 훨씬 더 선명하고 디테일이 풍부한 결과를 얻을 수 있습니다.

이 실험들은 LMC-SDS가 기존 SDS 손실 함수보다 더 나은 시각적 품질과 다양성을 제공한다는 것을 입증합니다. 또한, LMC-SDS는 다양한 이미지 생성 및 편집 작업에 효과적으로 사용될 수 있음을 보여줍니다.

![원래 SDS 손실(짝수 행)과 제안한 LMC-SDS(홀수 행)를 사용하여 DreamFusion에서 안내 가중치 ω를 증가시켰을 때의 효과. ω를 크게 사용하면 색상(의자, 오토바이, 배)이 포화되고 야누스 문제(독수리의 세 번째 날개와 발톱)가 악화됩니다. 낮은 ω의 경우 바닐라 드림퓨전은 세부적인 지오메트리(배, 독수리)나 지오메트리(오토바이)를 전혀 생성하지 못하는 반면, 우리의 접근 방식은 ω = 20, 심지어 ω = 10에서도 잘 수행됩니다. 우리의 접근 방식이 모든 ω에 대해 지속적으로 더 상세한 결과를 생성하는 것을 알 수 있습니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%206.png)

원래 SDS 손실(짝수 행)과 제안한 LMC-SDS(홀수 행)를 사용하여 DreamFusion에서 안내 가중치 ω를 증가시켰을 때의 효과. ω를 크게 사용하면 색상(의자, 오토바이, 배)이 포화되고 야누스 문제(독수리의 세 번째 날개와 발톱)가 악화됩니다. 낮은 ω의 경우 바닐라 드림퓨전은 세부적인 지오메트리(배, 독수리)나 지오메트리(오토바이)를 전혀 생성하지 못하는 반면, 우리의 접근 방식은 ω = 20, 심지어 ω = 10에서도 잘 수행됩니다. 우리의 접근 방식이 모든 ω에 대해 지속적으로 더 상세한 결과를 생성하는 것을 알 수 있습니다.

!['[후드티, 모자]를 입은 마네킹'이라는 프롬프트에 대해 LMC-SDS 손실 및 고정 ϵ 샘플링을 사용한 DreamFusion 결과. 색상, 포즈, 마네킹 스타일의 다양성을 확인할 수 있습니다.](Score%20Distillation%20Sampling%20with%20Learned%20Manifold%20%20576e9309c1714bb093621f4936a7a87f/Untitled%207.png)

'[후드티, 모자]를 입은 마네킹'이라는 프롬프트에 대해 LMC-SDS 손실 및 고정 ϵ 샘플링을 사용한 DreamFusion 결과. 색상, 포즈, 마네킹 스타일의 다양성을 확인할 수 있습니다.

### 6. Discussion & Conclusion

이 논문은 LMC-SDS, 즉 Score Distillation Sampling with Learned Manifold Corrective라는 새로운 손실 함수를 제안합니다. 이 함수는 텍스트-이미지 확산 모델을 여러 최적화 및 네트워크 훈련 작업에서 효과적으로 활용할 수 있게 합니다.

DreamFusion의 SDS 손실 함수를 분석하고, 그 구성에서 내재된 문제를 식별했습니다. SDS의 그라디언트를 두 부분으로 나누어 설명하고, 두 번째 항인 Lproj가 불충분한 그라디언트를 제공하는 것을 확인했습니다. 이로 인해 DreamFusion에서는 이 항을 낮게 가중치를 두었지만, 이 항이 확산 모델과 연관된 자연 이미지의 학습된 매니폴드를 향한 그라디언트를 제공해야 한다고 주장했습니다.

실험을 통해 LMC-SDS 손실 함수의 효과성과 다양성을 입증했습니다. 이 손실 함수는 최적화의 안정성을 개선하고 결과의 충실도에 부정적인 영향을 미치는 요소를 제거합니다.

LMC-SDS는 확산 모델에서 나오는 신호가 약하거나 모호할 때, 또는 최적화가 자연 이미지 매니폴드를 벗어날 때 한계를 가집니다. 특히, 확산 모델이 프롬프트를 '이해'하지 못할 경우 LMC-SDS는 의미있는 그라디언트를 제공하지 못합니다. 또한, 최적화 상태가 너무 손상되었을 경우, LMC-SDS는 이를 바로잡고 매니폴드로 돌아가도록 안내할 수 없습니다. 그럼에도 불구하고, LMC-SDS는 이미지 확산 모델과 관련된 내재된 이미지 사전 지식을 더 안정적이고 의미 있게 활용하기 위한 중요한 첫걸음입니다.

연구자들은 매니폴드 수정 기능을 더욱 향상시키는 방법을 계속해서 탐구할 계획입니다. 또한, 이러한 발견을 텍스트-3D 또는 이미지 편집 및 스타일링 작업과 같은 구체적인 응용 프로그램에 활용하고자 합니다.