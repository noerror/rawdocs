# PALP: Prompt Aligned Personalization of Text-to-Image Models

[https://arxiv.org/abs/2401.06105](https://arxiv.org/abs/2401.06105)

- Jan 2024

![프롬프트 정렬 개인화를 통해 조건 프롬프트의 모든 요소를 포함하여 풍부하고 복잡한 장면을 생성할 수 있습니다(오른쪽).](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled.png)

프롬프트 정렬 개인화를 통해 조건 프롬프트의 모든 요소를 포함하여 풍부하고 복잡한 장면을 생성할 수 있습니다(오른쪽).

### 1. Introduction

다양한 설정, 스타일 및 모양과 같은 다양한 프롬프트를 기반으로 광범위한 이미지를 만들 수 있는 텍스트-이미지 모델의 발전에 대해 설명합니다. 최근의 발전으로 이러한 모델에 사물, 동물 또는 사람과 같은 특정 피사체를 포함할 수 있게 되었습니다. 그러나 이러한 모델은 특히 프롬프트에 설명된 스타일과 내용을 준수하면서 특정 피사체를 포함해야 하는 개인화된 프롬프트의 경우 제어 및 정밀도 측면에서 종종 문제에 직면합니다.

문제점 및 제안된 방법

텍스트-이미지 모델의 개인화에서 가장 큰 문제는 개인화된 피사체의 정체성을 유지하는 것과 텍스트 프롬프트와 일치하는 것 사이의 절충점입니다. 이 백서에서는 광범위한 범위에서 일반적으로 효과적이기보다는 하나의 복잡한 프롬프트에 집중함으로써 이 문제를 해결할 수 있는 새로운 방법을 제안합니다. 이 방법은 소량의 개인 이미지 세트로 사전 학습된 모델을 미세 조정하고 모델의 기존 지식을 보존하기 위해 강력한 정규화를 적용하는 것입니다. 이러한 균형은 제한된 데이터에서 피사체의 고유한 특징을 학습하는 동시에 사용자가 원하는 프롬프트에 잘 부합하는 이미지를 생성하는 데 도움이 됩니다.

프레임워크 및 접근 방식

이 논문의 접근 방식은 기존 모델이 새로운 개인 피사체를 제외한 대상 프롬프트 내의 모든 요소에 대한 지식을 이미 가지고 있다는 아이디어에 기반합니다. 저자는 개인화된 모델이 목표 프롬프트에 대한 이해를 잃지 않도록 사전 학습된 모델의 사전 지식을 활용할 것을 제안합니다. 저자들은 모델에 새로운 주제에 대해 가르치는 개인화와 모델이 목표 프롬프트의 요소를 잊지 않도록 하는 프롬프트 정렬이라는 두 가지 구성 요소로 이루어진 프레임워크를 소개합니다. 이 프레임워크는 특정 프롬프트와 관련된 한계를 극복하여 텍스트-이미지 모델의 잠재력을 극대화하는 것을 목표로 합니다.

평가 및 적용

이 방법은 정성적, 정량적으로 모두 평가되어 기존 기준선에 비해 우수한 결과를 보여줍니다. 이는 특정 영역에서 문제가 될 수 있는 대규모 데이터 세트에 대한 사전 학습 없이도 달성할 수 있습니다. 이 논문은 또한 이 방법이 다중 대상 개인화를 유연하게 처리하고 텍스트 프롬프트뿐만 아니라 예술적 그림과 같은 다양한 소스에서 영감을 얻을 수 있다는 점을 강조합니다.

### 2. Related work

'관련 작업' 섹션에서는 텍스트-이미지 합성의 발전과 방법론에 대한 포괄적인 개요를 제공하며, 최근 몇 년간 다양한 접근 방식과 그 발전에 초점을 맞추고 있습니다. 이 섹션은 텍스트-이미지 생성 및 개인화 기술의 광범위한 환경 내에서 제안된 방법을 맥락화합니다.

![기존의 개인화 방식은 복잡한 프롬프트(예: "비트루비안 남자에게서 영감을 받은 스케치")를 처리하는 데 어려움을 겪으며 프롬프트 정렬과 피사체 충실도 간에 상충되는 문제가 있었습니다. 크리테오의 방법은 두 가지 모두에 최적화되어 있습니다.](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%201.png)

기존의 개인화 방식은 복잡한 프롬프트(예: "비트루비안 남자에게서 영감을 받은 스케치")를 처리하는 데 어려움을 겪으며 프롬프트 정렬과 피사체 충실도 간에 상충되는 문제가 있었습니다. 크리테오의 방법은 두 가지 모두에 최적화되어 있습니다.

텍스트-이미지 합성 발전 과정

이 논문은 텍스트-이미지 합성에서 상당한 진전이 있었음을 인정하며, 이는 주로 LAION-400m과 같은 데이터 세트에 대한 대규모 훈련에 힘입은 바가 큽니다. 특히 안정확산 모델과 같은 사전 훈련된 확산 모델의 사용은 새로운 피사체에 대한 이해를 확장하는 데 중점을 두고 있습니다. 이러한 발전은 이 분야를 발전시키는 데 결정적인 역할을 했습니다.

텍스트 기반 편집 방법

이 백서에서는 로컬 및 글로벌 편집을 안내하는 CLIP과 같은 대조적 멀티모달 모델을 비롯한 다양한 텍스트 기반 편집 방법에 대해 설명합니다. 사전 학습된 모델에서 관심도 맵을 편집하기 위한 P2P(프롬프트 투 프롬프트) 접근 방식이 언급됩니다. 이미지 편집을 위해 참고 주의도 맵, DDIM 반전, Imagic을 사용하는 방법과 InstructPix2Pix와 같은 다른 기법도 강조됩니다. 이러한 방법은 텍스트 프롬프트에 반응하여 이미지를 조작하고 편집하는 다양한 접근 방식을 보여줍니다.

개인화 기법

새로운 피사체를 표현하도록 사전 학습된 모델을 조정하는 텍스트 반전 및 드림부스와 같은 초기 개인화 방법에 대해 설명합니다. 이 백서에서는 메모리 요구 사항의 개선과 낮은 순위 업데이트 또는 컴팩트 파라미터 공간의 사용에 대해서도 언급합니다. NeTI 및 P+와 같은 기술은 더 많은 토큰을 사용하여 피사체를 더 잘 식별함으로써 이러한 방법을 확장합니다. 또한 관계형 특징 학습이나 개념 분해와 같은 작업에서 개인화를 적용하는 것도 주목할 만합니다.

프롬프트 정렬에 집중

이 논문은 입력 이미지의 전체 구조를 유지하지 못하는 다른 개인화 방법과 차별화되는 즉각적인 정렬에 초점을 맞췄다는 점을 강조합니다. 제안된 방법은 특정 프롬프트에 이미지를 정렬하는 데 있어 적응성과 효율성을 강조하면서 다양한 개인화 기법과 호환되는 것으로 포지셔닝됩니다.

점수 증류 샘플링 및 텍스트-이미지 간 정렬

점수 증류 샘플링(SDS)은 3D 생성 및 이미지 편집과 같은 다양한 애플리케이션에 확산 모델 사전을 활용하는 기법으로 언급됩니다. 이 백서에서는 목표 프롬프트와의 정렬을 유지하기 위해 점수 샘플링을 사용할 것을 제안하며, 대체 기술을 통한 잠재적인 개선 사항을 제시합니다. 마지막으로 이 백서에서는 텍스트-이미지 정렬 방법에 대해 논의하며, 기본 확산 모델의 문제를 해결하고 개인화 방법에서 프롬프트 정렬을 개선하는 데 있어 제안된 접근 방식의 고유성을 강조합니다.

### 3. Preliminaries

제너레이티브 확산 모델

이 섹션은 생성적 확산 모델의 개념을 설명하는 것으로 시작합니다. 이 모델은 무작위 노이즈 소스에서 시작하여 점진적으로 노이즈를 제거하여 사실적인 이미지를 생성하는 역확산이라는 프로세스를 통해 이미지를 생성합니다. 이 프로세스에는 각 타임스텝 t에서 현재 이미지 상태 x t, 타임스텝 t, 주어진 프롬프트 y를 기반으로 노이즈를 예측하는 모델 G가 포함됩니다. 이러한 모델의 훈련은 노이즈 제거 점수 매칭 목표를 사용하여 증거 하한(ELBO)을 최대화하는 데 중점을 둡니다. 목적 함수 (,)L(x,y)는 노이즈 제거 과정에서 예측된 노이즈 ^ ^와 실제 노이즈 간의 차이를 최소화하도록 설계되었습니다. 이 공식은 각 시간 간격에서 이미지 x t가 실제 샘플 x와 노이즈의 조합인 방법을 설명합니다.

![다중 피사체 개인화를 위한 PALP는 일관성 있고 즉각적으로 정렬된 결과를 제공합니다. 이 방법은 피사체에 이미지가 하나만 있는 경우(예: 카스파르 데이비드 프리드리히의 '안개 바다 위의 방랑자' 작품)에 효과적입니다.](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%202.png)

다중 피사체 개인화를 위한 PALP는 일관성 있고 즉각적으로 정렬된 결과를 제공합니다. 이 방법은 피사체에 이미지가 하나만 있는 경우(예: 카스파르 데이비드 프리드리히의 '안개 바다 위의 방랑자' 작품)에 효과적입니다.

확산 모델의 개인화

이 섹션에서는 확산 모델의 개인화 기법에 대해 자세히 설명합니다. 개인화에는 확산 모델 미세 조정이 포함됩니다.

![방법 개요. 동일한 학습 단계에서 동시에 적용되는 개인화 경로(왼쪽)와 프롬프트 정렬 분기(오른쪽)로 구성된 프레임워크를 제안합니다. 새로운 피사체 S의 노이즈를 제거하기 위해 간단한 재구성 손실을 사용하여 사전 학습된 모델을 미세 조정함으로써 개인화를 달성합니다. 모델이 목표 프롬프트에 정렬되도록 하기 위해 점수 샘플링을 추가로 사용하여 예측을 목표 프롬프트 y(예: "고양이 스케치")의 방향으로 피벗합니다. 이 예에서, 개인화와 텍스트 정렬이 동시에 최적화되면 네트워크는 피사체를 '스케치'와 같은 표현으로 노이즈를 제거하는 방법을 학습합니다. 마지막으로, 우리의 방법은 [34]에 따라 점수 함수를 효율적으로 추정하기 때문에 메모리 오버헤드를 크게 유발하지 않습니다.](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%203.png)

방법 개요. 동일한 학습 단계에서 동시에 적용되는 개인화 경로(왼쪽)와 프롬프트 정렬 분기(오른쪽)로 구성된 프레임워크를 제안합니다. 새로운 피사체 S의 노이즈를 제거하기 위해 간단한 재구성 손실을 사용하여 사전 학습된 모델을 미세 조정함으로써 개인화를 달성합니다. 모델이 목표 프롬프트에 정렬되도록 하기 위해 점수 샘플링을 추가로 사용하여 예측을 목표 프롬프트 y(예: "고양이 스케치")의 방향으로 피벗합니다. 이 예에서, 개인화와 텍스트 정렬이 동시에 최적화되면 네트워크는 피사체를 '스케치'와 같은 표현으로 노이즈를 제거하는 방법을 학습합니다. 마지막으로, 우리의 방법은 [34]에 따라 점수 함수를 효율적으로 추정하기 때문에 메모리 오버헤드를 크게 유발하지 않습니다.

새 대상 피사체에 대해 G S를 해당 피사체를 나타내는 작은 이미지 세트를 사용하여 미세 조정합니다. 이 백서에서는 개인화에 대한 두 가지 주요 접근 방식을 언급합니다:

- 텍스트 반전: 이 방법은 새로운 주제를 나타내는 새로운 단어 임베딩을 생성하는 것입니다. 이 방법은 일반 프롬프트와 플레이스홀더(예: "[V]의 사진")를 페어링하여 [V]를 새로 추가된 단어 임베딩에 매핑하는 방식으로 이루어집니다.
- 드림부스: 이 기술은 개인 주제를 나타내도록 기존 단어 임베딩을 보정합니다. 이 보정은 모델 가중치를 조정하여 수행할 수 있습니다. 더 적은 리소스로 개인화를 달성하기 위해 가중치의 하위 집합에 저순위 적응(LoRA)을 사용하는 것도 효율적인 변형입니다.

### 4. Prompt Alignment Method

4.1 개요

설명하는 방법의 주요 목표는 생성 모델('G'로 표시됨)이 피사체와 관련된 이미지를 생성할 수 있도록 하는 것입니다. G)가 새로운 피사체와 관련된 이미지를 생성할 수 있도록 하는 것입니다.

단일 텍스트 프롬프트에 중점을 둡니다.

![xˆ0의 시각화. 순수 잡음과 "[V]의 스케치"라는 프롬프트가 주어졌을 때 xˆ0의 모델 추정치를 시각화합니다. 기본 모델(b)은 대상 피사체에 개인화되지 않았으며 주로 "스케치" 모양을 예측합니다. 개인화 방법(c)는 배경 및 피사체 색상을 비롯한 많은 이미지 요소가 복원된 입력 이미지를 과도하게 맞추는 경향이 있으며, 이는 모델이 프롬프트 조건을 고려하지 않았음을 나타냅니다. 프롬프트 정렬 개인화(c)는 스케치 모양을 유지하며 과도하게 맞지 않습니다(고양이 모양 참조).](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%204.png)

xˆ0의 시각화. 순수 잡음과 "[V]의 스케치"라는 프롬프트가 주어졌을 때 xˆ0의 모델 추정치를 시각화합니다. 기본 모델(b)은 대상 피사체에 개인화되지 않았으며 주로 "스케치" 모양을 예측합니다. 개인화 방법(c)는 배경 및 피사체 색상을 비롯한 많은 이미지 요소가 복원된 입력 이미지를 과도하게 맞추는 경향이 있으며, 이는 모델이 프롬프트 조건을 고려하지 않았음을 나타냅니다. 프롬프트 정렬 개인화(c)는 스케치 모양을 유지하며 과도하게 맞지 않습니다(고양이 모양 참조).

주어진 예는 파리에 있는 고양이의 이미지를 스케치 스타일로 생성하는 것입니다. 이 목표는 개인화와 프롬프트 정렬이라는 두 가지 주요 목표를 최적화하여 달성할 수 있습니다. 이 접근 방식에는 미세 조정이 포함됩니다. G를 재구성하고 S를 재구성하고 노이즈 샘플과 스티어링 목표 프롬프트에 대한 G의 노이즈 예측 에 맞춰 G의 노이즈 예측을 조정하는 것입니다.

4.2 개인화

개인화를 위해, 이 방법은 기존의 접근 방식을 따르며 작은 이미지 세트에서 이는 자기 및 교차 관심 계층에 초점을 맞춰 네트워크 가중치의 하위 집합만 업데이트하는 LoRA 방법을 사용하여 수행됩니다. 또한, 새로운 단어 임베딩 [ ] [V]를 포함하는 새로운 단어는 다음을 표현하도록 최적화됩니다. S.

4.3 프롬프트 정렬 점수 샘플링

이 논문에서는 작은 이미지 세트에서 장시간 미세 조정을 수행하는 동안 모델 과적합 문제를 다룹니다. 이 문제를 해결하기 위해 이 접근 방식은 모델의 목표 프롬프트에 대한 노이즈 제거 예측을 장려하여 실제 샘플 추정치 ^0x^ 0이 프롬프트 y와 정렬되도록 하며, 이는 점수 증류 샘플링(SDS) 기법을 사용하여 수행됩니다. SDS는 깨끗한 대상 프롬프트를 사용하고 점수 샘플링을 통해 손실을 최적화하여 텍스트 프롬프트와 정렬되도록 합니다. 이 방법은 LoRA 가중치를 사용하는 모양을 제어합니다.

4.4 과포화 및 모드 붕괴 방지

이 방법은 또한 안내형 SDS 결과에서 흔히 볼 수 있는 과포화 및 다양성 부족 문제를 해결합니다. 다른 접근 방식인 델타 노이즈 제거 점수(DDS)가 더 효과적인 것으로 밝혀졌습니다. DDS는 개인화된 모델의 예측과 사전 학습된 예측 사이의 잔여 방향을 사용하여 노이즈 제거 예측이 목표 프롬프트를 향하도록 안내합니다. 실험 결과, 텍스트 정렬과 개인화 지점 모두에 불균형한 안내 척도와 동일한 노이즈를 사용하면 더 나은 결과를 얻을 수 있는 것으로 나타났습니다.

![멀티샷 설정에서의 질적 비교. 우리의 방법은 복잡한 프롬프트, 더 나은 신원 보존 및 프롬프트 정렬에 대해 최첨단 결과를 달성합니다. TI [15]+DB [39]의 경우, 동일한 시드를 사용하여 결과를 생성하고 프롬프트 정렬 경로를 통합함으로써 얻을 수 있는 이득을 강조합니다. 다른 기준선의 경우, 8개 샘플 중 가장 우수한 2개 샘플을 선택했습니다.](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%205.png)

멀티샷 설정에서의 질적 비교. 우리의 방법은 복잡한 프롬프트, 더 나은 신원 보존 및 프롬프트 정렬에 대해 최첨단 결과를 달성합니다. TI [15]+DB [39]의 경우, 동일한 시드를 사용하여 결과를 생성하고 프롬프트 정렬 경로를 통합함으로써 얻을 수 있는 이득을 강조합니다. 다른 기준선의 경우, 8개 샘플 중 가장 우수한 2개 샘플을 선택했습니다.

PALP의 계산 복잡성

마지막으로 이 섹션에서는 프롬프트 정렬 및 개인화 학습 프로세스(PALP)의 계산 복잡성에 대해 설명합니다. PALP의 그라데이션 계산은 개인화 그라데이션에 비례하므로 프롬프트 정렬 브랜치에서 텍스트-이미지 모델을 통한 역전파가 필요하지 않습니다. 이러한 측면은 더 큰 모델의 안내를 사용하여 더 작은 모델의 개인화 성능을 향상시키는 데 유리할 수 있습니다. 그라데이션의 스케일을 다시 조정하여 모든 시간 간격에 걸쳐 균일한 그라데이션 업데이트를 수행하면 수치 안정성이 향상됩니다.

### 5. Results

사용된 모델: 실험에서는 다양한 최신 방법의 공식 구현과의 호환성을 위해 선택된 StableDiffusion(SD)-v1.4 모델을 주로 활용했습니다. 이 방법은 더 큰 텍스트-이미지 변환 모델에서도 검증되었습니다.

구성 세부 정보: 학습 속도, 단계 및 배치 크기와 같은 실험 구성에 관한 자세한 내용은 부록에 나와 있습니다.

![ProFusion [56], IP-Adapter [55] , E4T [16], Face0 [49]에 대한 정성적 비교. 왼쪽에는 여러 개의 프롬프트가 있는 단일 이미지를 사용하여 두 명의 개인에 대한 방법의 결과를 보여줍니다. 지면 관계상 주어진 피사체와 프롬프트에 대해 선호도에 따라 이전의 모든 방법 중 단일 결과를 보고합니다. 전체 비교는 탭에 표시됩니다. 9 탭. 8.](PALP%20Prompt%20Aligned%20Personalization%20of%20Text-to-Ima%202fecfc54e39445608dd39267724330b8/Untitled%206.png)

ProFusion [56], IP-Adapter [55] , E4T [16], Face0 [49]에 대한 정성적 비교. 왼쪽에는 여러 개의 프롬프트가 있는 단일 이미지를 사용하여 두 명의 개인에 대한 방법의 결과를 보여줍니다. 지면 관계상 주어진 피사체와 프롬프트에 대해 선호도에 따라 이전의 모든 방법 중 단일 결과를 보고합니다. 전체 비교는 탭에 표시됩니다. 9 탭. 8.

5.1 평가 지표

클립 점수: 클린 타겟 프롬프트 y c(플레이스홀더 [V] 제외)와의 정렬을 측정하는 데 사용됩니다. 생성된 이미지가 의도한 텍스트 프롬프트와 얼마나 잘 일치하는지 평가합니다. 클립 기능 유사성: 입력 이미지와 생성된 이미지의 유사성을 대상 프롬프트와 비교하여 피사체 보존을 측정합니다.

5.2 데이터 세트

멀티샷 설정: 데이터 세트에는 이전 방법에서 수집한 동물, 장난감, 개인 물품, 건물과 같은 다양한 피사체가 포함됩니다.

5.3 제거 연구

기준선 방법: 텍스트 반전(TI)과 드림부스(DB)가 기준 개인화 방법으로 사용되었습니다.

- 조기 중지: 텍스트 정렬에 대한 대조군으로 고려되었지만 피험자 충실도를 손상시키는 것으로 밝혀졌습니다.
- SDS 안내 추가: 텍스트 정렬이 개선되었지만 피사체 충실도 및 이미지 다양성이 감소했습니다.
SDS를 PALP 안내로 대체: 텍스트 정렬이 크게 개선되고 피사체에 대한 높은 충실도를 유지했습니다. 최적화를 위해 다양한 방법을 테스트했습니다.

5.4 기존 방법과의 비교

- 다른 방법과의 비교: 이 방법은 CustomDiffusion, P+, NeTI와 같은 여러 멀티샷 방법과 TI 및 DB와 비교되었습니다.
- 사용자 연구: 사용자 연구를 통해 확인된 바와 같이, 이 방법은 신속한 정렬 및 개인화 측면에서 다른 방법보다 우수한 성능을 보였습니다.

5.5 애플리케이션

싱글샷 설정: 이 방법은 단일 이미지를 사용하여 텍스트-이미지 모델을 개인화하는 데 탁월했으며, 인코더 기반 방법보다 프롬프트와 ID 정렬 모두에서 우월함을 보여주었습니다.
다중 개념 개인화: 이 방법은 다중 피사체 개인화를 수용할 수 있어 다양한 피사체를 일관된 장면이나 예술적 영감을 받은 이미지로 구성할 수 있습니다.

### 6. Conclusions

새로운 개인화 방법: 도입된 방법은 개인화된 이미지의 신속한 정렬을 크게 향상시켜 신속한 정렬과 피사체 정렬 모두에서 좋은 결과를 얻을 수 있습니다.
한계와 향후 방향: 개인화 모델은 다른 프롬프트에도 일반화할 수 있지만, 최적의 결과를 얻으려면 프롬프트마다 개인화가 필요합니다. 이 논문은 향후 즉각적인 개인화를 위해 프롬프트 정렬 어댑터를 사용할 수 있는 가능성을 제시합니다.

요약하면, 이 연구는 프롬프트 정렬을 강조하여 텍스트-이미지 모델을 더 잘 개인화할 수 있는 새로운 방법을 소개합니다. 이 방법은 복잡한 프롬프트와 주제 표현을 처리하는 데 있어 기존 방식에 비해 크게 개선되었음을 보여줍니다. 단발성 및 다중 개념 개인화 시나리오에서 이 방법의 유연성은 다양한 애플리케이션에서 이 방법의 잠재력을 강조합니다.