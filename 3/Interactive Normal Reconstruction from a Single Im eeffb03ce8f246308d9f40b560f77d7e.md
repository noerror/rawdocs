# Interactive Normal Reconstruction from a Single Image

[http://www.jiansun.org/papers/SigAsia_iSFS.pdf](http://www.jiansun.org/papers/SigAsia_iSFS.pdf)

### 소개

이 논문에서는 그래픽 애플리케이션에 사용하기 위해 단일 이미지에서 표면 법선을 복구하는 대화형 시스템에 대해 설명합니다. 자동 셰이딩으로부터의 모양(SfS) 알고리즘은 잘못된 위치로 인해 오류가 발생하기 쉬우며, 대화형 방법은 복잡한 기하학적 구조를 가진 이미지의 경우 시간이 많이 소요될 수 있습니다. 제안된 접근 방식은 표면 재구성을 통해 재구성 오류를 분산하는 SfS 알고리즘과 상대 법선을 조작하여 SfS 결과의 저주파 편향성을 수정하는 사용자 조작 시스템의 두 단계로 구성됩니다. 상대 법선 조작은 스파스 마크업을 사용하여 방향성 구에서 수행되며, 마크업 접근 방식은 최근의 법선 마크업 접근 방식에서 영감을 얻었습니다. 제안된 방법은 사람의 상호 작용과 이미지의 지오메트리 정보를 결합하여 복잡한 이미지 객체의 고품질 가시 표면 모델을 생성합니다.

### Related Work and Motivation

![비너스: (a) 입력 이미지, (b) 추정 초기 노멀 맵, (c) 회전 팔레트의 스파스 사용자 마크업에서 전파된 고밀도 변환 맵 V, (d) (c)의 V를 (b)의 초기 노멀 맵에 적용하여 얻은 최종 노멀 맵, (e) 재구성된 표면](Interactive%20Normal%20Reconstruction%20from%20a%20Single%20Im%20eeffb03ce8f246308d9f40b560f77d7e/Untitled.png)

비너스: (a) 입력 이미지, (b) 추정 초기 노멀 맵, (c) 회전 팔레트의 스파스 사용자 마크업에서 전파된 고밀도 변환 맵 V, (d) (c)의 V를 (b)의 초기 노멀 맵에 적용하여 얻은 최종 노멀 맵, (e) 재구성된 표면

이 단원에서는 광원 및 알베도에 대한 정보 부족으로 인한 모호성으로 인해 단일 이미지에서 복잡한 디테일이 있는 복잡한 표면을 모델링하는 데 따르는 어려움에 대해 설명합니다. 이 단원에서는 셰이딩 알고리즘, 단일 뷰 계측, 사용자 상호 작용을 사용한 대화형 모델링 등 다양한 접근 방식을 제시합니다. 또한 이러한 접근 방식의 한계와 옅은 모호함을 해결하는 어려움에 대해서도 설명합니다. 이 구절에서는 저빈도 오류를 편집하고 수정하기 위해 상대 법선을 지정하기 위해 사람의 사용자 상호 작용에 의존하는 새로운 접근 방식을 제안합니다. 이 접근 방식은 그림 부조에 대한 인간의 인식은 국부적 법선 측면에서 일관성이 있는 반면 절대 깊이 지정은 부정확하다는 관찰에 기반합니다. 상대 정보의 사용은 3D 메시 모델링에서 성공을 거두었으며, 제안된 접근 방식은 단일 이미지에서 복잡한 디테일이 있는 복잡한 표면의 모델링에 적용하는 것을 목표로 합니다.

### Our Approach

저자는 최소한의 사용자 인터랙션으로 단일 이미지에서 고품질 표면 노멀을 생성하는 2단계 접근 방식을 제시합니다. 첫 번째 단계에서는 새로운 인터랙티브 SfS 알고리즘을 사용하여 이미지에서 고주파 디테일을 복구합니다. 이 알고리즘은 가능한 모든 조명 방향에 노멀 재구성 오류를 분산시켜 옅은 모호함을 극복하지만 저주파 성분에서 오류가 더 두드러지게 나타납니다.

이러한 오류를 수정하기 위해 저자는 회전 팔레트라는 편리한 편집 도구를 제안합니다. 이 도구를 사용하면 간단하고 드문드문 마크업을 사용하여 변환 맵을 생성하여 저주파수 오류를 수정하고 고주파수 표면 디테일을 향상시킬 수 있습니다. 회전 팔레트는 셰이프 팔레트를 직접 확장한 것으로, 구 이미지를 사용하여 2D 마크업을 통해 상대 법선을 선택합니다.

저자는 회전 팔레트를 노멀 편집에 사용하기 전과 후의 결과를 보여줌으로써 접근 방식의 효과를 입증하고 복잡한 오브젝트의 단일 이미지에서 지금까지 가장 우수한 노멀 재구성 결과를 생성합니다.

### 3-1 Initial Normal Estimation

저자는 소량의 사용자 인터랙션을 사용하여 고품질 표면 노멀을 생성하는 2단계 접근 방식을 제시합니다. 첫 번째 단계에서는 단일 이미지에서 고주파 디테일을 복구하기 위한 대화형 셰이딩으로부터의 셰이프(SfS) 알고리즘을 제안합니다. 이 알고리즘은 가능한 모든 조명 방향에 대해 일반 재구성 오류를 전역적으로 분산하여 결과를 입력에 편향되게 만드는 옅은 모호성을 개선합니다. 저빈도 오류를 수정하기 위해 저자는 '회전 팔레트'라는 편리한 편집 도구를 제안하는데, 이 도구는 변환 맵을 생성하는 데 간단하고 드문드문 마크업만 있으면 됩니다. 두 번째 단계에서는 이 도구를 사용하여 저주파수 오류를 수정하고 고주파수 표면 디테일을 향상시킵니다. 이 도구를 사용하면 노멀 맵과 회전 방향을 나타내는 구 이미지 사이에 간단한 스트로크 대응을 그려서 표면 노멀의 대규모 보정을 지정할 수 있습니다. 저자는 이 두 가지 접근 방식을 함께 사용하면 복잡한 물체의 단일 이미지에서 지금까지 가장 우수한 노멀 재구성 결과를 얻을 수 있음을 보여줍니다.

### 3.2 RotationPalette: Interactive Normal Manipulation

요약하면, 저자는 복잡한 물체의 단일 이미지에서 고품질 표면 법선을 생성하기 위한 2단계 접근 방식을 제안합니다. 첫 번째 단계는 단일 이미지에서 고주파 디테일을 복구하는 대화형 SfS 알고리즘입니다. 두 번째 단계는 회전 팔레트라는 노멀 편집 도구로, 사용자가 노멀 맵의 오류를 쉽게 수정하고 고주파수 표면 디테일을 향상시킬 수 있습니다. 저자는 상대 노멀 ∆N을 지정하여 노멀을 조작할 것을 제안하는데, 이는 사용자가 부드럽고 저빈도의 상대 노멀 맵에서 제약 조건을 지정하기 쉽고, 최적화 방법을 통해 스파스 마크업이 전체 노멀 맵에 쉽게 전파될 수 있습니다. 저자들은 초기 노멀 맵 편집을 위해 표면 제어와 디테일 임베딩이라는 두 가지 유형의 사용자 인터랙션을 제공합니다. 저자의 사용자 인터페이스인 회전 팔레트는 셰이프 팔레트에서 영감을 받았지만 절대 노멀이 아닌 상대 노멀에서 작동합니다.

![비너스의 노멀 맵 향상하기: 회전 팔레트의 획 업로드를 회전 팔레트의 획 마크업에 대한 세 가지 예제](Interactive%20Normal%20Reconstruction%20from%20a%20Single%20Im%20eeffb03ce8f246308d9f40b560f77d7e/Untitled%201.png)

비너스의 노멀 맵 향상하기: 회전 팔레트의 획 업로드를 회전 팔레트의 획 마크업에 대한 세 가지 예제

### 3.3 A Real Example

요약하면, 이 논문에서는 사용자가 SfS 알고리즘으로 추정된 초기 노멀 맵을 편집할 수 있는 단일 이미지 3D 형상 모델링을 위한 대화형 시스템을 제안합니다. 제안된 시스템은 구 이미지인 회전 팔레트를 사용하여 상대 법선을 지정하여 노멀 맵을 개선합니다. 이 시스템은 스트로크를 통한 표면 제어와 브러시를 통한 디테일 임베딩이라는 두 가지 유형의 사용자 인터랙션을 제공합니다. 스트로크는 관심 영역에 대해 원하는 회전을 지정하여 표면 모양을 조정하는 데 사용되며, 브러시는 원하지 않는 구조를 제거하거나 디테일을 다시 추가하는 데 사용됩니다. 제안된 시스템은 노멀 맵을 개선하고 고품질 3D 형상 모델을 생성하는 데 있어 유망한 결과를 보여줍니다.

### 4 Results

제안된 시스템을 통해 사용자는 구 팔레트를 사용하여 상대 노멀을 지정하여 주어진 노멀 맵을 인터랙티브하게 다듬을 수 있습니다. 이 시스템은 스트로크를 통한 표면 제어와 브러시를 통한 디테일 임베딩이라는 두 가지 유형의 상호 작용을 제공합니다. 스트로크 상호작용은 평평한 표면 영역을 팝업하는 데 사용되는 반면, 브러시 상호작용은 그림자나 하이라이트로 인한 원치 않는 구조를 제거하고 브러시로 제거된 디테일을 다시 추가하는 데 사용됩니다. 이 시스템은 최적화 방법을 사용하여 사용자 입력을 전파하고 밀도가 높은 맵 V를 생성합니다. 처리 및 사용자 상호 작용 시간이 합리적이며 결과는 원본 표면을 충실하게 재구성합니다. 그러나 이 시스템에는 한계가 있으며 오브젝트의 오클루전이나 큰 색상 대비를 처리할 수 없습니다.

### 5 Discussion

요약하면, 유니티의 접근 방식은 사용자가 단일 이미지에서 오브젝트의 표면 노멀을 인터랙티브하게 다듬고 수정할 수 있는 직관적이고 효과적인 방법을 제공합니다. 회전 팔레트를 사용하여 상대 노멀을 마크업함으로써 사용자는 노멀 맵에서 표면 디테일과 저빈도 오류를 쉽게 조작하고 수정할 수 있습니다. 이 방법은 자동 SfS 알고리즘과 사용자 인터랙션을 결합하여 고품질 표면 재구성을 달성하며, 재질이 균일하고 텍스처 및 알베도 변화가 상대적으로 적은 물체에 적합합니다. 향후 연구에서는 필요한 사용자 마크업의 양을 줄이기 위해 자동화된 영역 라벨링을 탐색할 수 있습니다.

참고문서

- Efficient belief propagation for vision using linear constraint nodes.
    
    [http://www.cs.cmu.edu/~bpotetz/Publications/bpotetz_ConstraintNodes_cvpr07.pdf](http://www.cs.cmu.edu/~bpotetz/Publications/bpotetz_ConstraintNodes_cvpr07.pdf)
    
    이 논문에서는 실수값 변수에 대한 잠재 함수가 있는 그래픽 모델에서 믿음 전파 메시지를 효율적으로 계산하는 새로운 기법을 소개합니다. 이 접근 방식은 쌍 간 상호 작용이 불충분한 고차 상호 작용이 필요한 문제에 유용한 것으로 나타났습니다. 이 기법은 자연 이미지의 공간 사전을 캡처하는 그래픽 모델에서의 효율적인 추론과 음영으로부터의 형상 추론이라는 두 가지 애플리케이션에서 시연됩니다. 그 결과 이전 방법보다 품질과 유연성이 크게 개선된 것으로 나타났습니다. 이 기법을 사용하면 가장 큰 클러스터의 크기와 관련하여 믿음 전파 메시지를 선형 시간 내에 계산할 수 있으므로 다양한 컴퓨터 비전 애플리케이션에 도움이 될 수 있습니다.
    
    Belief Propagation
    
    다변량 확률 분포의 한계값을 추정하는 방법인 신념 전파에 대해 설명합니다. 이 방법은 요인 노드가 변수 노드에 연결된 이분 그래프인 요인 그래프를 사용하여 표현하는 경우가 많습니다. 합산 신념 전파는 그래프의 각 가장자리를 따라 메시지를 반복적으로 계산하여 한계값을 추정하는 데 사용됩니다. LBP는 요인 그래프에 루프가 포함되어 있고 수렴이 보장되지 않는 경우에 사용됩니다. X~의 기대값과 가장 가능성 있는 값은 신념 전파를 사용하여 계산할 수 있습니다.
    
    Efficient Belief Propagation
    
    신념 전파가 다양한 컴퓨터 비전 문제에 성공적으로 적용되었지만 연속형 변수나 레이블이 많은 고차원 문제에서는 속도가 느려질 수 있다고 설명합니다. 신념 전파의 적용은 쌍으로 연결된 마르코프 랜덤 필드에 국한되어 왔으며, 이는 종종 공동 분포의 전체 복잡성을 포착하기에 충분하지 않습니다. 이 논문에서는 광범위한 고차 포텐셜 함수에 대해 연속적인 확률 변수에 대한 믿음 전파 메시지를 효율적으로 계산하는 방법을 제안하여 더 복잡한 공동 분포를 포착할 수 있도록 합니다.
    
    Linear Constraint Node
    
    방정식 5와 같은 형태의 퍼텐셜 함수에 대한 믿음 전파에서 메시지를 효율적으로 계산하는 기법을 소개하며, 여기에는 변수를 변경하여 계산 시간을 O(NM2) 시간으로 단축하는 방법이 포함됩니다. 이 형태의 선형 포텐셜 함수는 매우 유연하며 모든 다변량 포텐셜 함수에 근사치를 구할 수 있습니다. 또한 비선형성 함수 g가 델타 함수인 경우 하드 선형 제약 노드를 사용하여 문제 상태 공간의 불완전한 표현에서 변수 간의 선형 종속성을 강제할 수 있습니다. 이 기법은 컴퓨터 비전이나 신경과학과 같은 여러 분야에서 유용합니다.
    
    Nonlinear Constraint Nodes
    
    포텐셜의 하위 집합에 동일한 절차를 반복적으로 적용하여 임의의 차원을 가진 포텐셜로 확장할 수 있습니다. 예를 들어 φ(x1, x2, x3, x4) = g(g1(x1) + g2(x2) + g3(x3) + g4(x4)) 형식의 포텐셜 함수를 생각해 봅시다. 방정식 14를 처음 세 변수(x1, x2, x3)에 적용한 다음, 방정식 14를 다시 결과값인 M1(x1)과 네 번째 변수 x4에 적용할 수 있습니다. 이 과정을 재귀적으로 반복하여 임의의 차원을 가진 포텐셜을 처리할 수 있습니다.
    
    요약하면, 제안된 방법을 사용하면 고차원 및 비축 정렬 가우시안 함수를 포함한 광범위한 잠재 함수에 대한 믿음 전파를 효율적으로 계산할 수 있습니다. 이 방법은 가변 폭 구간 히스토그램을 사용하여 메시지를 표현함으로써 이산 히스토그램 표현과 관련된 이산화 오류를 피하면서 매우 비 가우시안적인 마진을 처리할 수 있습니다. 마지막으로, 헤스케의 수렴 알고리즘을 사용하여 에너지 포텐셜이 높은 고도로 연결된 그래프에서도 수렴을 보장합니다.
    
    Convergent Loopy Belief Propagation
    
    루프 신념 전파는 그래픽 모델에서 추론을 수행하는 데 강력한 알고리즘이지만 몇 가지 한계가 있습니다. 주요 문제 중 하나는 특히 타이트한 루프가 많거나 에너지 포텐셜이 높은 그래프의 경우 수렴에 실패할 수 있다는 것입니다. 이 문제는 수렴을 보장하는 베테 자유 에너지를 직접 최소화하는 알고리즘을 사용하여 극복할 수 있습니다. 이러한 알고리즘 중 하나는 수렴을 보장하기 위해 업데이트 방정식을 수정하는 헤스케의 보장된 수렴 LBP 변형입니다. 또 다른 문제는 히스토그램을 사용하여 연속형 확률 변수를 표현할 때 발생하는 이산화 오류입니다. 이 문제는 곱셈과 지수를 효율적으로 계산할 수 있는 가변 폭 구간차원 히스토그램을 사용하면 완화할 수 있습니다. 마지막으로 최대 곱 신념 전파가 필요한 경우, Yuille이 제안한 접근 방식을 사용하여 신념 전파 알고리즘에 의해 계산된 한계값의 최대값을 근사화할 수 있습니다.
    
    Nonparametric Message Representation
    
    연속형 확률 변수를 다룰 때 믿음 전파에서 믿음과 메시지를 계산하기 위해 근사치를 사용하는 경우가 많습니다. 히스토그램을 사용한 이산화는 일반적인 접근 방식이지만, 특히 가우시안 분포가 아닌 경우 오류가 발생할 수 있습니다. 입자 기반 또는 비모수적 신념 전파가 더 효과적인 것으로 나타났지만, 고차 포텐셜 함수 및 수렴적 신념 전파의 경우처럼 각 변수 노드에 연결된 요인 노드의 수가 많으면 비효율적이 됩니다. 이에 대한 해결책으로 가변 폭 구간차원 히스토그램이 제안되었는데, 이 히스토그램에서는 각 메시지가 동일한 구간차원 가장자리를 가진 가우시안 혼합으로 표현됩니다. 이를 통해 곱셈과 지수를 효율적으로 계산할 수 있으며, 각 내부 루프 후에 빈 에지 위치를 업데이트하여 정확도를 향상시킬 수 있습니다.
    
    Application: Higher-Order Spatial Priors
    
    이 섹션에서는 쌍 간 상호작용을 넘어 복잡한 자연 이미지 통계를 포착하는 전문가 분야(FoE) 모델에 신념 전파를 적용한 저자들의 연구에 대해 설명합니다. FoE 모델은 자연 이미지 데이터베이스로부터 학습되며, 이미지의 사전 확률을 여러 학생-T 분포의 곱으로 설명합니다. 저자들은 이전 연구와 동일한 2x2 필터를 사용하여 이미지 노이즈 제거 문제에 이 방법을 적용합니다. 가우시안 확률은 각 픽셀에 인접한 요인 노드에 흡수되며 추가 메시지가 필요하지 않습니다. 섹션 3의 방법을 사용하면 이미지 노이즈 제거와 관련된 단순화 가정에 의존하지 않고도 고차 FoE 요인 그래프에서 효율적인 믿음 전파가 가능합니다. 저자는 이 접근 방식이 다양한 컴퓨터 비전 애플리케이션의 공간 선행으로 사용될 수 있음을 보여주며, 쌍으로 연결된 마르코프 랜덤 필드에 비해 상당한 개선을 보여주는 결과를 제시합니다. 또한 저자들은 이전 연구에서 설명한 고차 FoE 모델에 비해 개선된 결과를 기록했는데, 이는 접근 방식에 사용된 신념 전파 및 비모수적 메시지 표현의 수렴 변형 때문일 가능성이 높습니다. 2.2GHz 옵테론 275에서 이 알고리즘은 256x256 이미지에 대해 각 반복에 2분 미만이 소요되며, 수렴에는 일반적으로 약 30회의 반복이 필요합니다.
    
    Application: Shape From Shading
    
    컴퓨터 비전 문제에서 광범위한 고차 잠재 함수에 대한 믿음 전파 메시지를 효율적으로 계산하는 방법에 대해 설명합니다. 저자는 특정 제약 조건 하에서 단일 이미지에서 3D 표면 모양을 복구하는 고전적인 셰이딩으로부터 모양 복구(SFS) 문제를 해결하는 데 있어 이 접근법의 효과를 입증합니다. 이들은 변수 간의 선형 종속성을 적용하고 통합성 제약 조건에 하드 선형 제약 노드를 사용하는 SFS용 요인 그래프를 제안합니다. 또한 라플라스 분포를 사용하는 3D 표면 선행 모델을 소개합니다. 저자는 이 결과를 이전의 에너지 최소화 방법과 비교하여 상당한 개선이 있었음을 입증합니다. 이 논문에서는 전문가 영역 필터를 통해 학습된 보다 정교한 3D 표면 선구자를 사용하면 이 접근 방식을 더욱 개선할 수 있다고 제안합니다.
    
    이전에는 다루기 어려웠던 그래픽 모델 클래스에 대한 믿음 전파를 효율적이고 성공적으로 수행할 수 있는 방법을 소개합니다. 이 방법은 풍부한 공간 선행에 대한 추론을 수행하고 음영으로부터의 모양 문제를 해결하는 데 사용됩니다. 이 접근 방식은 표면 알베도 및 조명 조건의 불확실성 처리, 강력한 공간 사전 활용, 사용 가능한 경우 추가 깊이 정보 활용과 같은 더 복잡한 문제로 일반화할 수 있는 잠재력을 가지고 있습니다. 고차 클릭과 실수값 변수가 있는 마르코프 랜덤 필드에서 추론을 정확하게 수행할 수 있는 능력은 다양한 컴퓨터 비전 문제를 해결하는 데 유용할 수 있습니다.
    

참고용어

- Belief Propagation
    
    신념 전파는 베이지안 네트워크 및 마르코프 랜덤 필드와 같은 그래픽 모델에서 근사 추론에 사용되는 알고리즘입니다. 이 알고리즘은 관찰된 증거를 기반으로 모델에서 관찰되지 않은 변수의 한계 확률 분포를 계산합니다.
    
    신념 전파는 그래프의 노드 간에 메시지를 전달하는 방식으로 작동합니다. 각 노드는 무작위 변수를 나타내며, 가장자리는 변수 간의 종속성을 나타냅니다. 메시지는 수렴에 도달할 때까지 인접한 노드 간에 주고받으며 알고리즘이 안정적인 솔루션을 찾았음을 나타냅니다.
    
    메시지 자체는 인접한 변수의 값이 주어졌을 때 변수의 조건부 확률 분포를 나타냅니다. 알고리즘은 이러한 메시지를 사용하여 모델의 다른 변수를 고려하지 않고 해당 변수의 확률 분포인 각 변수의 한계 확률 분포를 계산합니다.
    
    신념 전파는 많은 실제 애플리케이션에서 비교적 빠르고 정확하기 때문에 널리 사용되는 알고리즘입니다. 그러나 근사 알고리즘이므로 항상 정확한 솔루션을 제공하지는 않을 수 있다는 점에 유의해야 합니다. 또한 알고리즘의 수렴이 항상 보장되는 것은 아니며, 특히 루프 또는 높은 에너지 포텐셜 함수가 있는 모델에서는 더욱 그렇습니다.