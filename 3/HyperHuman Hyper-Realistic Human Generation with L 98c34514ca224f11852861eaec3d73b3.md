# HyperHuman: Hyper-Realistic Human Generation with Latent Structural Diffusion

[https://huggingface.co/papers/2310.08579](https://huggingface.co/papers/2310.08579)

[https://snap-research.github.io/HyperHuman/](https://snap-research.github.io/HyperHuman/)

- Oct 2023

### 1 INTRODUCTION

텍스트 설명이나 포즈와 같은 특정 사용자 입력을 기반으로 매우 사실적인 사람 이미지를 생성하는 것은 다양한 용도로 활용될 수 있습니다. 예를 들어, 이미지 애니메이션과 가상 의류 시착에 사용할 수 있습니다. 지금까지 이 분야에서는 변형 자동 인코더(VAE)와 생성적 적대 신경망(GAN)이 사용되어 왔습니다. 하지만 이러한 방법은 학습 중 안정성 문제가 있었고, 규모가 작고 다양성이 떨어지는 데이터 세트에 제한적으로 사용되는 경우가 많았습니다.

최근에는 확산 모델(DM)이 사실적인 이미지를 생성하기 위한 선도적인 아키텍처로 부상하고 있습니다. 이러한 모델은 제너레이티브 AI의 새로운 표준을 제시했습니다. 하지만 안정적 확산(Stable Diffusion) 및 DALL-E 2와 같이 가장 유명한 텍스트-이미지 모델 중 일부는 정확한 해부학적 일관성을 나타내는 사람 이미지를 생성하는 데 문제가 있습니다. 주요 과제 중 하나는 인간은 텍스트 설명만으로는 표현하기 어려운 복잡한 구조를 가지고 있다는 것입니다.

이러한 문제를 극복하기 위해 이미지 생성을 더 잘 제어할 수 있는 새로운 방법이 도입되었습니다. 예를 들어, 컨트롤넷과 T2I-어댑터는 DM에 '플러그 앤 플레이' 메커니즘을 사용합니다. 하지만 이러한 방식은 때때로 제어 신호(포즈 맵 등)와 결과 이미지 간에 불일치를 보이기도 합니다. 또 다른 접근 방식인 HumanSD는 신체 골격을 모델에 직접 통합합니다. 하지만 이 방식은 대부분 예술적인 스타일의 이미지를 생성하며 다른 구조적 뉘앙스를 고려하지 않고 주로 포즈에 초점을 맞춥니다.

이 백서에서는 위와 같은 문제점을 해결하기 위해 하이퍼휴먼이라는 통합 프레임워크를 소개합니다. 인간 이미지는 넓은 신체 골격부터 복잡한 공간 지오메트리까지 다양한 수준의 고유한 구조를 가지고 있다는 것이 기본 아이디어입니다. 사실적인 인간 이미지를 생성하려면 외형과 내부 구조 사이의 상관관계를 하나의 전체론적 모델에서 포착해야 합니다.

이를 위해 휴먼버스라는 포괄적인 데이터 세트가 큐레이션되었습니다. 이 데이터 세트는 3억 4천만 개의 다양한 고품질 인체 이미지에 신체 골격, 심도 지도, 이미지 설명 등의 세부 정보가 주석 처리된 것을 자랑합니다. 이 데이터 세트를 활용하여 두 가지 혁신적인 모듈이 설계되었습니다:

- 잠재 구조 확산 모델: 이 모델은 기존의 확산 백본을 개선하여 다양한 이미지 측면을 동시에 처리합니다. 전용 네트워크 설계를 통해 모든 이미지 속성이 일관성 있게 모델링되어 더욱 풍부하고 구조적으로 인식되는 이미지 출력을 보장합니다.
- 구조 가이드 리파이너: 이 모듈은 이전 모델의 출력을 사용하여 고해상도 이미지를 생성합니다. 이 모듈은 강력한 메커니즘을 사용하여 이미지 생성을 개선하고 오류를 줄입니다.

본질적으로 이 백서의 주요 기여는 다음과 같습니다:

- 제어 가능하고 매우 사실적인 인간 이미지 생성에 혁신을 가져올 하이퍼휴먼 프레임워크의 도입. 포괄적인 휴먼버스 데이터 세트는 이러한 노력의 중요한 부분입니다.
- 혁신적인 잠재 구조 확산 모델과 구조 가이드 리파이너는 외모, 공간 관계, 지오메트리를 고려한 인체 이미지 생성을 위한 통합 솔루션을 제공합니다.
- 다양한 시나리오에서 매우 사실적인 사람 이미지를 생성하는 능력을 보여주는 하이퍼휴먼의 우수성을 입증하는 경험적 결과.

### 2 RELATED WORK

텍스트-이미지 확산 모델:
최근 텍스트 설명을 고품질 이미지로 변환하는 분야, 즉 텍스트-이미지(T2I) 생성 분야가 급속도로 발전하고 있습니다. 반복적인 노이즈 제거 프로세스를 통해 이미지를 생성하는 확산 기반 T2I 모델이 주목을 받고 있습니다. 이 모델은 학습 중 안정성과 뛰어난 확장성 덕분에 기존의 생성적 적대 신경망(GAN)보다 선호되고 있습니다. 이 카테고리의 대표적인 모델로는 스테이블 디퓨전(Stable Diffusion)과 DALL-E 2가 있습니다. 이 모델들은 뛰어난 품질의 이미지를 생성하지만 해부학적으로 정확한 인체 이미지를 생성하는 데는 종종 어려움을 겪습니다. 이는 본질적으로 인간 형태의 구조를 이해하지 못하기 때문에 팔다리의 개수가 잘못 생성되는 등의 문제가 발생하기 때문입니다. 유니티가 제안하는 방법은 이러한 인체 구조 지식을 모델의 잠재 공간에 포함시켜 인체 이미지 렌더링의 정확도를 향상시킵니다.

제어 가능한 인체 이미지 생성:
커스터마이징 가능한 인체 이미지를 생성하는 초기 기술은 주로 GAN과 가변 자동 인코더(VAE)에 뿌리를 두고 있었습니다. 이러한 방법은 참조 이미지와 특정 조건을 입력으로 활용했습니다. 최근에는 프로세스를 보다 직관적으로 만들기 위해 텍스트 프롬프트를 이미지 생성을 위한 가이드로 사용하려는 시도가 있었습니다. 하지만 대부분 포즈나 스타일에 대한 기본적인 설명에 국한되어 있습니다. 컨트롤넷, T2I 어댑터, 휴먼SD와 같은 몇몇 혁신적인 작품에서는 보다 복잡하고 어휘가 풍부한 포즈 가이드 합성을 연구했습니다. 그러나 이러한 기술은 포즈를 부정확하게 제어하거나 문체 범위가 좁은 이미지를 생성하는 데 어려움을 겪었습니다. 이러한 기존 노력의 가장 큰 한계는 포즈만 고려하고 사람의 외모와 다양한 구조적 데이터 유형 간의 더 깊은 관계를 무시한다는 점입니다. 유니티의 접근 방식은 공동 노이즈 제거 방법을 사용하여 겉으로 드러나는 인체 구조와 그 기저에 있는 인체 구조를 모두 포착하여 인체 이미지 생성을 위한 보다 일관된 모델을 제공하는 것을 목표로 합니다.

사람 이미지 생성을 위한 데이터 세트:
이미지 생성 모델을 성공적으로 훈련하려면 강력한 데이터 세트가 필수적입니다. 안타깝게도 현재 사람 중심의 데이터 세트에는 눈에 띄는 한계가 있습니다. 일부는 해상도와 품질이 낮고, 일부는 다양성이 제한된 특정 영역만을 다루고 있습니다. 또한 몇몇 데이터 세트는 규모가 제한되어 있으며, 대부분 광범위한 주석을 제공하지 않고 이미지의 한 측면에만 라벨을 붙이는 경우가 많습니다. 이러한 한계를 인식하여 휴먼버스 데이터셋을 소개합니다. 이 데이터 세트는 다양하고 포괄적으로 설계되었으며, 사람의 포즈, 깊이 맵, 표면-노멀 맵을 포함한 주석을 제공하여 이 분야의 새로운 표준을 제시합니다.

### 3 OUR APPROACH

하이퍼휴먼: 사실적인 인간 이미지 생성을 위한 프레임워크

개요(섹션 3):
하이퍼휴먼은 다양한 조건에서 매우 사실적이고 다양한 사람 이미지를 생성하는 혁신적인 모델입니다. 이 시스템은 확산 모델을 기반으로 작동하며 이미지 품질, 깊이, 표면 정상 특징을 향상시키는 통합 프레임워크를 사용합니다. 이 접근 방식은 크게 기본 및 문제 설정, 잠재 구조 확산 모델, 구조 안내 리파이너의 세 가지 부문으로 분류할 수 있습니다.

기초 및 문제 설정(섹션 3.1):
이 작업의 기초가 되는 확산 확률 모델은 순방향 확산 프로세스를 사용합니다. 이 모델은 샘플을 원래 분포에서 노이즈 버전으로 변환한 다음, 이 단계를 역추적하여 더 선명한 이미지를 생성합니다. 잠복 확산 모델과 안정 확산은 이 프로세스에서 필수적인 반복 작업입니다. 주요 목표는 기존 이미지에서 깊이, 표면 노멀, 포즈와 같은 특성을 분석하여 제어 가능한 사람 이미지를 생성하는 것입니다. 이 2단계 프로세스는 먼저 이미지, 깊이, 표면 노멀을 예측한 다음 고해상도 결과물을 위해 이러한 예측을 세분화합니다.

잠재 구조 확산 모델(섹션 3.2):
모델이 사람의 포즈를 정확하게 캡처하려면 단순한 골격 표현이 아니라 사람의 구조와 외형에 대한 심층적인 이해가 필요합니다. 문제는 컬러풀한 RGB 이미지와 그에 상응하는 구조적 이미지를 동시에 모델링하는 데 있습니다. 하이퍼휴먼은 깊이, 표면 노멀, RGB 이미지의 노이즈를 동시에 제거하여 이 문제를 해결합니다. 이 방법은 다양한 이미지 속성을 관리하면서 공간 정렬을 유지합니다. 여기서 중요한 단계는 각 구조적 구성 요소에 동일한 노이즈 레벨을 사용하여 결합된 특징이 동기화되도록 하는 것입니다. 최종 목표는 이러한 모든 요소를 효율적으로 결합하는 통합 모델입니다.

구조 안내 리파이너(섹션 3.3):
위의 모델을 사용하여 공간적으로 정렬된 깊이 및 표면 정상 조건을 예측한 후, 고품질 이미지를 생성하기 위해 정제 프로세스를 사용합니다. 이 단계에는 캡션, 포즈 스켈레톤, 예측된 깊이 및 표면 노멀과 같은 여러 조건을 결합하는 작업이 포함됩니다. 이 방법은 적응성을 보장하므로 다양한 조건에서 작동할 수 있으며 필요에 따라 확장할 수 있습니다. 중요한 과제는 특히 예측된 구조가 완벽하지 않은 경우 오류 누적을 방지하는 것입니다. 이 모델은 보다 강력한 컨디셔닝을 위해 '무작위 드롭아웃' 전략을 배포하여 이 문제를 해결합니다.

하이퍼휴먼은 다양한 조건에서 고품질의 사실적이고 적응력 있는 사람 이미지를 생성할 수 있는 경로를 제공하는 이미지 생성의 혁신이라고 할 수 있습니다.

3

휴먼버스 데이터세트 개요

상세한 주석과 다양한 콘텐츠가 포함된 대규모 데이터 세트는 이미지 생성 작업, 특히 사람 이미지와 관련된 작업에 필수적입니다. 매우 상세하고 제어 가능한 인체 이미지 생성을 지원하기 위해 'HumanVerse'라는 데이터 세트가 구축되었습니다. 이 데이터 세트는 풍부한 주석을 제공하며 품질을 보장하기 위해 추가 전처리를 거쳐 기존 데이터베이스를 기반으로 구축되었습니다.

데이터 세트 생성 및 전처리

휴먼버스 데이터 세트는 두 가지 주요 소스에서 파생됩니다: LAION-2B-en과 COYO-700M. 사람 이미지에만 초점을 맞추기 위해 YOLOS 툴을 사용하여 사진에서 사람 형상을 감지하고 분리했습니다. 선택 기준은 1~3개의 사람 경계 상자가 있고 눈에 보이는 사람 영역이 이미지의 15% 이상을 차지하는 이미지를 포함했습니다. 미적 품질이 좋지 않거나(4.5점 미만) 해상도가 낮은(200x200픽셀 미만) 이미지는 제외되었습니다. 이 과정을 통해 흐릿하거나 너무 작게 표현된 인물을 제외한 고품질의 하위 집합을 만들 수 있었습니다. 특히 이 데이터 세트는 다양한 배경을 포함하고 전신 이미지뿐만 아니라 옷이나 팔다리와 같은 부분적인 인체 영역도 표시한다는 점에서 다른 데이터 세트와 차별화됩니다.

주석 및 기능

2D 인체 포즈: 이미지 속 인물의 골격 구조를 의미합니다. 인체의 다양한 주요 포인트로 구성된 이러한 골격 구조는 제어 가능한 인체 생성에 널리 사용되는 도구입니다. 이러한 키포인트에 정확한 주석을 달기 위해 데이터 세트는 추론을 위해 MMPose를, 백본 지원을 위해 ViTPose-H를 사용했습니다. 주석에는 전신 골격, 신체 골격, 손, 얼굴 랜드마크에 대한 세부 정보가 포함되었습니다.

뎁스 및 표면 노멀 맵: 이러한 요소는 이미지의 공간 지오메트리에 대한 인사이트를 제공하며 일반적으로 조건부 이미지 생성에 사용됩니다. 이 데이터 세트는 깊이 및 노멀 추정을 위해 Omnidata와 같은 도구를 사용했으며, 추가 주석은 MiDaS를 사용하여 제공했습니다.

정확한 주석을 위한 아웃페인트: 이 데이터 세트는 보이는 부분을 기반으로 이미지의 보이지 않는 영역을 추정할 수 있는 기술인 아웃페인팅에 확산 모델을 활용했습니다. 이러한 아웃페인팅된 영역에는 불완전한 부분이 포함될 수 있지만, 인체 구조에 대한 보다 전체적인 시각을 제공합니다. 이를 위해 SD-Inpaint 툴이 사용되었으며, 결과 이미지는 정확한 주석을 위해 추가 처리 과정을 거쳤습니다.

데이터 세트 통계

요약하자면, COYO 하위 집합에는 약 9100만 개의 이미지가 있고, LAION-2B 하위 집합에는 약 2억 4800만 개의 이미지가 포함되어 있습니다. 이 수치는 각각 전체 데이터 세트의 18.12%와 20.77%에 해당합니다. 전체 주석 처리 과정에는 640개의 NVIDIA V100 GPU가 2주 동안 병렬로 작동해야 했습니다.

5

5가지 실험 요약

실험 설정.
연구원들은 평가를 두 부분으로 나누었습니다:

정량적 분석: 모든 방법은 512x512 크기의 이미지를 생성하기 위해 DDIM 스케줄러를 사용하여 일관된 벤치마크에서 테스트되었습니다.
정성적 분석: 팀은 공식 구성을 사용하여 각 모델에 대해 더 큰 1024x1024 해상도 이미지를 생성했습니다.
데이터 세트.
팀은 T2I(텍스트-이미지 변환) 생성에 대한 표준 관행을 따랐습니다. 특히 선명한 사람 피사체의 이미지 8,236장을 선별하여 MS-COCO 2014 검증 세트의 하위 집합을 사용했습니다. 이미지의 크기를 512x512로 조정하고 잘라냈습니다. 공정한 비교를 위해 휴먼버스에서 모델의 첫 번째 단계를 훈련했습니다.

비교 방법.
두 가지 범주의 최신 오픈소스 작업과 비교했습니다:

일반 T2I 모델.
포즈 조건을 사용하여 제어할 수 있는 방법.
구현 세부 사항.
연구팀은 모델에 특정 도구와 절차를 사용했습니다. 디퓨저 플랫폼을 사용했으며 모델 트레이닝을 위해 NVIDIA GPU를 광범위하게 사용했습니다.

5.1 주요 결과

평가 지표.
다양한 지표를 사용하여 평가했습니다:

FID, KID, FIDCLIP을 사용한 이미지 품질.
텍스트-이미지 정렬.
주요 포즈 추정기를 사용하여 합성 이미지에서 포즈를 추출하고 이를 입력 포즈 조건과 비교하는 포즈 정확도.
정량적 분석.
연구진은 평가 결과를 발표하며 모델인 HyperHuman이 이전 작업에 비해 상당한 성능 향상을 보였다고 밝혔습니다. 그러나 텍스트와 이미지의 정렬은 SDXL이 약간 더 우수했습니다.

5.2 제거 연구

이 섹션에서는 연구자들이 이 방법의 특정 구성 요소와 측면을 더 자세히 분석합니다:

전문가 브랜치를 사용한 동시 노이즈 제거.
연구팀은 잠재적 구조 확산 모델의 이점을 탐구하고 다양한 수준의 구조적 전문가 분기를 실험했습니다. 그 결과 이미지 모양, 공간 관계, 지오메트리 학습을 결합하면 더 나은 결과를 얻을 수 있다는 사실을 발견했습니다. 모델에 사용된 레이어 수 또한 결과에 영향을 미쳤습니다.

노이즈 스케줄.
연구팀은 노이즈 스케줄을 실험한 결과 단조로운 구조 맵을 학습하는 데는 제로 터미널 SNR이 필수적이라는 사실을 발견했습니다. 다양한 시간 간격은 성능에 부정적인 영향을 미쳤습니다.

요약하자면, 이러한 실험을 통해 연구원들은 제안한 모델을 꼼꼼하게 평가하여 그 장점과 특정 설계 선택의 근거를 보여주었습니다. 또한 기존의 최신 인체 이미지 생성 방법과 비교하여 그 우수성을 입증했습니다.

6

6 토론 요약

결론.
이 연구는 실제 시나리오에서 촬영한 것처럼 보이는 고품질의 사람 이미지를 생성하도록 설계된 새로운 프레임워크인 하이퍼휴먼을 소개했습니다. 이 프레임워크의 혁신은 이미지의 외형, 공간 관계, 지오메트리를 하나의 통합된 시스템에서 결합하는 데 있습니다. 이는 다양한 이미지 측면을 동시에 향상시키는 잠재 구조 확산 모델을 통해 이루어집니다. 그 다음에는 이미지 디테일을 미세 조정하는 구조 안내 리파이너가 이어집니다. 테스트 결과 하이퍼휴먼은 다양한 상황에서 사실적인 사람 이미지를 생성하는 능력이 뛰어난 것으로 나타났습니다.

한계와 향후 작업.
하이퍼휴먼은 사람 이미지를 생성하는 데 있어 선구적인 노력을 기울이고 있지만, 해결해야 할 과제가 없는 것은 아닙니다. 현재 포즈와 기타 이미지 디테일을 추정하는 데 사용되는 툴은 손가락이나 눈과 같은 세세한 부분을 놓치는 경우가 있습니다. 또한 현재 이 시스템은 인체의 골격 구조를 입력하는 데 의존하고 있습니다. 향후에는 LLM과 같은 딥러닝 모델을 사용하여 텍스트 설명에서 포즈 생성으로 전환할 수 있도록 개선할 수 있습니다.