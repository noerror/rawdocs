# RTMPose: Real-Time Multi-Person Pose Estimation based on MMPose

*이 논문에서는 실시간 다중 인물 포즈 추정을 위한 고성능 프레임워크, RTMPose를 제안하고 있습니다. RTMPose는 모델 성능과 복잡성 간의 균형을 달성하기 위한 연구 결과를 기반으로 개발되었습니다.*

*이 프레임워크는 2D 포즈 추정을 두 개의 분류 작업으로 처리하며, 특성 차원 확장, 소프트 라벨 인코딩, 별도의 시그마 설정, 더 큰 컨볼루션 커널 사용, 더 많은 에폭 및 다중 데이터셋 학습 등 다양한 학습 전략과 최적화를 통해 성능을 개선합니다.*

*또한, 더 높은 특성 해상도를 활용하고, 자체주의 모듈을 사용하여 전역 및 지역 공간 정보를 향상시키며, 다양한 학습 전략과 최적화를 통해 성능을 개선합니다.*

*실시간 추론을 위해 다양한 장치(CPU, GPU, 모바일 장치)에 배포할 수 있으며, COCO, AP-10K, CrowdPose, MPII 등 다양한 데이터셋에 대해 평가되었습니다.*

*결과적으로, RTMPose는 모델 성능과 복잡성 사이의 뛰어난 균형을 보여주며, 산업 분야의 포즈 추정 요구에 부합하고 인간의 포즈 추정 작업에 대한 미래의 탐구에 이바지할 수 있습니다.*

[https://arxiv.org/abs/2303.07399](https://arxiv.org/abs/2303.07399)

- Mar 2023

### 1. Introduction

이 글에서는 새로 개발된 실시간 사람 포즈 추정 시스템인 RTMPose에 대해 설명합니다. 이 시스템은 인간과 컴퓨터의 상호작용, 동작 인식, 스포츠 분석 등 다양한 애플리케이션에서 유용하게 활용될 수 있습니다.

![모델 크기, 지연 시간, 그리고 정밀도 관점에서 RTMPose와 오픈 소스 라이브러리들과의 비교. 원의 크기는 모델 파라미터의 상대적인 크기를 나타냅니다.](RTMPose%20Real-Time%20Multi-Person%20Pose%20Estimation%20bas%202285612a57664e31b82c29e18bca28e2/Untitled.png)

모델 크기, 지연 시간, 그리고 정밀도 관점에서 RTMPose와 오픈 소스 라이브러리들과의 비교. 원의 크기는 모델 파라미터의 상대적인 크기를 나타냅니다.

RTMPose는 포즈 추정의 효율성과 정확성을 개선하기 위해 다양한 혁신과 전략을 도입했습니다. 다음은 몇 가지 주요 기능입니다:

포즈 추정에 하향식 접근 방식을 사용하는데, 초기 감지기가 개인 주변의 경계 상자를 식별하고 각 사람의 포즈를 개별적으로 추정합니다. 이 방법은 일반적으로 느리지만 정확한 것으로 인식됩니다. 그러나 고효율 실시간 감지기를 사용하면 감지 부분이 더 이상 프로세스를 크게 느리게 하지 않아 실시간 추정이 가능해집니다.

RTMPose는 원래 물체 감지용으로 설계된 CSPNeXt 백본을 사용합니다. 이미지 분류 또는 고해상도 피처 맵을 사용하도록 설계된 다른 백본은 정확도가 높을 수 있지만, 높은 계산 비용이나 배포에 어려움을 겪는 경향이 있습니다. 반면에 CSPNeXt는 속도와 정확도 사이의 균형을 잘 유지하므로 이상적인 선택입니다.

RTMPose는 SimCC 기반 알고리즘을 사용하여 키포인트를 예측하고 키포인트 로컬라이제이션을 분류 작업으로 처리합니다. 이 접근 방식은 히트맵 기반 알고리즘에 비해 계산 부담이 적고 아키텍처가 단순하여 다양한 백엔드에 배포하기 쉽습니다.

또한 개발자들은 이전 작업의 훈련 설정을 재검토하고 포즈 추정 작업에 맞는 훈련 전략 모음을 통합했습니다. 그 결과 성능이 크게 향상되었습니다.

RTMPose는 스킵 프레임 감지 전략을 사용하여 지연 시간을 줄이고, 포즈 비최대 억제(NMS) 및 스무딩 필터링을 사용하여 견고성을 높였습니다. 또한 다양한 애플리케이션 시나리오에 적합한 다양한 크기의 모델을 제공하여 성능과 속도 간에 최상의 균형을 보장합니다.

RTMPose는 다양한 추론 프레임워크(PyTorch, ONNX Runtime, TensorRT, ncnn) 및 하드웨어(i7-11700, GTX1660Ti, Snapdragon865)로 테스트되어 인상적인 효율성을 보여주었습니다. 예를 들어, 중간 크기의 RTMPose 모델은 인텔 i7-11700 CPU에서 90 FPS 이상, 엔비디아 지포스 GTX 1660 Ti GPU에서 430 FPS 이상, 스냅드래곤 865 칩에서 35 FPS 이상으로 COCO 검증 세트에서 75.8%의 정확도를 달성했습니다. 실시간 물체 감지 모델인 RTMDet-nano를 사용하면 시스템에서 73.2%의 정확도를 달성할 수 있습니다. 또한 MMDeploy의 도움으로 다양한 백엔드에 RTMPose를 쉽게 배포할 수 있습니다.

### 2. Related Work

이 텍스트는 상향식 및 하향식 접근 방식, 좌표 분류, 비전 변환기 등 네 가지 영역에 중점을 두고 RTMPose 시스템 개발과 관련된 연구를 개괄적으로 설명합니다.

상향식 접근 방식: 이 알고리즘은 특정 인스턴스에 국한되지 않는 키포인트를 감지한 다음 이러한 키포인트를 분리하여 사람의 포즈를 이해합니다. 이러한 방법은 군중 시나리오에서 잘 작동하지만, 종종 큰 입력 해상도가 필요하기 때문에 정확도와 속도의 균형을 맞추기가 어려울 수 있습니다.

하향식 접근 방식: 이 방법은 감지기를 사용하여 바운딩 박스를 생성한 다음 사람을 일정한 크기로 잘라내어 포즈를 추정합니다. 이 방법은 공개 벤치마크를 주도해 왔으며, 특히 6명 미만의 시나리오에서 속도와 정확도 측면에서 상향식 알고리즘을 능가합니다. 이 논문에서는 주로 공개 데이터 세트의 성능을 개선하는 데 중점을 두었지만, 이 논문의 저자는 산업 애플리케이션을 위해 속도와 정확도의 균형을 맞춘 모델을 만드는 것을 목표로 하고 있습니다.

좌표 분류: 과거의 포즈 추정 방법은 일반적으로 키포인트 로컬라이제이션을 좌표 회귀 또는 히트맵 회귀로 간주했습니다. SimCC는 키포인트 예측을 수평 및 수직 좌표에 대한 하위 픽셀 빈의 분류로 공식화하는 새로운 전략을 도입했습니다. 이 접근 방식은 고해상도 히트맵, 비용이 많이 드는 업스케일링 레이어, 추가 세분화 후처리가 필요하지 않습니다. 가벼운 포즈 추정 모델을 개발하는 데 이상적입니다.

비전 트랜스포머: 비전 트랜스포머 아키텍처는 원래 자연어 처리(NLP)에서 유래한 것으로, 다양한 비전 작업에서 큰 성공을 거두었습니다. 객체 감지, 시맨틱 분할, 비디오 이해, 포즈 추정 등에 사용되어 왔습니다. 이전의 트랜스포머 기반 포즈 추정 접근 방식은 히트맵 기반 표현을 사용하거나 픽셀 토큰과 키포인트 토큰을 모두 유지했기 때문에 계산 비용이 많이 들고 실시간 추론에 방해가 되었습니다. RTMPose에서는 자체 주의 메커니즘을 컴팩트한 SimCC 기반 표현과 결합하여 정확성과 효율성을 유지하면서 계산 부하를 줄입니다.

### 3. Methodology

이 섹션에서는 좌표 분류 패러다임의 기초부터 시작하여 RTMPose 시스템을 구축하는 접근 방식에 대해 설명합니다.

강력한 기준선으로서의 SimCC: 저자들은 연속 좌표를 적분 빈 레이블로 이산화하여 키포인트 로컬라이제이션을 분류 문제로 공식화하는 SimCC 방법부터 시작합니다. 이 방법은 특징을 벡터화된 키포인트 표현으로 변환하는 1x1 컨볼루션 레이어와 분류를 위해 완전히 연결된 두 개의 레이어를 사용하여 모델의 간단한 구조를 제공합니다. 가우시안 라벨 평활화 전략을 도입하여 성능을 개선합니다. 그런 다음 업샘플링 레이어를 제거하고 ResNet-50 백본을 더 컴팩트한 CSPNext-m으로 대체하여 복잡성을 줄였습니다. 그 결과 정확도가 높은 강력한 기준 모델이 탄생했습니다.

![RTMPose의 전체 아키텍처는 컨볼루션 레이어, 완전 연결 레이어 및 K 키포인트 표현을 개선하는 Gated Attention Unit (GAU)을 포함합니다. 그 후 2d 포즈 추정은 x축과 y축 좌표에 대한 두 개의 분류 작업으로 간주되어 키포인트의 수평 및 수직 위치를 예측합니다.](RTMPose%20Real-Time%20Multi-Person%20Pose%20Estimation%20bas%202285612a57664e31b82c29e18bca28e2/Untitled%201.png)

RTMPose의 전체 아키텍처는 컨볼루션 레이어, 완전 연결 레이어 및 K 키포인트 표현을 개선하는 Gated Attention Unit (GAU)을 포함합니다. 그 후 2d 포즈 추정은 x축과 y축 좌표에 대한 두 개의 분류 작업으로 간주되어 키포인트의 수평 및 수직 위치를 예측합니다.

훈련 기법: 그런 다음 저자들은 모델을 더욱 세분화하기 위해 사용한 몇 가지 기법을 자세히 설명합니다.

사전 훈련: 정확도를 향상시키는 UDP 방법을 사용하여 백본을 사전 훈련합니다.

최적화 전략: 지수 이동 평균(EMA)을 사용하여 과적합을 줄이고 플랫 코사인 어닐링 전략을 사용하여 정확도를 더욱 향상시킵니다. 또한 정규화 레이어의 가중치 붕괴와 편향도 방지합니다.

2단계 훈련 증강: 강했다가 약해지는 2단계 증강 전략을 사용합니다. 첫 번째 단계에서는 강력한 데이터 증강을 사용하여 학습한 다음 두 번째 단계에서는 약한 전략을 사용하여 모델을 미세 조정하여 실제 이미지 분포에 더 가깝게 만듭니다. 이 기법에는 큰 무작위 스케일링 및 회전 계수를 사용하고 컷아웃 기법을 적용하여 모델이 이미지 텍스처에 과도하게 피팅되는 것을 방지하고 포즈 구조 정보를 학습하는 데 도움을 주는 것이 포함됩니다.

![SimCC 기준에서의 단계별 개선 사항들.](RTMPose%20Real-Time%20Multi-Person%20Pose%20Estimation%20bas%202285612a57664e31b82c29e18bca28e2/Untitled%202.png)

SimCC 기준에서의 단계별 개선 사항들.

이 섹션은 전체 모델 구조와 단계별 이득을 백서의 두 그림에 표시하는 것으로 마무리합니다.

저자들은 특징 해상도가 증가함에 따라 성능이 향상되는 것을 관찰했습니다. 따라서 완전히 연결된 레이어를 사용하여 1차원 키포인트 표현을 256차원으로 확장하여 모델의 정확도를 향상시켰습니다.

또한 저자는 이전 작업에서 영감을 얻은 자체 주의 모듈을 사용하여 키포인트 표현을 더욱 세분화합니다. 특히 표준 트랜스포머에 비해 속도가 빠르고 메모리 비용이 낮으며 성능이 향상된 게이트 어텐션 유닛(GAU)이라는 트랜스포머 변형을 구현했습니다. 이 셀프 어텐션 모듈은 모델의 성능을 0.5% AP 향상시킵니다.

손실 함수의 경우, 저자는 SORD 방식에서 제안한 소프트 라벨 인코딩에 따라 좌표 분류를 서수 회귀 작업으로 처리합니다. 또한 저자들은 모델 출력과 소프트 라벨 모두에 대해 소프트맥스 연산에서 온도를 조정하는 실험을 수행했습니다. 실험 결과에 따르면 특정 온도(τ = 0.1)를 사용하면 성능이 향상될 수 있습니다.

또한 저자는 수평 및 수직 레이블에 별도의 시그마 값을 사용하여 정확도를 향상시킵니다.

또한 저자는 마지막 컨볼루션 레이어의 다양한 커널 크기로 실험하여 더 큰 커널 크기를 사용하면 1 × 1 커널을 사용하는 것보다 성능이 향상된다는 점에 주목했습니다. 최종적으로 더 높은 AP를 달성하는 7×7 컨볼루션 레이어를 사용하기로 결정합니다.

3.5 추론 파이프라인

포즈 추정 모델 외에도 저자들은 지연 시간을 줄이고 견고성을 높이기 위해 전체 하향식 추론 파이프라인을 최적화하는 것을 목표로 합니다. 이들은 블레이즈포즈의 스킵 프레임 감지 메커니즘을 사용하는데, 이 메커니즘에서는 사람 감지가 K프레임마다 수행되고, 간격 프레임의 마지막 포즈 추정 결과에서 바운딩 박스가 생성됩니다. 프레임에 걸쳐 더 부드러운 예측을 위해 후처리 단계에서는 OKS 기반 포즈 NMS와 원유로 필터를 사용합니다.

![RTMPose의 추론 파이프라인.](RTMPose%20Real-Time%20Multi-Person%20Pose%20Estimation%20bas%202285612a57664e31b82c29e18bca28e2/Untitled%203.png)

RTMPose의 추론 파이프라인.

마지막으로, 더 많은 에포크에 대한 학습과 사전 학습 및 미세 조정을 위해 여러 데이터 세트(COCO 및 AI 챌린저)를 사용하면 성능이 더욱 향상되어 최종 AP 75.3%를 달성할 수 있다는 것을 발견했습니다.

### 4. Experiments

4.1. 설정

저자들은 표 7에 표시된 트레이닝 설정을 사용하여 8개의 NVIDIA A100 GPU에서 실험을 수행했습니다. 히트맵 기반 사전 학습을 사용했으며, 더 짧은 에포크를 제외하고는 미세 조정에서 동일한 학습 전략을 따랐습니다. 평균 평균 정밀도(AP)로 모델 성능을 평가했습니다.

4.2. 벤치마크 결과

저자들은 2D 신체 포즈 추정에서 가장 널리 사용되는 벤치마크인 COCO를 사용했으며, YOLOv3, FasterRCNN, RTMDet과 같은 다양한 검출기로 포즈 추정 성능을 광범위하게 연구했습니다. 또한 1인 시나리오에서 RTMPose 및 기타 접근법을 평가하기 위해 COCO val2017 세트의 1인 이미지 1045개가 포함된 COCO-SinglePerson 데이터세트를 만들었습니다. 또한 저자들은 COCO-WholeBody V1.0 데이터 세트를 사용하여 전신 포즈 추정 작업에서 RTMPose 모델을 테스트했으며, 정확도와 복잡성의 균형을 유지하면서 우수한 성능을 보여주었습니다.

RTMPose 모델은 AP-10K, CrowdPose, MPII 데이터 세트와 같은 다른 데이터 세트에서도 평가되었습니다. 저자들은 기준선과의 공정한 비교를 위해 이미지넷 사전 학습을 사용한 모델 성능을 보고했으며, 더 높은 정확도를 달성한 COCO와 AI 챌린저의 조합을 사용하여 사전 학습한 모델의 성능을 보고했습니다.

4.3. 추론 속도

저자들은 CPU와 GPU 모두에서 추론 속도를 테스트하기 위해 MMDeploy를 사용하여 모델 내보내기, 배포, 추론 및 테스트를 수행했습니다. 4 스레드로 추론하기 위해 스냅드래곤 865 칩에 ncnn과 함께 RTMPose를 배포했습니다. 텐서RT 추론 지연 시간은 엔비디아 지포스 GTX 1660 Ti GPU에서 테스트했으며, ONNX 지연 시간은 인텔 I7-11700 CPU와 1 스레드의 ONNXRuntime에서 테스트했습니다. TinyPose의 경우, 작성자는 MMDeploy와 FastDeploy를 모두 사용하여 테스트했습니다. 모든 모델은 공정한 비교를 위해 동일한 기기에서 테스트했습니다.

![GFLOPs와 정확도의 비교. 왼쪽: 전체 COCO val 세트에서 RTMPose와 다른 오픈 소스 포즈 추정 라이브러리들과의 비교. 오른쪽: COCO-SinglePerson val 세트에서 RTMPose와 다른 오픈 소스 포즈 추정 라이브러리들과의 비교.](RTMPose%20Real-Time%20Multi-Person%20Pose%20Estimation%20bas%202285612a57664e31b82c29e18bca28e2/Untitled%204.png)

GFLOPs와 정확도의 비교. 왼쪽: 전체 COCO val 세트에서 RTMPose와 다른 오픈 소스 포즈 추정 라이브러리들과의 비교. 오른쪽: COCO-SinglePerson val 세트에서 RTMPose와 다른 오픈 소스 포즈 추정 라이브러리들과의 비교.

### 5. Conclusion

결론적으로 이 백서의 저자들은 모델 아키텍처, 트레이닝 전략, 배포 고려 사항, 주요 패러다임 등 포즈 추정에 영향을 미치는 다양한 요인에 대한 종합적인 연구를 발표했습니다. 이러한 인사이트를 바탕으로 고성능 실시간 다중 인원 포즈 추정 프레임워크인 RTMPose를 개발했습니다.

RTMPose는 모델 성능과 계산 복잡성 간의 탁월한 균형을 보여줌으로써 실시간 추론 기능을 유지하면서 CPU, GPU, 모바일 디바이스 등 다양한 디바이스에 효과적으로 배포할 수 있습니다.

저자들은 구현을 오픈소스로 공개함으로써 업계에서 실용적인 포즈 추정 애플리케이션에 대한 수요를 충족하는 동시에 향후 인체 포즈 추정 분야의 탐색과 개발을 촉진하는 것을 목표로 하고 있습니다.

- 모델의 입력과 출력
    
    RTMPose 모델의 입력은 이미지 또는 비디오 프레임이며, 해당 이미지 내의 모든 사람들의 2D 포즈를 추정하는 것입니다. 주어진 입력 이미지는 일반적으로 전처리 단계를 거쳐서 모델에 입력되고, 전처리 단계는 보통 이미지의 크기 조정, 정규화, 색상공간 변환 등을 포함합니다.
    
    모델의 출력은 각 사람의 키포인트 위치를 나타내는 2D 좌표로, 이는 각 사람의 신체 포즈를 나타냅니다. 각 키포인트는 일반적으로 신체의 특정 부위를 나타내며, 예를 들어 머리, 목, 어깨, 팔, 손, 허리, 다리, 발 등을 가리킵니다. 또한 이 모델은 키포인트의 x축과 y축 좌표를 예측하는 두 개의 분류 작업으로 2D 포즈 추정을 처리하며, 출력은 각 키포인트의 수평 및 수직 위치를 예측하는 것입니다.
    
- 의의
    
    RTMPose는 모델의 성능과 복잡성 사이의 균형을 최적화하는 것에 초점을 맞춘 실시간 다중 사람 포즈 추정 프레임워크입니다. 이는 실시간 추론을 위해 다양한 장치(CPU, GPU 및 모바일 장치)에 배포될 수 있습니다. 이러한 점은 실시간 환경에서의 포즈 추정이 중요한 응용 프로그램에 특히 유용합니다.
    
    이전의 다른 모션 예측 방법과 비교했을 때, RTMPose의 주요 차별점은 다음과 같습니다:
    
    1. **효율적인 자기주의 메커니즘:** RTMPose는 Gated Attention Unit (GAU)라는 트랜스포머 변형을 채택하여 전역 및 지역 공간 정보를 더욱 활용합니다. 이는 기존의 트랜스포머보다 더 빠른 속도, 더 낮은 메모리 비용, 더 나은 성능을 제공합니다.
    2. **다중 작업 학습:** RTMPose는 2D 포즈 추정을 x축 및 y축 좌표에 대한 두 가지 분류 작업으로 처리합니다. 이로 인해 모델은 키포인트의 수평 및 수직 위치를 동시에 예측할 수 있습니다.
    3. **학습 전략 및 최적화:** RTMPose는 다양한 학습 전략 및 최적화를 사용하여 성능을 개선합니다. 이에는 특성 차원 확장, 소프트 라벨 인코딩, 별도의 시그마 설정, 더 큰 컨볼루션 커널 사용, 더 많은 에폭 및 다중 데이터셋 훈련이 포함됩니다.
    4. **다양한 장치 지원:** RTMPose는 여러 다른 장치에 배포할 수 있도록 최적화되어 있습니다. 이는 CPU, GPU, 그리고 모바일 장치를 포함하며, 이를 통해 다양한 환경과 용도에 적합한 실시간 포즈 추정 솔루션을 제공합니다.